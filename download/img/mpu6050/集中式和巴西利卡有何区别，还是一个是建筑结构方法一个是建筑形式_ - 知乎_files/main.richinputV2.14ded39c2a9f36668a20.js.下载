(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{1089:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(27),i=function(e){return o.a.createElement(a.a,e,o.a.createElement("path",{d:"M4.076 16.966a4.19 4.19 0 0 1 1.05-1.76l8.568-8.569a.524.524 0 0 1 .741 0l2.928 2.927a.524.524 0 0 1 0 .74l-8.568 8.57c-.49.49-1.096.852-1.761 1.051l-3.528 1.058a.394.394 0 0 1-.49-.488l1.06-3.53zM20.558 4.83c.59.59.59 1.546 0 2.136l-1.693 1.692a.503.503 0 0 1-.712 0l-2.812-2.812a.504.504 0 0 1 0-.712l1.693-1.693a1.51 1.51 0 0 1 2.135 0l1.389 1.389z"}))};i.defaultProps={name:"Edit"},t.a=i},1121:function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r=n(24),o=n.n(r),a=n(21),i=n.n(a),l=n(23),c=n.n(l),u=n(22),s=n.n(u),d=n(25),f=n.n(d),g=n(14),p=n.n(g),h=n(0),m=n.n(h),y=n(12),v=n.n(y),b=n(7);function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var o=p()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return f()(this,n)}}var S=function(e){s()(n,e);var t=C(n);function n(e){var r;i()(this,n),(r=t.call(this,e)).handleChange=function(e){r.setState({checked:e.target.checked});var t=r.props.onChange;"function"==typeof t&&t(e)},r.handleFocus=function(){r.setState({focused:!0})},r.handleBlur=function(){r.setState({focused:!1})};var o=e.checked;return r.state={checked:Boolean(o),focused:!1},r}return c()(n,[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.checked,r=t.forceControlled;if(!r){var o=e.forceControlled,a=e.checked;if(!o||r){if(void 0!==n){var i=this.state.checked;a!==n&&n!==i&&this.setState({checked:n})}}else this.setState({checked:Boolean(n)})}}},{key:"render",value:function(){var e,t=this.props,n=t.id,r=t.style,a=t.className,i=t.preset,l=t.onClick,c=t.onChange,u=t.name,s=t.value,d=t.checked,f=t.disabled,g=t.forceControlled,p=this.state,h=p.focused,m=p.checked,y=g?d:m,C=g?c:this.handleChange;return Object(b.g)("label",{className:v()("Switch",a,(e={},o()(e,"Switch--".concat(i),"normal"!==i),o()(e,"Switch--focused",h),o()(e,"Switch--disabled",f),o()(e,"Switch--checked",Boolean(y)),e)),style:r},Object(b.g)("input",{id:n,className:"Switch-input",type:"checkbox",onClick:l,onChange:C,onFocus:this.handleFocus,onBlur:this.handleBlur,name:u,value:s,checked:Boolean(y),disabled:f}))}}]),n}(m.a.Component);S.defaultProps={preset:"normal"}},1139:function(e,t,n){"use strict";t.a=function(e){var t=e.getCurrentContent();return t.getBlockMap().filter((function(e){return"atomic"===e.getType()})).map((function(e){var n=e.getEntityAt(0);return n?t.getEntity(n):null})).filter(Boolean)}},1266:function(e,t,n){"use strict";var r=n(28),o=n.n(r),a=n(31),i=n.n(a),l=n(39),c=n.n(l),u=n(214),s=n(0),d=n(74),f=n(36),g=n(122),p=n(7),h=["childItems","isMenuToggler","showTogglerIcon"];var m=function(e){return"undefined"!=typeof navigator&&/Mac/i.test(navigator.userAgent)?e.replace(/\+/g,""):e.replace("⌘","Ctrl").replace("⌥","Alt").replace("⇧","Shift")},y=function(e){return{background:e.colors.GBL01A,svg:{fill:e.colors.GBK99B},".togglerIcon":{borderLeftColor:e.colors.GBK99B},color:e.colors.GBK99B}},v=function(e){return{background:e.colors.GBK10A,svg:{fill:e.colors.GBL01A},".togglerIcon":{borderLeftColor:e.colors.GBL01A},color:e.colors.GBL01A}},b=function(e){return{svg:{fill:e.colors.GBL01A},".togglerIcon":{borderLeftColor:e.colors.GBL01A},color:e.colors.GBL01A}},C={name:"5barcq",styles:"width:24px;height:24px;position:relative;border-radius:4px;"},S=Object(s.forwardRef)((function(e,t){var n,r=e.icon,o=e.className,a=e.label,i=e.shortcut,l=e.isActive,s=e.firstLine,g=e.text,h=e.onClick,S=e.isMenuItem,E=void 0!==S&&S,k=e.sectionFirst,O=e.sectionLast,w=e.disabled,T=e.isMenuOpen,j=e.showTogglerIcon,M=e.isMenuToggler,B=e.menuItemText,A=s||!E,R=!s||E,L=!s||E,I=a&&a!==g&&a!==B||i,x=j&&Object(p.g)("div",{className:"togglerIcon",css:function(e){return Object.assign(Object.assign({position:"absolute"},s?{right:"-4px",bottom:"-4px"}:{right:"-1px",bottom:"-1px"}),{},{width:0,height:0,border:"4px solid transparent",borderLeft:"4px solid ".concat(e.colors.GBL05A),transform:"rotate(45deg)"})}});return Object(p.g)(d.a,c()({as:f.c,zaType:"Button",zaText:a,ref:t,preset:f.b.Plain,className:o,disabled:w,css:function(e){return{"&.Button.Button--plain":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},s?E?{padding:"4px 12px"}:{padding:"2px",margin:E?"0":"4px"}:Object.assign({},E?{padding:"10px 16px",textAlign:"left"}:{padding:"6px 16px 6px 12px"})),{},{fontWeight:e.fontWeights.bold,color:e.colors.GBL05A},E&&{width:"100%"}),{},{display:"flex",alignItems:"center"},L&&O&&{borderTopRightRadius:"4px",borderBottomRightRadius:"4px"}),L&&k&&{borderTopLeftRadius:"4px",borderBottomLeftRadius:"4px"}),(s||E)&&{borderRadius:"6px"}),l&&b(e)),{},{"&:hover":v(e)},T&&M&&Object.assign(Object.assign({},y(e)),{},{"&:hover":y(e)})),{},{"&:active":y(e)})}},"aria-label":a,"data-tooltip-position":E&&!s?"right":"bottom","data-tooltip-will-hide-on-click":!0},I&&{"data-tooltip":a+(i?" ".concat(m(i)):"")},{onClick:h}),A||s&&x?Object(p.g)("div",{css:C},A&&Object(p.g)(r,{css:function(e){return{color:e.colors.GBL05A}},center:!0}),s&&x):null,R&&Object(p.g)("span",{css:Object(u.a)(Object.assign(Object.assign({},(!E||s)&&{marginLeft:"4px"}),{},{width:"100%"}),"")},E?null!==(n=null!=B?B:g)&&void 0!==n?n:a:null!=g?g:a),!s&&x)}));t.a=function(e){var t=e.childItems,n=e.isMenuToggler,r=e.showTogglerIcon,a=i()(e,h),l=Object(s.useState)(!1),d=o()(l,2),f=d[0],m=d[1];if(n){if(0===t.length)return null;if(1===t.length)return Object(p.g)(S,c()({},a,t[0]));var y=Object(p.g)(S,c()({},a,{isMenuToggler:!0,isMenuOpen:f,showTogglerIcon:r}));return Object(p.g)(g.c,{toggler:y,onOpen:function(){return m(!0)},onClose:function(){return m(!1)},arrowed:!1,menuContainerClassName:"ToolbarV2Menu-container"},Object(p.g)("div",{css:Object(u.a)({display:e.firstLine?"flex":"block"},"")},t.map((function(t){return Object(p.g)(S,c()({key:t.label,isMenuItem:!0,firstLine:e.firstLine},t))}))))}return Object(p.g)(S,e)}},1379:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(53),o=n.n(r);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=["DIV","P","BLOCKQUOTE","PRE","CODE","OL","UL","H1","H2","H3","H4","H5","H6"],c=function(e){return l.includes(e.nodeName)||e.classList&&(e.classList.contains("video-box")||e.classList.contains("link-box")||e.classList.contains("origin_image")||e.classList.contains("content_image"))};function u(e){if("undefined"==typeof window)return e;if(-1!==e.indexOf("<p>"))return e;var t=document,n=t.createElement("div");n.innerHTML=e;var r,i=a(o()(n.childNodes));try{for(i.s();!(r=i.n()).done;){var l=r.value;if("BR"===l.nodeName&&l.previousSibling&&"BR"!==l.previousSibling.nodeName&&l.nextSibling&&"BR"===l.nextSibling.nodeName){for(var u=t.createElement("p"),s=l.previousSibling;s&&!c(s)&&("BR"!==s.nodeName||s.previousSibling&&"BR"!==s.previousSibling.nodeName&&!c(s.previousSibling));){var d=u.childNodes;d.length>0?u.insertBefore(s,d[0]):u.appendChild(s),s=l.previousSibling}u.childNodes.length>0&&(n.insertBefore(u,l),l.nextSibling.parentNode.removeChild(l.nextSibling),l.parentNode.removeChild(l))}}}catch(e){i.e(e)}finally{i.f()}return n.innerHTML}},1388:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(31),o=n.n(r),a=(n(0),n(1266)),i=n(7),l=["toolbarButton"];function c(e){var t=e.toolbarButton,n=void 0===t?a.a:t,r=o()(e,l);return Object(i.g)("div",null,Object(i.g)(n,r))}},1389:function(e,t,n){"use strict";var r=n(39),o=n.n(r),a=(n(0),n(2771)),i=n(326),l=n(7);t.a=function(e){var t=e.toolbarButton,n=void 0===t?i.a:t;return Object(l.g)("div",null,Object(l.g)(n,o()({label:e.isActive?"删除目录":"添加目录",shortcut:"⌘+⇧+0",icon:a.a},e)))}},1390:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(27),i=function(e){return o.a.createElement(a.a,e,o.a.createElement("path",{d:"M12 2a10 10 0 1 0 0 20c5.523 0 10-4.477 10-10S17.523 2 12 2zm2.081 15.497c-.407.163-.818.318-1.231.464a3.224 3.224 0 0 1-1.069.161c-.624 0-1.107-.15-1.452-.457a1.471 1.471 0 0 1-.518-1.156c0-.183.013-.369.038-.559.026-.187.068-.402.125-.642l.644-2.276c.054-.205.102-.412.145-.618.037-.177.056-.356.057-.536 0-.29-.06-.493-.179-.607-.121-.115-.35-.171-.687-.171a1.814 1.814 0 0 0-.513.076 7.067 7.067 0 0 0-.45.15l.171-.702c.398-.163.8-.31 1.21-.441.387-.123.75-.184 1.093-.184.619 0 1.096.15 1.432.45.334.297.503.686.503 1.163 0 .1-.012.274-.035.523-.02.232-.062.462-.13.686l-.64 2.268a7.016 7.016 0 0 0-.143.622 3.374 3.374 0 0 0-.06.53c0 .303.068.508.202.617.135.108.369.164.701.164.156 0 .331-.027.53-.08.198-.056.337-.103.427-.144l-.17.7zM13.97 8.29c-.292.275-.68.424-1.08.416a1.55 1.55 0 0 1-1.085-.416 1.331 1.331 0 0 1-.45-1.011c0-.393.15-.733.45-1.013.302-.281.665-.42 1.085-.42.421 0 .781.139 1.08.42.298.28.447.62.447 1.013 0 .396-.15.732-.447 1.011z",fillRule:"evenodd"}))};i.defaultProps={name:"Info"},t.a=i},1996:function(e,t,n){(function(t){t.Prism={manual:!0};var r=n(1378),o=n(1582);t.Prism=r,e.exports={Prism:r,PrismDecorator:o}}).call(this,n(110))},2015:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(27),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(e){return o.a.createElement(a.a,i({fill:"currentColor"},e),o.a.createElement("path",{d:"M6.824 2.934l-3.36 3.359a1 1 0 0 0 0 1.414l3.36 3.359a.25.25 0 0 0 .353 0l1.06-1.06a.25.25 0 0 0 0-.354L6.587 8H13a5 5 0 0 1 0 10H4.25a.25.25 0 0 0-.25.25v1.5c0 .138.112.25.25.25H13a7 7 0 1 0 0-14H6.586l1.652-1.652a.25.25 0 0 0 0-.353l-1.06-1.06a.25.25 0 0 0-.354 0z"}))};l.defaultProps={name:"Undo"},t.a=l},858:function(e,t,n){"use strict";n.r(t);var r=n(53),o=n.n(r),a=n(21),i=n.n(a),l=n(23),c=n.n(l),u=n(94),s=n.n(u),d=n(22),f=n.n(d),g=n(25),p=n.n(g),h=n(14),m=n.n(h),y=n(3),v=n.n(y),b=n(0),C=n.n(b),S=n(39),E=n.n(S),k=n(523),O=n.n(k),w=n(35),T=n(890),j=n(12),M=n.n(j),B=n(74),A=n(1376),R=n.n(A),L=n(63),I=n.n(L),x=n(45),N=n.n(x),P=n(36),D=n(278),K=n(183),F=n(464),z=n(289),U=n(31),V=n.n(U),q=n(218),_=n.n(q),H=n(441),G=n.n(H),W=n(938),Y=n(1266);var J=function(e,t){var n,r=(n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null,o=r.r*t+255*(1-t),a=r.g*t+255*(1-t),i=r.b*t+255*(1-t);return"rgb(".concat(o,", ").concat(a,", ").concat(i,")")},Z=n(7),$=function(e){var t=e.children,n=e.firstLine;if(0===(null==t?void 0:t.length))return null;var r=n?{display:"flex",alignItems:"center"}:function(e){return{display:"flex",alignItems:"center",border:"1px solid ".concat(e.colors.GBK09A),borderRadius:"4px","&+&":{marginLeft:"10px"}}};return Object(Z.g)("span",{css:r},t)},X=["label","text","icon","toolType","onClick","commandName","shouldActive","isMenuToggler","childItems","shouldDisabled"];var Q={FIRST_LINE:[W.a.CONTENT_OPERATION,W.a.TEXT_STYLE,W.a.LIST,W.a.BLOCK,W.a.STRUCTURE_GENERATION,W.a.PROFESSIONAL_MEDIA],SECOND_LINE:[W.a.BASIC_MEDIA,W.a.BUSINESS_MEDIA]},ee={name:"cfvfo2",styles:"overflow-x:scroll;overflow-y:hidden;&::-webkit-scrollbar{display:none;}scrollbar-width:none;display:flex;justify-content:center;"},te=function(e){var t=e.lineInfo,n=e.firstLine,r=e.separator,o=e.toolbarInfo,a=e.onCommand,i=e.disableMap,l=e.currentStyle,c=e.currentBlockType,u=e.editorState;return Object(Z.g)("div",{css:ee},t.map((function(e,t){var s=o[e];return 0===s.length?null:Object(Z.g)(C.a.Fragment,null,Object(Z.g)($,{firstLine:n,key:e},t>0&&s.length>0&&r,s.filter((function(e){var t=e.shouldShow;return(void 0===t?function(){return!0}:t)({editorState:u})})).map((function(e,t,r){var o=function e(t,n){var r,o=n.currentBlockType,a=n.currentStyle,i=n.onCommand,l=n.disableMap,c=n.firstLine,u=n.editorState,s=t.label,d=t.text,f=t.icon,g=t.toolType,p=t.onClick,h=t.commandName,m=t.shouldActive,y=t.isMenuToggler,v=t.childItems,b=t.shouldDisabled,C=V()(t,X),S=null==m?void 0:m({currentStyle:a,currentBlockType:o}),E=s,k=f,O=!1,w=d,T=v;if(y&&T.length>=1){var j=t.childItems.find((function(e){var t=e.shouldActive;return null==t?void 0:t({currentStyle:a,currentBlockType:o})}));j?(E=j.label,w=j.text,k=j.icon,O=!1,S=!0):O=!0,T=t.childItems.map((function(t){return e(t,{currentBlockType:o,currentStyle:a,firstLine:c,disableMap:l,onCommand:i,editorState:u})}))}return _()(Object.assign(Object.assign({key:E},C),{},{onClick:function(e){null==p||p(e),h&&i(h)},firstLine:c,isActive:S,disabled:null!==(r=null==b?void 0:b({editorState:u}))&&void 0!==r?r:l[g],label:E,text:w,showTogglerIcon:O,isMenuToggler:y,childItems:T,icon:k}),(function(e){return!G()(e)}))}(e,{onCommand:a,disableMap:i,currentStyle:l,currentBlockType:c,firstLine:n,editorState:u}),s=o.Component,d=o.label,f=null;return f=s?Object(Z.g)(s,E()({key:d,toolbarButton:Y.a},o)):Object(Z.g)(Y.a,E()({key:d},o)),Object(Z.g)(C.a.Fragment,null,f,t<r.length-1&&!n&&Object(Z.g)("span",{css:function(e){return{background:e.colors.GBK09A,height:"36px",width:"1px"}}}))}))))})))},ne={name:"1b08fi0",styles:"height:12px;"},re=function(e){var t=e.plugins,n=(e.currentStyle,e.currentBlockType),r=e.style,o=e.className,a=e.editorState,i=function(e,t){var n={inlineStyle:!1,blockType:!1,entity:!1,clearFormat:!1};return"atomic"===t&&(n.inlineStyle=!0,n.blockType=!0,n.entity=!0,n.clearFormat=!0),"code-block"===t&&(n.inlineStyle=!0,n.entity=!0),n}(0,n),l=Object(W.b)(t);return Object(Z.g)(B.b,{block:"Toolbar"},Object(Z.g)("div",{className:M()("Editable-toolbar",o),onMouseDown:function(e){return e.preventDefault()},css:function(e){return{"&.Editable-toolbar":{padding:"10px 20px",background:"linear-gradient(180deg, ".concat(J(e.colors.GBK02B,.02),", ").concat(e.colors.GBK99A," 30%, ").concat(e.colors.GBK99A,")"),border:0,paddingBottom:0}}},style:r},Object(Z.g)(te,E()({editorState:a,lineInfo:Q.FIRST_LINE,toolbarInfo:l,disableMap:i,separator:Object(Z.g)("span",{css:function(e){return{background:e.colors.GBK09A,height:"20px",margin:"0 10px",width:"1px"}}}),firstLine:!0},e)),Object(Z.g)("div",{css:ne}),Object(Z.g)(te,E()({editorState:a,lineInfo:Q.SECOND_LINE,toolbarInfo:l,disableMap:i,firstLine:!1},e)),Object(Z.g)("hr",{css:function(e){return{border:"none",width:"100%",background:e.colors.GBK09A,height:"1px",margin:"10px 0 0 0"}}})))},oe=n(529),ae=n(244),ie=n.n(ae),le=n(429),ce=n.n(le),ue=function(e){var t=e.dataTransfer;return t.items?Array.from(t.items).filter((function(e){return"file"===e.kind})).map((function(e){return e.getAsFile()})):Array.from(t.files)},se=["enabled","className","children"];function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var fe=function(e){var t=e.tagName.toLowerCase();return"blockquote"===t&&e.nextSibling&&"blockquote"===e.nextSibling.tagName.toLowerCase()?0:("pre"===t&&(e=e.parentNode),"li"!==t||e.nextSibling||(e=e.parentNode),parseFloat(getComputedStyle(e).marginBottom))},ge=function(e){f()(n,e);var t=de(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={cursorPosition:null},e.nested=0,e.currentBlock=null,e.handleEnter=function(){},e.handleLeave=function(){e.currentBlock=null,e.setState({cursorPosition:null})},e.handleMove=ie()((function(t){var n=e.getInsertCursorBlock(t);if(n!==e.currentBlock)if(e.currentBlock=n,n){var r=e.root.getBoundingClientRect(),o=e.root.querySelector(".public-DraftEditor-content").getBoundingClientRect(),a=n.getBoundingClientRect(),i=fe(n);e.setState({cursorPosition:{left:o.left-r.left,top:a.bottom+i/2-r.top,width:o.width}})}else e.setState({cursorPosition:null})}),100),e.handleDragOver=function(t){t.preventDefault(),e.handleMove({target:t.target,pageX:t.pageX,pageY:t.pageY})},e.handleDragEnter=function(t){t.preventDefault(),e.nested++,1===e.nested&&e.handleEnter()},e.handleDragLeave=function(){e.nested--,0===e.nested&&(e.handleLeave(),e.handleMove.cancel())},e.handleDrop=function(t){if(t.preventDefault(),e.handleMove.cancel(),e.nested=0,e.currentBlock=null,e.setState({cursorPosition:null}),e.props.enabled){var n=ue(t),r=e.getInsertCursorBlock({target:t.target,pageX:t.pageX,pageY:t.pageY}),o=r&&r.dataset.offsetKey.split("-")[0];e.props.onDrop&&e.props.onDrop(n,o)}},e}return c()(n,[{key:"getClosestBlock",value:function(e){for(var t,n=this.root.querySelector(".public-DraftEditor-content").getBoundingClientRect(),r=ce()(e.pageX-window.pageXOffset,Math.ceil(n.left),Math.floor(n.right)),o=ce()(e.pageY-window.pageYOffset,Math.ceil(n.top),Math.floor(n.bottom)),a=0,i=[0,10,20];a<i.length;a++){var l=i[a],c=(t=document.elementFromPoint(r,o-l))?t.closest('[data-block="true"]'):null;if(c)return c}return null}},{key:"getInsertCursorBlock",value:function(e){var t=this.getClosestBlock(e);return t&&"pre"===t.tagName.toLowerCase()?t.parentNode.lastChild:t}},{key:"render",value:function(){var e=this,t=this.props,n=t.enabled,r=t.className,o=t.children,a=V()(t,se),i=this.state.cursorPosition;return Object(Z.g)("div",E()({},a,{className:M()("Dropzone",r),onDragOver:this.handleDragOver,onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop,ref:function(t){e.root=t}}),o,n&&i&&Object(Z.g)("div",{className:"Dropzone-cursor",style:i}))}}]),n}(b.Component),pe=n(1996);n(1999);function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}C.a.Component;var me,ye,ve,be=n(985),Ce=n(435),Se=n.n(Ce),Ee=n(1267),ke=n(1331),Oe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))},we=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Oe.apply(void 0,o()(e));return t.__isMiddleware=!0,t},Te=function(e){var t=e.outputBlockType;return function(e){return function(){for(var n,r,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];var l=a[0];function c(e,t){return e?Object(ke.a)(me||(me=Se()(["<",' data-pid="','">'])),t,e):Object(ke.a)(ye||(ye=Se()(["<",">"])),t)}function u(e){return e?'<p data-pid="'.concat(e,'"><br></p>'):"<p><br></p>"}var s={unstyled:{start:c(null==l||null===(n=l.data)||void 0===n?void 0:n.pid,t),end:Object(ke.a)(ve||(ve=Se()(["</",">"])),t),empty:u(null==l||null===(r=l.data)||void 0===r?void 0:r.pid)},atomic:{start:"",end:""}},d=s[l.type];return d||e.apply(void 0,a)}}},je=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"p",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.hasText()?Object(Ee.convertToHTML)({styleToHTML:we(n.map((function(e){return e.styleToHTML})).filter(Boolean)),blockToHTML:we(o()(n).map((function(e){return e.blockToHTML})).concat([Te({contentState:e,outputBlockType:t})]).filter(Boolean)),entityToHTML:we(n.map((function(e){return e.entityToHTML})).filter(Boolean).concat([function(){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[1];return r}}]))})(e).replace(/<\/blockquote><blockquote>|<\/pre><pre( lang="[^"]*")?>/g,"<br>").replace(/\n/g,"<br>"):""};function Me(e){return"handled"===e||!0===e}var Be=n(896),Ae=n.n(Be),Re=n(1379),Le=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,r){e.findEntityRanges((function(e){var n=e.getEntity();return null!==n&&t.includes(r.getEntity(n).getType())}),n)}},Ie=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n){var r=Le.apply(void 0,t),o=e.getBlockMap(),a=0;o.forEach((function(t){r(t,(function(r){var o=t.getEntityAt(r),i=e.getEntity(o).getData();n(o,i,a),a++}),e)}))}},xe=Le;function Ne(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pe(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var De="https://pic2.zhimg.com/v2-6932c031b9e09f13072c09335abdf3dc.png",Ke=function(e){return/^https?:/.test(e.getAttribute("src"))},Fe=function(e){return 1===e.nodeType},ze=function(e){if(!Fe(e))return!1;var t="block"===e.getAttribute("data-draft-node"),n="IMG"===e.tagName&&Ke(e),r=e.classList&&(e.classList.contains("video-link")||e.classList.contains("video-box")||e.classList.contains("unprocessable_video")),o="HR"===e.tagName,a="TABLE"===e.tagName;return t||n||r||o||a},Ue=function(e){var t=document.createElement("img");return t.src=e,t},Ve=function(e,t,n){e=Object(Re.a)(e);var r=document.createElement("div");t||(e=e.replace(/\n/g,"<br>")),t&&(e=e.replace(/<br>\n/g,"<br>")),r.innerHTML=e,t&&(r.innerHTML=function(e){var t,n=Ne(e.querySelectorAll("a"));try{for(n.s();!(t=n.n()).done;){var r=t.value;r.getAttribute("data-href")&&(r.href=r.getAttribute("data-href"))}}catch(e){n.e(e)}finally{n.f()}var a,i=Ne(e.querySelectorAll("mpvideosnap"));try{for(i.s();!(a=i.n()).done;){var l=a.value,c='<a href="'.concat(l.getAttribute("data-url"),'">').concat(l.getAttribute("data-nickname"),"</a>");l.innerHTML=c}}catch(e){i.e(e)}finally{i.f()}var u,s=Ne(e.querySelectorAll("mpprofile"));try{for(s.s();!(u=s.n()).done;){var d=u.value,f="<p>".concat(d.getAttribute("data-nickname"),"</p>");d.innerHTML=f}}catch(e){s.e(e)}finally{s.f()}var g,p=Ne(e.querySelectorAll(".syl-plugin-formula"));try{for(p.s();!(g=p.n()).done;){var h=g.value,m=JSON.parse(h.getAttribute("data-content"));h.appendChild(Ue(m.url))}}catch(e){p.e(e)}finally{p.f()}var y,v=Ne(e.querySelectorAll(".MathJax"));try{for(v.s();!(y=v.n()).done;){var b=y.value,C=document.createElement("div");C.innerHTML=b.innerHTML,b.appendChild(C)}}catch(e){v.e(e)}finally{v.f()}var S,E=Ne(e.querySelectorAll(".audio-box"));try{for(E.s();!(S=E.n()).done;){var k=S.value;"audio"===k.getAttribute("data-bjh-box")&&k.parentNode.replaceChild(Ue("https://pic1.zhimg.com/v2-c1724f5228b56842c247e19c6cff18ca.png"),k)}}catch(e){E.e(e)}finally{E.f()}var O,w=Ne(e.querySelectorAll(".syl-plugin-video"));try{for(w.s();!(O=w.n()).done;){var T=O.value;T.parentNode.replaceChild(Ue(De),T)}}catch(e){w.e(e)}finally{w.f()}for(var j=0,M=[].concat(o()(e.querySelectorAll(".tt-vote-card")),o()(e.querySelectorAll(".vote_iframe")),o()(e.querySelectorAll(".edui-faked-vote")));j<M.length;j++){var B=M[j];B.parentNode.replaceChild(Ue("https://pic1.zhimg.com/v2-58f02873e66da8d3bd58d8c1413c918c.png"),B)}var A,R=Ne(e.querySelectorAll(".novel-container"));try{for(R.s();!(A=R.n()).done;){var L=A.value;L.parentNode.replaceChild(Ue("https://pic2.zhimg.com/v2-b61ca3e3e3d869ce0289c5de8c8a8325.png"),L)}}catch(e){R.e(e)}finally{R.f()}var I,x=Ne(e.querySelectorAll(".lake-content"));try{for(x.s();!(I=x.n()).done;){for(var N=I.value,P=document.createDocumentFragment(),D=0,K=Array.from(N.children);D<K.length;D++){var F=K[D];P.appendChild(F)}N.parentNode.replaceChild(P,N)}}catch(e){x.e(e)}finally{x.f()}var z,U=Ne(e.querySelectorAll(".ne-quote"));try{for(U.s();!(z=U.n()).done;){var V=z.value,q=document.createElement("blockquote");q.innerHTML=V.innerHTML,V.parentNode.replaceChild(q,V)}}catch(e){U.e(e)}finally{U.f()}return e}(r).innerHTML);var a,i=Ne(r.querySelectorAll("p"));try{for(i.s();!(a=i.n()).done;){var l=a.value;""!==l.textContent||l.querySelector("img")||(l.innerHTML="")}}catch(e){i.e(e)}finally{i.f()}var c,u=Ne(r.querySelectorAll("meta, style, title, noscript"));try{for(u.s();!(c=u.n()).done;){var s=c.value;s.parentNode.removeChild(s)}}catch(e){u.e(e)}finally{u.f()}if(n){var d,f=Ne(r.querySelectorAll("img:not([eeimg]):not([data-eeimg])"));try{for(f.s();!(d=f.n()).done;){var g=d.value;g.parentNode.removeChild(g)}}catch(e){f.e(e)}finally{f.f()}}var p,h=Ne(r.querySelectorAll(".highlight"));try{for(h.s();!(p=h.n()).done;){var m=p.value,y=m.querySelector("pre > pre")||m.querySelector("pre");y&&(y.className&&y.setAttribute("lang",y.className.replace(/^language-/,"")),y.innerHTML=y.innerHTML.trim(),m.parentNode.replaceChild(y,m))}}catch(e){h.e(e)}finally{h.f()}var v,b=Ne(r.querySelectorAll("pre > code"));try{for(b.s();!(v=b.n()).done;){var C=v.value,S=C.parentNode;C.className&&S.setAttribute("lang",C.className),S&&(S.innerHTML=C.innerHTML.trim())}}catch(e){b.e(e)}finally{b.f()}var E,k=Ne(r.querySelectorAll("img"));try{for(k.s();!(E=k.n()).done;){var O=E.value;Ke(O)||O.getAttribute("data-diagnose-id")||(O.src="https://pic4.zhimg.com/v2-4f89913ab376925632be5823a038f938.png",O["data-image-src"]=O.src,O["data-image-status"]="import_image_fail")}}catch(e){k.e(e)}finally{k.f()}var w,T=Ne(r.querySelectorAll("img[eeimg], img[data-eeimg]"));try{for(T.s();!(w=T.n()).done;){var j=w.value,M=document.createElement("a"),B=j.getAttribute("data-formula")||j.getAttribute("alt");M.setAttribute("alt",B),M.setAttribute("eeimg",j.getAttribute("eeimg")||"1"),M.textContent=B,j.parentNode.replaceChild(M,j)}}catch(e){T.e(e)}finally{T.f()}var A,R=Ne(r.querySelectorAll('sup[data-draft-type="reference"]'));try{for(R.s();!(A=R.n()).done;){A.value.textContent="^"}}catch(e){R.e(e)}finally{R.f()}var L,I=Ne(r.querySelectorAll('a[data-draft-type="link-card"], div[data-draft-type="link-card"]'));try{for(I.s();!(L=I.n()).done;){var x=L.value,N=x.querySelector("[data-text]");x.textContent=N?N.textContent:x.textContent||x.getAttribute("href")}}catch(e){I.e(e)}finally{I.f()}var P,D=Ne(r.querySelectorAll("[data-paste-ignore]"));try{for(D.s();!(P=D.n()).done;){var K=P.value;K.parentNode.removeChild(K)}}catch(e){D.e(e)}finally{D.f()}var F,z=Ne(r.querySelectorAll("figure"));try{for(z.s();!(F=z.n()).done;){var U=F.value,V=U.querySelector("img"),q=U.querySelector("figcaption");V&&(q&&(V.dataset.caption=q.textContent),U.parentNode.replaceChild(V,U))}}catch(e){z.e(e)}finally{z.f()}var _,H=Ne(r.querySelectorAll(".video-box"));try{for(H.s();!(_=H.n()).done;){for(var G=_.value,W=0,Y=Array.from(G.childNodes);W<Y.length;W++){var J=Y[W];G.removeChild(J)}if("video"===G.getAttribute("data-bjh-box")){var Z='<img src="'.concat(De,'" />');G.innerHTML=Z}}}catch(e){H.e(e)}finally{H.f()}r.innerHTML=r.innerHTML.replace(/^(<br>)+|(<br>)+$/g,"");var $=r.firstChild;$&&ze($)&&r.insertBefore(document.createElement("br"),$);var X=r.lastChild;return X&&ze(X)&&r.appendChild(document.createElement("br")),r.innerHTML};function qe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=Object(Ee.convertFromHTML)({htmlToStyle:we(r.map((function(e){return e.htmlToStyle})).concat([function(){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[2];return r}}]).filter(Boolean)),htmlToEntity:we(r.map((function(e){return e.htmlToEntity})).filter(Boolean)),htmlToBlock:we(r.map((function(e){return e.htmlToBlock})).concat((function(){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,o=t[0],a=t[1],i="";(["h1","h2","h3","h4","h5","h6"].includes(o)&&(i=["h1","h2"].includes(o)?{type:"header-two"}:{type:"header-three"}),"p"===o)&&(i={type:"unstyled",data:{pid:null==a||null===(r=a.dataset)||void 0===r?void 0:r.pid}});return ze(a)&&(i={type:"atomic"}),i}})).filter(Boolean))})(Ve(e,t,n)),a=o.getBlockMap();return a.forEach((function(e){xe("reference")(e,(function(t,n){var r=e.getKey(),a=e.getEntityAt(t),i=T.SelectionState.createEmpty(r).set("anchorOffset",t).set("focusOffset",n);o=T.Modifier.replaceText(o,i," ",null,a)}),o)})),o}var _e=function(e){return"unstyled"===e.getType()?"Editable-unstyled":"Editable-styled"},He=function(e){var t={};return e.has("UNDERLINE")&&(t.textDecoration="none",t.borderBottom="1px dashed rgba(64, 64, 64, .72)"),t},Ge=function(e,t){return e instanceof T.ContentState?e:"string"==typeof e?qe(e,void 0,void 0,t):"object"==typeof e?Object(T.convertFromRaw)(e):T.ContentState.createFromText("")},We=function(e,t,n,r){var o=e.getCurrentContent();return{editorState:e,toRaw:function(){return Object(T.convertToRaw)(o)},toHTML:function(){return je(o,t,n)},get isEmpty(){return!o.hasText()},getAttachment:function(){return r}}};function Ye(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Je(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ze=function(e,t){var n,r=[],a=Ye(e);try{for(a.s();!(n=a.n()).done;){var i=n.value[t];i&&(Array.isArray(i)?r.push.apply(r,o()(i)):r.push(i))}}catch(e){a.e(e)}finally{a.f()}return r.sort((function(e,t){return(null==e?void 0:e.priority)-(null==t?void 0:t.priority)})),r.map((function(e){return e.component?e.component:e}))},$e=n(2760),Xe=n(100),Qe=n(1186),et=n(1587),tt=n.n(et),nt=[["ABAP","abap"],["ABNF","abnf"],["ActionScript 3","as3"],["ActionScript","as"],["Ada","ada"],["ADL","adl"],["Agda","agda"],["Alloy","alloy"],["AmbientTalk","at"],["ANTLR","antlr"],["ApacheConf","apacheconf"],["APL","apl"],["AppleScript","applescript"],["Arduino","arduino"],["AspectJ","aspectj"],["aspx-cs","aspx-cs"],["aspx-vb","aspx-vb"],["Asymptote","asy"],["autohotkey","ahk"],["AutoIt","autoit"],["Awk","awk"],["Base Makefile","basemake"],["Bash Session","console"],["Bash","bash"],["Batchfile","bat"],["BBCode","bbcode"],["BC","bc"],["Befunge","befunge"],["BlitzBasic","blitzbasic"],["BlitzMax","blitzmax"],["BNF","bnf"],["Boo","boo"],["Boogie","boogie"],["Brainfuck","brainfuck"],["Bro","bro"],["BUGS","bugs"],["C","c"],["C#","csharp","c#"],["C++","cpp","c++"],["c-objdump","c-objdump"],["ca65 assembler","ca65"],["cADL","cadl"],["CAmkES","camkes"],["CBM BASIC V2","cbmbas"],["Ceylon","ceylon"],["CFEngine3","cfengine3"],["cfstatement","cfs"],["ChaiScript","chai"],["Chapel","chapel"],["Cheetah","cheetah"],["Cirru","cirru"],["Clay","clay"],["Clojure","clojure"],["ClojureScript","clojurescript"],["CMake","cmake"],["COBOL","cobol"],["COBOLFree","cobolfree"],["CoffeeScript","coffee-script"],["Coldfusion CFC","cfc"],["Coldfusion HTML","cfm"],["Common Lisp","common-lisp"],["Component Pascal","componentpascal"],["Coq","coq"],["cpp-objdump","cpp-objdump"],["CPSA","cpsa"],["Crmsh","crmsh"],["Croc","croc"],["Cryptol","cryptol"],["Csound Document","csound-document"],["Csound Orchestra","csound"],["Csound Score","csound-score"],["CSS","css"],["CUDA","cuda"],["Cypher","cypher"],["Cython","cython"],["D","d"],["d-objdump","d-objdump"],["Darcs Patch","dpatch"],["Dart","dart"],["Debian Control file","control"],["Debian Sourcelist","sourceslist"],["Delphi","delphi"],["dg","dg"],["Diff","diff"],["Django/Jinja","django"],["Docker","docker"],["DTD","dtd"],["Duel","duel"],["Dylan session","dylan-console"],["Dylan","dylan"],["DylanLID","dylan-lid"],["Earl Grey","earl-grey"],["Easytrieve","easytrieve"],["EBNF","ebnf"],["eC","ec"],["ECL","ecl"],["Eiffel","eiffel"],["Elixir iex session","iex"],["Elixir","elixir"],["Elm","elm"],["EmacsLisp","emacs"],["Embedded Ragel","ragel-em"],["ERB","erb"],["Erlang erl session","erl"],["Erlang","erlang"],["Evoque","evoque"],["Ezhil","ezhil"],["Factor","factor"],["Fancy","fancy"],["Fantom","fan"],["Felix","felix"],["Fish","fish"],["Fortran","fortran"],["FortranFixed","fortranfixed"],["FoxPro","foxpro"],["FSharp","fsharp","f#"],["GAP","gap"],["GAS","gas"],["Genshi Text","genshitext"],["Genshi","genshi"],["Gettext Catalog","pot"],["Gherkin","cucumber"],["GLSL","glsl"],["Gnuplot","gnuplot"],["Go","go"],["Golo","golo"],["GoodData-CL","gooddata-cl"],["Gosu Template","gst"],["Gosu","gosu"],["Groff","groff"],["Groovy","groovy"],["Haml","haml"],["Handlebars","handlebars"],["Haskell","haskell"],["Haxe","hx"],["Hexdump","hexdump"],["HTML","html"],["HTML+Django/Jinja","html+django"],["HTML+Handlebars","html+handlebars"],["HTTP","http"],["Hxml","haxeml"],["Hy","hylang"],["Hybris","hybris"],["IDL","idl"],["Idris","idris"],["Igor","igor"],["Inform 6 template","i6t"],["Inform 6","inform6"],["Inform 7","inform7"],["INI","ini"],["Io","io"],["Ioke","ioke"],["IRC logs","irc"],["Isabelle","isabelle"],["J","j"],["Jade","jade"],["JAGS","jags"],["Jasmin","jasmin"],["Java Server Page","jsp"],["Java","java"],["JavaScript","js","javascript"],["JCL","jcl"],["JSON","json"],["JSON-LD","jsonld"],["Julia console","jlcon"],["Julia","julia"],["Kal","kal"],["Kconfig","kconfig"],["Koka","koka"],["Kotlin","kotlin"],["Lasso","lasso"],["Lean","lean"],["LessCss","less"],["Lighttpd configuration file","lighty"],["Limbo","limbo"],["liquid","liquid"],["Literate Agda","lagda"],["Literate Cryptol","lcry"],["Literate Haskell","lhs"],["Literate Idris","lidr"],["LiveScript","live-script"],["LLVM","llvm"],["Logos","logos"],["Logtalk","logtalk"],["LSL","lsl"],["Lua","lua"],["Makefile","make"],["Mako","mako"],["MAQL","maql"],["Mask","mask"],["Mason","mason"],["Mathematica","mathematica"],["Matlab session","matlabsession"],["Matlab","matlab"],["MiniD","minid"],["Modelica","modelica"],["Modula-2","modula2"],["MoinMoin/Trac Wiki markup","trac-wiki"],["Monkey","monkey"],["MOOCode","moocode"],["MoonScript","moon"],["mozhashpreproc","mozhashpreproc"],["mozpercentpreproc","mozpercentpreproc"],["MQL","mql"],["Mscgen","mscgen"],["MSDOS Session","doscon"],["MuPAD","mupad"],["MXML","mxml"],["Myghty","myghty"],["MySQL","mysql"],["NASM","nasm"],["Nemerle","nemerle"],["nesC","nesc"],["NewLisp","newlisp"],["Newspeak","newspeak"],["Nginx configuration file","nginx"],["Nimrod","nimrod"],["Nit","nit"],["Nix","nixos"],["NSIS","nsis"],["NumPy","numpy"],["objdump","objdump"],["objdump-nasm","objdump-nasm"],["Objective-C","objective-c"],["Objective-C++","objective-c++"],["Objective-J","objective-j"],["OCaml","ocaml"],["Octave","octave"],["ODIN","odin"],["Ooc","ooc"],["Opa","opa"],["OpenEdge ABL","openedge"],["PacmanConf","pacmanconf"],["Pan","pan"],["ParaSail","parasail"],["Pawn","pawn"],["Perl","perl"],["Perl6","perl6"],["PHP","php"],["Pig","pig"],["Pike","pike"],["PkgConfig","pkgconfig"],["PL/pgSQL","plpgsql"],["PostgreSQL console (psql)","psql"],["PostgreSQL SQL dialect","postgresql"],["PostScript","postscript"],["POVRay","pov"],["PowerShell Session","ps1con"],["PowerShell","powershell"],["Praat","praat"],["Prolog","prolog"],["Properties","properties"],["Protocol Buffer","protobuf"],["Puppet","puppet"],["PyPy Log","pypylog"],["Python 3","python3"],["Python 3.0 Traceback","py3tb"],["Python console session","pycon"],["Python Traceback","pytb"],["Python","python","py"],["QBasic","qbasic"],["QML","qml"],["QVTO","qvto"],["Racket","racket"],["Ragel","ragel"],["RConsole","rconsole"],["Rd","rd"],["REBOL","rebol"],["Red","red"],["Redcode","redcode"],["reg","registry"],["ResourceBundle","resource"],["reStructuredText","rst"],["Rexx","rexx"],["RHTML","rhtml"],["Roboconf Graph","roboconf-graph"],["Roboconf Instances","roboconf-instances"],["RobotFramework","robotframework"],["RPMSpec","spec"],["RQL","rql"],["RSL","rsl"],["Ruby irb session","rbcon"],["Ruby","rb"],["Rust","rust"],["S","splus"],["Sass","sass"],["Scala","scala"],["Scalate Server Page","ssp"],["Scaml","scaml"],["Scheme","scheme"],["Scilab","scilab"],["SCSS","scss"],["Shen","shen"],["Slim","slim"],["Smali","smali"],["Smalltalk","smalltalk"],["Smarty","smarty"],["Snobol","snobol"],["SourcePawn","sp"],["SPARQL","sparql"],["SQL","sql"],["sqlite3con","sqlite3"],["SquidConf","squidconf"],["Stan","stan"],["Standard ML","sml"],["SuperCollider","sc"],["Swift","swift"],["SWIG","swig"],["systemverilog","systemverilog"],["TADS 3","tads3"],["TAP","tap"],["Tcl","tcl"],["Tcsh Session","tcshcon"],["Tcsh","tcsh"],["Tea","tea"],["Termcap","termcap"],["Terminfo","terminfo"],["Terraform","terraform"],["TeX","tex"],["Text only","text"],["Thrift","thrift"],["Todotxt","todotxt"],["TrafficScript","rts"],["Treetop","treetop"],["Turtle","turtle"],["Twig","twig"],["TypeScript","ts"],["UrbiScript","urbiscript"],["Vala","vala"],["VB.net","vb.net"],["VCTreeStatus","vctreestatus"],["Velocity","velocity"],["verilog","verilog"],["VGL","vgl"],["vhdl","vhdl"],["VimL","vim"],["X10","x10"],["XML","xml"],["XQuery","xquery"],["XSLT","xslt"],["Xtend","xtend"],["XUL+mozpreproc","xul+mozpreproc"],["YAML","yaml"],["YAML+Jinja","yaml+jinja"],["Zephir","zephir"]].map((function(e){var t=tt()(e);return{name:t[0],id:t[1],alias:t.slice(2)}}));function rt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){var t=e.toLowerCase();return nt.find((function(e){return e.id===t||e.alias.some((function(e){return e===t}))}))}}var ot=function(){return new T.ContentBlock({key:Object(T.genKey)()})};var at=function(e,t){return e.set("blockMap",e.getBlockMap().set(t.getKey(),t))},it=n(871),lt=n(213),ct=n(163);function ut(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var st,dt=function(e){f()(n,e);var t=ut(n);function n(){var e;return i()(this,n),(e=t.call(this)).onChange=function(t){if(t){var n=function(e){return-1!==e.name.toLowerCase().indexOf(t.toLowerCase())};e.setState({value:t,languageItems:[].concat(o()(nt.filter(n)),o()(nt.filter((function(e){return!n(e)}))))})}},e.onSelect=function(t,n){e.props.onSelectItem(n)},e.state={languageItems:nt,rect:{}},e}return c()(n,[{key:"show",value:function(e,t){this.setState({rect:t}),this.onChange(e?e.name:"")}},{key:"hide",value:function(){this.autoComplete&&this.autoComplete.inputNode&&(this.autoComplete.inputNode.blur(),this.setState({rect:{}}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.value,r=t.languageItems,o=t.rect,a=o.left,i=void 0===a?-999:a,l=o.top,c={left:i-180,top:void 0===l?-999:l};return Object(Z.g)(ct.a,null,Object(Z.g)("div",{style:c,className:"Editable-languageSuggestions"},Object(Z.g)(lt.b,{value:n,ref:function(t){e.autoComplete=t},onChange:this.onChange,items:r,menuProps:{menuClassName:"Editable-languageSuggestionsMenu",menuContainerClassName:"Editable-languageSuggestionsMenuContainer"},inputProps:{className:"Editable-languageSuggestionsInput",placeholder:"选择语言",after:Object(Z.g)(it.a,{fill:"#afbdcf"})},onSelect:this.onSelect})))}}]),n}(b.Component);function ft(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return gt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function gt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var pt=function(){var e={},t=null,n=Object(b.createRef)(null);return{initialize:function(t){Object.assign(e,t)},onChange:function(e){var t=e.getCurrentContent();return"code-block"===t.getLastBlock().getType()?T.EditorState.set(e,{currentContent:at(t,ot())}):e},handleGlobalScroll:function(e){e.target.classList&&e.target.classList.contains("Editable-languageSuggestionsMenu")||n.current.hide()},handlePastedText:function(e,t,n,r){var o,a=r.setEditorState,i=n.getCurrentContent(),l=n.getSelection(),c=l.getStartKey();return o=c,"code-block"===i.getBlockForKey(o).getType()?(a(T.EditorState.push(n,T.Modifier.replaceText(i,l,e),"insert-characters")),"handled"):"not-handled"},handleReturn:function(){var t=e.getEditorState(),n=t.getSelection(),r=t.getCurrentContent(),o=n.getStartKey();return"code-block"===r.getBlockForKey(o).getType()?(e.setEditorState(Object(Qe.a)(t,"\n")),"handled"):"not-handled"},draft2html:{blockToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"code-block"===o.type?{start:Object(ke.a)(st||(st=Se()(['<pre lang="','">'])),o.data.language?o.data.language.id:""),end:"</pre>"}:e.apply(void 0,n)}}},components:[Object(Z.g)(dt,{key:"language_suggestions",ref:n,onSelectItem:function(n){if(t){var r,o=t.querySelectorAll("[data-block]"),a=e.getEditorState(),i=a.getCurrentContent(),l=ft(o);try{for(l.s();!(r=l.n()).done;){var c=r.value.getAttribute("data-offset-key").split("-")[0];i=T.Modifier.mergeBlockData(i,T.SelectionState.createEmpty(c),Ae.a.Map({language:n}))}}catch(e){l.e(e)}finally{l.f()}var u=T.EditorState.push(a,i,"change-block-data");e.getEditorRef().props.onChange(u)}}})],onMouseOver:function(r){var o=r.target.closest("pre.public-DraftStyleDefault-pre");if(o){if(o===t)return;var a=o.getBoundingClientRect(),i=o.querySelector("[data-block]").getAttribute("data-offset-key").split("-")[0],l=e.getEditorState().getCurrentContent().getBlockForKey(i);t=o,n.current.show(l.getData().get("language"),{top:a.top,left:a.left+o.offsetWidth})}else{var c;t=null,null===(c=n.current)||void 0===c||c.hide()}},html2draft:{htmlToBlock:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];if("pre"===o){var i=rt(a.getAttribute("lang"));return i?{type:"code-block",data:{language:i}}:{type:"code-block"}}return e.apply(void 0,n)}}},toolbar:{icon:$e.a,label:"代码块",style:"code-block",shortcut:"⌘+⌥+C",section:Xe.a.BLOCK_CONTENT,commandName:"toggle-block-type-code-block",priority:2},toolbarV2:{icon:$e.a,label:"代码块",style:"code-block",shortcut:"⌘+⌥+C",section:W.a.BLOCK,commandName:"toggle-block-type-code-block",priority:2}}};var ht=function(e,t){var n=e.getStartKey(),r=e.getStartOffset(),o=e.getEndKey(),a=e.getEndOffset();if(n!==o&&0===a){var i=t.getBlockBefore(o);return new T.SelectionState({isBackward:!1,anchorKey:n,anchorOffset:r,focusKey:i.getKey(),focusOffset:i.getLength()})}return e},mt=["BOLD","ITALIC","UNDERLINE","CODE"];var yt=function(e,t){return mt.reduce((function(e,n){return T.Modifier.removeInlineStyle(e,t,n)}),e)},vt=function(){var e={};return{initialize:function(t){Object.assign(e,t)},keyBindingFn:function(e){if(T.KeyBindingUtil.hasCommandModifier(e)&&e.shiftKey)switch(e.keyCode){case 55:return"toggle-block-type-ordered-list-item";case 56:return"toggle-block-type-unordered-list-item";case 85:return"toggle-block-type-blockquote"}if(e.metaKey&&T.KeyBindingUtil.isOptionKeyCommand(e)||e.ctrlKey&&e.altKey)switch(e.keyCode){case 49:return"toggle-block-type-header-two";case 50:return"toggle-block-type-header-three";case 67:return"toggle-block-type-code-block"}},handleCommand:function(t){return t.startsWith("toggle-inline-style")?(n=t.slice("toggle-inline-style-".length),e.setEditorState(T.RichUtils.toggleInlineStyle(e.getEditorState(),n)),"handled"):t.startsWith("toggle-block-type")?(function(t){var n=e.getEditorState(),r=T.RichUtils.toggleBlockType(n,t).getCurrentContent();if("code-block"===t){var o=ht(n.getSelection(),r),a=o.getEndKey(),i=r.getBlockForKey(a);i.getType()===t&&(r=yt(r,new T.SelectionState({anchorKey:o.getStartKey(),anchorOffset:0,focusKey:a,focusOffset:i.getLength()})))}e.setEditorState(T.EditorState.forceSelection(T.EditorState.push(n,r,"change-block-type"),n.getSelection()))}(t.slice("toggle-block-type-".length)),"handled"):"not-handled";var n},queryCommandState:function(e,t){if(t)return e.startsWith("toggle-inline-style")?t.getCurrentInlineStyle().has(e.slice("toggle-inline-style-".length)):e.startsWith("toggle-block-type")?T.RichUtils.getCurrentBlockType(t)===e.slice("toggle-block-type-".length):void 0},queryCommandEnable:function(e,t){return["toggle-inline-style-BOLD","toggle-inline-style-ITALIC"].includes(e)?!("code-block"===T.RichUtils.getCurrentBlockType(t)||"atomic"===T.RichUtils.getCurrentBlockType(t)):["toggle-block-type-header-two","toggle-block-type-header-three","toggle-block-type-ordered-list-item","toggle-block-type-unordered-list-item","toggle-block-type-blockquote"].includes(e)?"atomic"!==T.RichUtils.getCurrentBlockType(t):void 0}}},bt=function(){var e={};return{initialize:function(t){Object.assign(e,t)},customStyleMap:{CODE:{margin:"0 2px",padding:"3px 4px",borderRadius:3,fontFamily:"Menlo, Monaco, Consolas, 'Andale Mono', 'lucida console', 'Courier New', monospace",backgroundColor:"#f6f6f6"}},onChange:function(e){if(!e.getSelection().isCollapsed())return e;var t=e.getSelection(),n=e.getCurrentContent(),r=t.getFocusOffset(),o=t.getFocusKey(),a=n.getBlockForKey(o),i=a.getInlineStyleAt(r-1),l=a.getInlineStyleAt(r),c=i.includes("CODE"),u=l.includes("CODE");if(r===a.getLength()&&c){var s=T.Modifier.insertText(n,t," ").merge({selectionAfter:t});e=T.EditorState.forceSelection(T.EditorState.set(e,{currentContent:s}),t)}return!c&&u||c&&!u?T.EditorState.setInlineStyleOverride(e,e.getCurrentInlineStyle().delete("CODE")):e},draft2html:{styleToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"CODE"===o?{start:"<code>",end:"</code>"}:e.apply(void 0,n)}}},html2draft:{htmlToStyle:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[2];return"code"===o?a.add("CODE"):e.apply(void 0,n)}}}}},Ct=function(){return{keyBindingFn:function(e){if(13===e.keyCode&&T.KeyBindingUtil.hasCommandModifier(e))return"command-submit"}}},St=Object(b.forwardRef)((function(e,t){var n=Object(B.i)().trackEvent;return Object(b.useImperativeHandle)(t,(function(){return{onPaste:function(e){n({eventType:"Click",action:"Unknown",elementLocation:{type:"Input",text:e,block:{blockText:"WebEditor"}}})}}})),null})),Et=n(1380),kt=n(1187),Ot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.allowPasteRichText,n=e.disablePasteImage,r=C.a.createRef(null),o={};return{initialize:function(e){Object.assign(o,e)},handlePastedText:function(e,a,i,l){var c=l.setEditorState;if(!t)return e?(c(Object(Et.a)(i,e,null,!0)),"handled"):"not-handled";if(r.current){var u=(null==e?void 0:e.length)||0;r.current.onPaste("字数-".concat(u))}if(a){var s=o.getEditorRef().props.html2draftMiddlewares,d=qe(a,!0,n,s);return c(Object(kt.a)(i,d.blockMap,d.entityMap)),"handled"}return"not-handled"},components:[{component:Object(Z.g)(St,{ref:r,key:"PasteEventTracker"}),priority:1}]}},wt=n(2761),Tt=n(2762),jt=n(2763),Mt=n(2764),Bt=n(2765),At=n(2766),Rt=n(2767),Lt=n(1588),It="undefined"!=typeof navigator&&/Mac/i.test(navigator.userAgent),xt=function(e){var t=e.metaKey,n=e.ctrlKey,r=e.altKey,o=e.shiftKey;return It?t&&r&&!o:n&&r&&!o},Nt=function(e){var t=e.metaKey,n=e.ctrlKey,r=e.altKey,o=e.shiftKey;return It?t&&!r&&o:n&&!r&&o},Pt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.allowHeaderThree,n=e.useV2Feature,r={},o=!1;return{initialize:function(e){Object.assign(r,e)},keyBindingFn:function(e){if(n){if(Nt(e)&&76===e.keyCode)return"toggle-block-type-ordered-list-item";if(T.KeyBindingUtil.hasCommandModifier(e)&&76===e.keyCode)return"toggle-block-type-unordered-list-item"}},handleBeforeInput:function(e){if(r.getEditorState().getSelection().isCollapsed()&&[" ","*","_","`"].includes(e)){var t=Object(Qe.a)(r.getEditorState(),e),n=t.getCurrentContent(),a=t.getSelection(),i=a.getFocusKey(),l=a.getFocusOffset(),c=n.getBlockForKey(i),u=c.getText().slice(0,l),s=null,d=null,f=null;if(/\*([^*]+)\*$/.test(u)&&(s="change-inline-style",d="BOLD",f="*"),/_([^_]+)_$/.test(u)&&(s="change-inline-style",d="ITALIC",f="_"),/`([^`]+)`$/.test(u)&&(s="change-inline-style",d="CODE",f="`"),/^#+ $/.test(u)&&(s="change-block-type",d="header-two"),/^##+ $/.test(u)&&(s="change-block-type",d="header-three"),/^(-|\+|\*) $/.test(u)&&(s="change-block-type",d="unordered-list-item"),/^1\. $/.test(u)&&(s="change-block-type",d="ordered-list-item"),/^> $/.test(u)&&(s="change-block-type",d="blockquote"),!s)return"not-handled";var g=t,p=g.getCurrentContent();if("change-inline-style"===s){if("atomic"===c.getType()||"code-block"===c.getType())return"not-handled";for(var h=u.length,m=u.slice(0,h-1).lastIndexOf(f),y=m;y<=h;y++)if(c.getInlineStyleAt(y).includes(d)||c.getInlineStyleAt(y).includes("CODE"))return"not-handled";p=T.Modifier.replaceText(p,p.getSelectionAfter().merge({anchorOffset:m}),u.slice(m+1,h-1),g.getCurrentInlineStyle()),p=(p=T.Modifier.applyInlineStyle(p,p.getSelectionAfter().merge({anchorOffset:m}),d)).set("selectionAfter",p.getSelectionAfter().merge({anchorOffset:l-2,focusOffset:l-2})),g=T.EditorState.push(g,p,s),g=T.EditorState.setInlineStyleOverride(g,g.getCurrentInlineStyle().delete(d))}if("change-block-type"===s){if("unstyled"!==c.getType())return"not-handled";p=T.Modifier.removeRange(p,new T.SelectionState({anchorKey:i,anchorOffset:0,focusKey:i,focusOffset:l}),"backward"),p=T.Modifier.setBlockType(p,T.SelectionState.createEmpty(i).set("hasFocus",!0),d),g=T.EditorState.push(g,p,s)}return r.setEditorState(g),o=!0,"handled"}return"not-handled"},handleReturn:function(){var e=r.getEditorState(),t=e.getSelection();if(!t.isCollapsed())return"not-handled";var n=e.getCurrentContent(),o=t.getFocusKey(),a=n.getBlockForKey(o);if("unstyled"!==a.getType())return"not-handled";var i=t.getFocusOffset(),l=a.getText().slice(0,i),c=null,u=null,s=null;if(/^-{3,}$/.test(l)&&(c="atomic",s="divider"),/^```(\w*)$/.test(l)){c="code-block";var d=rt(l.match(/^```(\w*)$/)[1]);d&&(u=Ae.a.Map({language:d}))}if(c){var f=e,g=f.getCurrentContent();g=T.Modifier.splitBlock(g,t);var p=T.EditorState.push(f,g,"split-block");if(g=T.Modifier.removeRange(g,new T.SelectionState({anchorKey:o,anchorOffset:0,focusKey:o,focusOffset:i}),"backward"),"code-block"===c&&(g=T.Modifier.setBlockType(g,T.SelectionState.createEmpty(o).set("hasFocus",!0),c),u&&(g=T.Modifier.mergeBlockData(g,T.SelectionState.createEmpty(o).set("hasFocus",!0),u)),f=T.EditorState.push(p,g,"change-block-type")),"atomic"===c){var h=Object(be.a)(T.EditorState.push(p,g),s,"IMMUTABLE"),m=h.getCurrentContent();f=T.EditorState.forceSelection(T.EditorState.push(p,m,"insert-fragment"),h.getSelection())}return r.setEditorState(f),"handled"}return"not-handled"},handleCommand:function(e){return"backspace"===e&&o?(r.setEditorState(T.EditorState.undo(r.getEditorState())),"handled"):"not-handled"},onChange:function(e){return o=!1,e},draft2html:{styleToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"BOLD"===o?{start:"<b>",end:"</b>"}:"ITALIC"===o?{start:"<i>",end:"</i>"}:"UNDERLINE"===o?{start:"<u>",end:"</u>"}:e.apply(void 0,n)}},blockToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o,a,i,l,c,u,s=n[0];return"blockquote"===s.type?{start:"<blockquote".concat(null!=s&&null!==(o=s.data)&&void 0!==o&&o.pid?' data-pid="'.concat(null==s||null===(a=s.data)||void 0===a?void 0:a.pid,'"'):"",">"),end:"</blockquote>"}:"ordered-list-item"===s.type?{start:"<li".concat(null!=s&&null!==(i=s.data)&&void 0!==i&&i.pid?' data-pid="'.concat(null==s||null===(l=s.data)||void 0===l?void 0:l.pid,'"'):"",">"),end:"</li>",nestStart:"<ol>",nestEnd:"</ol>"}:"unordered-list-item"===s.type?{start:"<li".concat(null!=s&&null!==(c=s.data)&&void 0!==c&&c.pid?' data-pid="'.concat(null==s||null===(u=s.data)||void 0===u?void 0:u.pid,'"'):"",">"),end:"</li>",nestStart:"<ul>",nestEnd:"</ul>"}:e.apply(void 0,n)}}},html2draft:{htmlToStyle:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[2];return"b"===o?a.add("BOLD"):"i"===o?a.add("ITALIC"):"u"===o?a.add("UNDERLINE"):e.apply(void 0,n)}},htmlToBlock:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o,a=n[0],i=n[1],l=n[2],c=n[3];if("blockquote"===a||("p"===a||"div"===a)&&"blockquote"===c)return{type:"blockquote",data:{pid:null==i||null===(o=i.dataset)||void 0===o?void 0:o.pid}};if("li"===a){var u,s="ul"===l?"unordered-list-item":"ordered-list-item";return{type:s,data:{pid:null==i||null===(u=i.dataset)||void 0===u?void 0:u.pid}}}return e.apply(void 0,n)}}},toolbar:[{icon:wt.a,label:"粗体",style:"BOLD",shortcut:"⌘+B",section:Xe.a.BASIC_STYLING,commandName:"toggle-inline-style-BOLD",toolType:z.e.INLINE_STYLE,shouldActive:function(e){return e.currentStyle.has("BOLD")},priority:1},{icon:Tt.a,label:"斜体",style:"ITALIC",shortcut:"⌘+I",section:Xe.a.BASIC_STYLING,commandName:"toggle-inline-style-ITALIC",toolType:z.e.INLINE_STYLE,shouldActive:function(e){return e.currentStyle.has("ITALIC")},priority:2},!t&&{icon:jt.a,label:"一级标题",style:"header-two",shortcut:"⌘+⌥+1",section:Xe.a.BASIC_STYLING,commandName:"toggle-block-type-header-two",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"header-two"===e.currentBlockType},priority:3},t&&{icon:Mt.a,label:"一级标题",style:"header-two",shortcut:"⌘+⌥+1",section:Xe.a.BASIC_STYLING,commandName:"toggle-block-type-header-two",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"header-two"===e.currentBlockType},priority:3},t&&{icon:Bt.a,label:"二级标题",style:"header-three",shortcut:"⌘+⌥+2",section:Xe.a.BASIC_STYLING,commandName:"toggle-block-type-header-three",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"header-three"===e.currentBlockType},priority:4},{icon:At.a,label:"有序列表",style:"ordered-list-item",shortcut:"⌘+⇧+7",section:Xe.a.LIST_CONTENT,commandName:"toggle-block-type-ordered-list-item",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"ordered-list-item"===e.currentBlockType},priority:1},{icon:Rt.a,label:"无序列表",style:"unordered-list-item",shortcut:"⌘+⇧+8",section:Xe.a.LIST_CONTENT,commandName:"toggle-block-type-unordered-list-item",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"unordered-list-item"===e.currentBlockType},priority:2},{icon:Lt.a,label:"引用块",style:"blockquote",shortcut:"⌘+⇧+U",section:Xe.a.BLOCK_CONTENT,commandName:"toggle-block-type-blockquote",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"blockquote"===e.currentBlockType},priority:1}].filter(Boolean),toolbarV2:[{icon:wt.a,label:"粗体",style:"BOLD",shortcut:"⌘+B",section:W.a.TEXT_STYLE,commandName:"toggle-inline-style-BOLD",toolType:z.e.INLINE_STYLE,shouldActive:function(e){return e.currentStyle.has("BOLD")},priority:1},{icon:Tt.a,label:"斜体",style:"ITALIC",shortcut:"⌘+I",section:W.a.TEXT_STYLE,commandName:"toggle-inline-style-ITALIC",toolType:z.e.INLINE_STYLE,shouldActive:function(e){return e.currentStyle.has("ITALIC")},priority:2},{name:"header",isMenuToggler:!0,label:"标题",section:W.a.TEXT_STYLE,icon:jt.a,priority:3},{icon:Mt.a,parentName:"header",label:"一级标题",style:"header-two",shortcut:"⌘+⌥+1",section:W.a.TEXT_STYLE,commandName:"toggle-block-type-header-two",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"header-two"===e.currentBlockType},priority:3},{icon:Bt.a,parentName:"header",label:"二级标题",style:"header-three",shortcut:"⌘+⌥+2",section:W.a.TEXT_STYLE,commandName:"toggle-block-type-header-three",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"header-three"===e.currentBlockType},priority:4},{icon:At.a,label:"有序列表",style:"ordered-list-item",shortcut:"⌘+⇧+L",section:W.a.LIST,commandName:"toggle-block-type-ordered-list-item",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"ordered-list-item"===e.currentBlockType},priority:1},{icon:Rt.a,label:"无序列表",style:"unordered-list-item",shortcut:"⌘+L",section:W.a.LIST,commandName:"toggle-block-type-unordered-list-item",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"unordered-list-item"===e.currentBlockType},priority:2},{icon:Lt.a,label:"引用块",style:"blockquote",shortcut:"⌘+⇧+U",section:W.a.BLOCK,commandName:"toggle-block-type-blockquote",toolType:z.e.BLOCK_TYPE,shouldActive:function(e){return"blockquote"===e.currentBlockType},priority:1}].filter(Boolean)}},Dt=n(2768),Kt=function(e,t){var n=(t=ht(t,e)).getStartKey(),r=t.getEndKey(),o=e.getBlockMap();return o.toSeq().skipUntil((function(e,t){return t===n})).takeUntil((function(e,t){return t===r})).concat(new Be.Map([[r,o.get(r)]]))};var Ft=function(e,t,n){var r=Kt(e,t).map(n);return e.merge({blockMap:e.getBlockMap().merge(r),selectionBefore:t,selectionAfter:t})};var zt=function(e,t){return Ft(e,t,(function(e){return"atomic"===e.getType()?e:e.set("type","unstyled")}))},Ut=function(){var e={};return{initialize:function(t){Object.assign(e,t)},keyBindingFn:function(e){if(T.KeyBindingUtil.hasCommandModifier(e)&&220===e.keyCode)return"clear-format"},handleCommand:function(t){return"clear-format"===t?(function(){var t=e.getEditorState(),n=t.getSelection();if(!n.isCollapsed()){var r=t.getCurrentContent();r=zt(r,n),r=yt(r,n),e.setEditorState(T.EditorState.forceSelection(T.EditorState.push(t,r,"change-block-type"),n))}}(),"handled"):"not-handled"},toolbar:{section:Xe.a.FORMAT_EDITING,shortcut:"⌘+\\",icon:Dt.a,label:"清除格式",commandName:"clear-format",priority:1},toolbarV2:{section:W.a.CONTENT_OPERATION,shortcut:"⌘+\\",icon:Dt.a,label:"清除格式",commandName:"clear-format",priority:2}}},Vt=n(28),qt=n.n(Vt);var _t=function(e,t,n){var r=e.getBlockMap(),o=(new Be.OrderedMap).withMutations((function(e){r.entrySeq().forEach((function(r){var o=qt()(r,2),a=o[0],i=o[1];a===n&&e.set(t.getKey(),t),e.set(a,i)}))}));return e.set("blockMap",o)},Ht=n(1065),Gt=function(e){return!!e&&"atomic"===e.type},Wt=function(e){return Boolean(e.data.get("isFocused"))},Yt=function(e){return e.getCurrentContent().getBlockForKey(e.getSelection().focusKey)},Jt=function(e){return e.getCurrentContent().getBlockBefore(e.getSelection().focusKey)},Zt=function(e){return e.getCurrentContent().getBlockAfter(e.getSelection().focusKey)},$t=function(e){return e.getCurrentContent().blockMap.find((function(e){return Gt(e)&&Wt(e)}))},Xt=function(e){var t=e.getSelection();return t.focusKey===t.anchorKey&&Gt(Yt(e))},Qt=function(e){var t=e.getSelection();if(!t.isCollapsed())return!1;var n=Yt(e);return t.focusOffset===n.getLength()&&Gt(Zt(e))},en=function(e){var t=e.getSelection();return!(!t.isCollapsed()||0!==t.focusOffset)&&Gt(Jt(e))},tn=function(e){return Gt(Jt(e))},nn=function(e){return Gt(Zt(e))},rn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n?t.getLength():0,o=T.SelectionState.createEmpty(t.key).merge({anchorOffset:r,focusOffset:r});return T.EditorState.forceSelection(e,o)},on=function(e,t,n){var r=e.getCurrentContent(),o=r.set("blockMap",r.blockMap.map((function(e){return Gt(e)?e.merge({data:e.data.merge({isFocused:e.key===t.key&&n})}):e})));return T.EditorState.set(e,{currentContent:o})},an=function(e,t){var n,r,o,a=function(e){return document.querySelector('[data-block][data-offset-key="'.concat(e.key,'-0-0"]'))}(t);return a&&(n=a,r=document.getSelection(),(o=document.createRange()).setStart(n,0),o.setEnd(n,0),requestAnimationFrame((function(){r.removeAllRanges(),r.addRange(o)}))),T.EditorState.forceSelection(e,T.SelectionState.createEmpty(t.key))},ln=function(){var e,t,n={};return{decorator:function(e){return function(r){var o=r.block,a=Wt(o);return Object(Z.g)(e,E()({},r,{isFocused:a,className:M()(r.className,{"FocusPlugin--focused":a,"FocusPlugin--unfocused":!a}),onMouseDown:function(){t=o},onClick:function(e){e.preventDefault(),n.setEditorState(rn(n.getEditorState(),o))}}))}},onChange:function(n){var r=n.getCurrentContent(),o=n.getSelection(),a=r.getBlockForKey(o.focusKey),i=t||a;t=null;var l=n;if(Gt(i)?o.hasFocus?Wt(i)||(l=on(l,i,!0),l=an(l,i)):l=on(l,i,!1):Gt(e)&&(l=on(l,e,!1),l=T.EditorState.forceSelection(l,o)),o.hasFocus&&["header-two","header-three"].includes(a.type)){var c=r.getBlockMap();if(Object(Ht.c)(a.get("data").get("intoCatalogStatus"))===Ht.a.removed){var u=r;c.forEach((function(e){if(Object(Ht.c)(e.get("data").get("intoCatalogStatus"))===Ht.a.toAdd){var t=e.key;u=T.Modifier.mergeBlockData(u,T.SelectionState.createEmpty(t),Ae.a.Map({intoCatalogStatus:Ht.a.removed}))}})),u=T.Modifier.mergeBlockData(u,T.SelectionState.createEmpty(a.key).merge({anchorOffset:a.getLength(),focusOffset:a.getLength()}),Ae.a.Map({intoCatalogStatus:Ht.a.toAdd})),l=T.EditorState.push(l,u,"change-block-data")}}return e=i,l},removeBlockWithOptions:function(e){var t=e.forwared,r=void 0!==t&&t,o=e.delay,a=void 0!==o&&o,i=n.getEditorState(),l=Yt(i);r?this.moveSelectionForward():this.moveSelectionBackward();var c=function(e,t){var n=e.getCurrentContent();if(t&&Gt(t)){var r=n.merge({blockMap:n.getBlockMap().delete(t.key)});if(r!==n)return T.EditorState.push(e,r,"remove-range")}return null}(i,l);c&&(a?requestAnimationFrame((function(){n.setEditorState(T.EditorState.forceSelection(c,n.getEditorState().getSelection()))})):n.setEditorState(c))},handleKeyCommand:function(e,t){return"backspace"===e&&Xt(t)?(this.removeBlockWithOptions({forwared:!1,delay:!0}),"handled"):"delete"===e&&Xt(t)?(this.removeBlockWithOptions({forwared:!0,delay:!0}),"handled"):"not-handled"},handleReturn:function(){var e=n.getEditorState();if(Xt(e)){var t=e.getSelection(),r=e.getCurrentContent(),o=r.getBlockAfter(t.getFocusKey());if(o===r.getLastBlock()&&0===o.getLength())n.setEditorState(T.EditorState.forceSelection(e,T.SelectionState.createEmpty(o.getKey())));else if(o){var a=ot(),i=_t(r,a,o.getKey()).merge({selectionAfter:T.SelectionState.createEmpty(a.getKey())}),l=T.EditorState.push(e,i,"insert-fragment");n.setEditorState(l)}return"handled"}return"not-handled"},handleBeforeInput:function(e,t){return Xt(t)?"handled":"not-handled"},keyBindingFn:function(e){90===e.keyCode&&T.KeyBindingUtil.hasCommandModifier(e)&&requestAnimationFrame((function(){var e=n.getEditorState(),t=$t(e);if(t){var r=on(e,t,!1);r=T.EditorState.forceSelection(r,e.getSelection()),n.setEditorState(r)}}));var t=n.getEditorState();if(37===e.keyCode&&!e.shiftKey&&!T.KeyBindingUtil.hasCommandModifier(e)&&(Xt(t)||en(t)))return e.preventDefault(),"focus-move-selection-backward";if(39===e.keyCode&&!e.shiftKey&&!T.KeyBindingUtil.hasCommandModifier(e)&&(Xt(t)||Qt(t)))return e.preventDefault(),"focus-move-selection-forward";if(8===e.keyCode&&!e.shiftKey&&!T.KeyBindingUtil.hasCommandModifier(e)){if(Xt(t)&&tn(t))return e.preventDefault(),"focus-backspace-block";if(en(t))return e.preventDefault(),"focus-move-selection-backward"}if(46===e.keyCode&&!e.shiftKey&&!T.KeyBindingUtil.hasCommandModifier(e)){if(Xt(t)&&nn(t))return e.preventDefault(),"focus-delete-block";if(Qt(t))return e.preventDefault(),"focus-move-selection-forward"}},handleCommand:function(e){if("focus-move-selection-backward"===e){var t=n.getEditorState(),r=t.getSelection(),o=t.getCurrentContent(),a=o.getBlockForKey(r.getFocusKey());if(this.moveSelectionBackward(),a!==o.getLastBlock()&&0===a.getLength()){var i=o.merge({blockMap:o.getBlockMap().delete(a.getKey())}),l=T.EditorState.push(t,i,"remove-range");requestAnimationFrame((function(){n.setEditorState(T.EditorState.forceSelection(l,n.getEditorState().getSelection()))}))}return!0}if("focus-move-selection-forward"===e){var c=n.getEditorState(),u=c.getSelection(),s=c.getCurrentContent(),d=s.getBlockForKey(u.getFocusKey());if(this.moveSelectionForward(),d!==s.getFirstBlock()&&0===d.getLength()){var f=s.merge({blockMap:s.getBlockMap().delete(d.getKey())}),g=T.EditorState.push(c,f,"remove-range");requestAnimationFrame((function(){n.setEditorState(T.EditorState.forceSelection(g,n.getEditorState().getSelection()))}))}return!0}return"focus-backspace-block"===e?(this.removeBlockWithOptions({forwared:!1,delay:!0}),!0):"focus-delete-block"===e&&(this.removeBlockWithOptions({forwared:!0,delay:!0}),!0)},moveSelectionBackward:function(){var e=n.getEditorState(),t=e.getCurrentContent(),r=e.getSelection(),o=$t(e)||t.getBlockForKey(r.focusKey),a=t.getBlockBefore(o.key);a&&(Gt(a)?n.setEditorState(an(on(e,a,!0),a)):n.setEditorState(rn(e,a,!0)))},moveSelectionForward:function(){var e=n.getEditorState(),t=e.getCurrentContent(),r=e.getSelection(),o=$t(e)||t.getBlockForKey(r.focusKey),a=t.getBlockAfter(o.key);a&&(Gt(a)?n.setEditorState(an(on(e,a,!0),a)):n.setEditorState(rn(e,a,!1)))},onUpArrow:function(e,t){var n=(0,t.getEditorState)();e.shiftKey||T.KeyBindingUtil.hasCommandModifier(e)||!Xt(n)&&!tn(n)||(e.preventDefault(),this.moveSelectionBackward())},onDownArrow:function(e,t){var n=(0,t.getEditorState)();e.shiftKey||T.KeyBindingUtil.hasCommandModifier(e)||!Xt(n)&&!nn(n)||(e.preventDefault(),this.moveSelectionForward())},initialize:function(e){var t=e.getEditorState,r=e.setEditorState;n.getEditorState=t,n.setEditorState=r}}},cn=n(47),un=n(907),sn=n.n(un),dn=n(2769),fn=function(e){return function(t){return Object(Z.g)(e,E()({},t,t.blockProps))}};function gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var pn=function(e){f()(n,e);var t=gn(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.editable,n=e.contentState,r=e.entityKey,o=e.offsetKey,a=e.children,i=e.target,l=n.getEntity(r).getData();return Object(Z.g)("a",{"data-offset-key":o,"data-editable":t,target:i,href:l.url,className:"Link ztext-link"},a)}}]),n}(C.a.Component);pn.propTypes={editable:v.a.bool,contentState:v.a.object.isRequired,entityKey:v.a.string.isRequired,children:v.a.node,target:v.a.string},pn.defaultProps={target:"_blank",editable:!0};var hn=pn,mn=n(1753),yn=n(1338),vn=n(1250);function bn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Cn=function(e){f()(n,e);var t=bn(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e,t=this.props,n=t.contentState,r=t.entityKey,o=t.offsetKey,a=t.className,i=t.target,l=t.onClick,c=t.onMouseDown,u=t.onRef,s=t.text,d=t.newLinkCard,f=n.getEntity(r).getData(),g=f.url,p=f.image,h=f.imageWidth,m=f.imageHeight,y=f.entityType,v=f.entityData,b=null===(e=g.match(/https:\/\/www.zhihu.com\/zvideo\/(\d+)$/))||void 0===e?void 0:e[1];return d?Object(Z.g)(yn.a,{inEditor:!0,ref:u,component:"div",className:a,href:g,onClick:l,onMouseDown:c,"data-text":s,"data-image":p,"data-image-width":h,"data-image-weight":m,"data-offset-key":o}):b?Object(Z.g)(vn.a,{className:a,onClick:l,onMouseDown:c,"data-offset-key":o,id:b}):Object(Z.g)(mn.a,{className:a,url:g,image:p,imageWidth:h,imageHeight:m,entityType:y,entityData:v,text:s,target:i,onClick:l,onMouseDown:c,ref:u,"data-offset-key":o,component:"div"})}}]),n}(C.a.Component);Cn.propTypes={editable:v.a.bool,contentState:v.a.object.isRequired,entityKey:v.a.string.isRequired};var Sn=Cn,En=n(2772),kn=n(86),On=n(157),wn=n(1138);function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var jn=function(e){f()(n,e);var t=Tn(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={text:"",url:""},e.handleTextChange=function(t){e.setState({text:t.target.value})},e.handleUrlChange=function(t){e.setState({url:t.target.value})},e.handleSubmit=function(t){t.preventDefault(),e.handleClose();var n=e.state.text.trim(),r=e.state.url.trim(),o=wn.a.match(r);if(o.length){var a=o[0].url;e.props.onSubmit({url:a,text:n||r})}},e.handleClose=function(){e.props.onClose()},e.handleFormRef=function(t){t&&(e.setState({text:e.props.defaultText||"",url:e.props.defaultUrl||""}),setTimeout((function(){return e.urlInput.select()})))},e}return c()(n,[{key:"render",value:function(){var e=this,t=this.props.visible,n=this.state,r=n.text,o=n.url;return Object(Z.g)(kn.b,{overlay:!0,title:"插入链接",onClose:this.handleClose,maskClosable:!1,hotKeyClosable:!1},t&&Object(Z.g)("form",{className:"LinkModal-form",onSubmit:this.handleSubmit,ref:this.handleFormRef},Object(Z.g)(On.a,{large:!0,spread:!0,type:"text",className:"LinkModal-input",placeholder:"输入链接文本",value:r,onChange:this.handleTextChange,before:Object(Z.g)(En.a,null)}),Object(Z.g)(On.a,{large:!0,required:!0,spread:!0,type:"text",className:"LinkModal-input",placeholder:"输入链接地址",value:o,onChange:this.handleUrlChange,onRef:function(t){e.urlInput=t},before:Object(Z.g)(dn.a,null)}),Object(Z.g)(kn.a,{direction:"horizontal"},Object(Z.g)(P.c,{onClick:this.handleClose,color:"grey"},"取消"),Object(Z.g)(P.c,{disabled:!wn.a.test(o),preset:"primary",color:"blue",type:"submit"},"确认"))))}}]),n}(b.Component),Mn=n(1591),Bn=n(420),An=Object.assign;var Rn=function(e){return C.a.createElement(Bn.a,An(An({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"ZDI ZDI--Removelink24"+(e.className?" ".concat(e.className):"")}),C.a.createElement("path",{d:"M14.16 15.195a.535.535 0 00-.021-.022l-5.29-5.289a.716.716 0 00-.02-.021L5.11 6.144a.75.75 0 10-1.06 1.061l3.198 3.199-2.981 2.981a4.505 4.505 0 106.37 6.371l2.982-2.981 3.158 3.158a.75.75 0 001.061-1.06l-3.678-3.678zm-8.833 3.5a3.005 3.005 0 010-4.249l2.982-2.982 1.599 1.6-1.961 1.96a.75.75 0 101.06 1.06l1.961-1.96 1.59 1.59-2.98 2.982a3.005 3.005 0 01-4.25 0z",fillRule:"evenodd",clipRule:"evenodd"}),C.a.createElement("path",{d:"M10.254 7.399a.75.75 0 101.06 1.06l3.167-3.166a3.005 3.005 0 014.25 4.25l-3.167 3.166a.75.75 0 101.06 1.06l3.167-3.166a4.505 4.505 0 00-6.371-6.37l-3.166 3.166z"}),C.a.createElement("path",{d:"M16.078 7.953a.75.75 0 010 1.06l-2.105 2.105a.75.75 0 01-1.06-1.06l2.105-2.105a.75.75 0 011.06 0z"}))},Ln=n(431),In=n(1121);function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Nn,Pn=function(){return Object(Z.g)("div",{css:function(e){return{margin:"0 8px",width:"1px",height:"20px",background:e.colors.GBK09A}}})},Dn={name:"124we3h",styles:"display:flex;align-items:center;padding:7px 10px 7px 16px;"},Kn={name:"70qvj9",styles:"display:flex;align-items:center;"},Fn={name:"15fzge",styles:"margin-left:4px;"},zn=function(e){f()(n,e);var t=xn(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.isOpen,n=e.link,r=e.text,o=e.entityData,a=e.allowLinkCard,i=e.onEdit,l=e.onRef,c=e.onConvertToText,u=e.onToggle;return Object(Z.g)(Ln.a,{target:n,isOpen:t,placement:"bottom",repositionKey:r+o.url,className:"LinkBubble",onRef:l,onMouseDown:function(e){return e.preventDefault()}},Object(Z.g)("div",{css:Dn},Object(Z.g)(P.c,{preset:"plain",onClick:function(){window.open(o.url,"_blank")}},"访问链接"),Object(Z.g)(Pn,null),Object(Z.g)(P.c,{preset:"plain","aria-label":"编辑",onClick:i},Object(Z.g)(Mn.a,{css:function(e){return{width:"24px",height:"24px",marginRight:"4px",fill:e.colors.GBL05A}},text:!0,center:!0}),"编辑链接"),Object(Z.g)(Pn,null),Object(Z.g)(P.c,{preset:"plain",onClick:function(){c({isCard:null==o?void 0:o.isCard,link:o.url,text:r})}},Object(Z.g)(Rn,{css:function(e){return{width:"24px",height:"24px",marginRight:"4px",fill:e.colors.GBL05A}},center:!0}),"取消链接"),a&&Object(Z.g)(C.a.Fragment,null,Object(Z.g)(Pn,null),Object(Z.g)(P.c,{className:"LinkBubble-button",preset:"plain",css:Kn},"展示为卡片",Object(Z.g)(In.a,{preset:"micro",checked:o.isCard,css:Fn,onChange:function(){u(o)}})))))}}]),n}(C.a.Component),Un=function(e,t){if(!t.isCollapsed())return!1;var n=t.focusOffset,r=e.getBlockForKey(t.focusKey),o=n>0?r.getEntityAt(n-1):null,a=o&&e.getEntity(o);if(!a||"link"!==a.getType().toLowerCase())return!1;var i=r.getEntityAt(n),l=i&&e.getEntity(i);return!l||l!==a},Vn=function(e){var t=e.getCurrentContent(),n=e.getSelection();if(!Un(t,n))return e;var r,o=n.focusOffset,a=e.isInCompositionMode();if(Nn&&!a){var i=Nn.offset,l=t.getBlockForKey(n.focusKey).getText().slice(i,o),c=T.Modifier.replaceText(t,n.merge({anchorOffset:i}),l,e.getCurrentInlineStyle(),null);r=T.EditorState.push(e,c,"insert-characters")}return Nn=a?{offset:o}:null,r||e},qn=function(e,t,n){var r=n.setEditorState,o=t.getCurrentContent(),a=t.getSelection();if(!Un(o,a))return"not-handled";var i=T.Modifier.insertText(o,a,e,t.getCurrentInlineStyle(),null);return r(T.EditorState.push(t,i,"insert-characters")),"handled"},_n=n(1273),Hn=n.n(_n),Gn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,o=e.getCurrentContent(),a=t||n.url,i=o,l=e;return i=i.createEntity("LINK","MUTABLE",n),i=T.Modifier.replaceText(i,r||e.getSelection(),a,null,i.getLastCreatedEntityKey()),l=T.EditorState.push(e,i,"insert-characters"),T.EditorState.forceSelection(l,i.getSelectionAfter())},Wn=/^([!#$&-;=?-[\]_a-z~]|%[0-9a-fA-F]{2})+$/,Yn=function(e){var t=e.getCurrentContent(),n=e.getSelection();if(!n.isCollapsed())return null;var r=n.focusOffset,o=n.focusKey,a=t.getBlockForKey(o),i=a.getText().slice(0,r);if(!i)return null;for(var l=[],c=r-1;c>=0&&(" "!==i[c]&&null===a.getEntityAt(c));c--)l.push(i[c]);if(!l.length)return null;l.reverse();var u=l.join(""),s=wn.a.match(u),d=s&&s[s.length-1];if(!d||d.lastIndex!==u.length)return null;var f=d.lastIndex-d.index,g=Hn()(d.url);if(g.pathname&&!Wn.test(g.pathname))return null;if(""===d.schema&&encodeURI(g.hostname)!==g.hostname)return null;if(g.hostname.endsWith(".net")&&""===d.schema&&""===g.pathname)return null;var p=T.SelectionState.createEmpty(o).merge({anchorOffset:r-f,focusOffset:r});return Gn(e,d.text,{url:d.url},p)},Jn=function(e,t){return e.getCurrentContent().getBlockMap().findKey((function(e){return e.characterList.find((function(e){return e.getEntity()===t}))}))},Zn=function(e,t,n){var r,o,a=e.getBlockForKey(t),i="";return a.findEntityRanges((function(e){return e.getEntity()===n}),(function(e,t){r=e,o=t,i=a.getText().slice(r,o)})),{text:i,start:r,end:o}},$n=function(e,t){var n=e.getCurrentContent().getEntity(t);return n&&n.getData()},Xn=n(52),Qn=n.n(Xn),er=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.image,r=void 0===n||n,o=Qn.a.stringify({url:e,image:Number(r)});return fetch("https://www.zhihu.com/api/v3/scraper?".concat(o),{credentials:"include",headers:{"X-Requested-With":"Fetch"}}).then((function(e){return e.json()}))},tr=n(138),nr=n(1280),rr=function(e,t,n){var r=$n(e,t),o=Jn(e,t);if(o&&r&&r.isCard&&n.title&&n.title!==n.url){var a={isCard:!0,url:r.url};if(n.image){var i=n.image_info||{},l=i.width,c=i.height,u="ipico",s=l/c;s>1.2?u="180x120":s<=.8&&(u="120x160"),a.image=Object(tr.imgUrl)(n.image,u),a.imageWidth=l,a.imageHeight=c}if(n.entity_type){var d=n.entity_type,f=n.entity_data;a.entityType=d,a.entityData=f}return Object(nr.a)(e,n.title,a,t,o)}},or=function(e,t,n){var r,o=e.getCurrentContent(),a=e.getSelection(),i=$n(e,t),l=Zn(o,a.focusKey,t),c=l.text,u=l.start,s=l.end,d=o.getBlockForKey(a.focusKey).getText()!==c,f=Object.assign(Object.assign({},i),{},{isCard:!0});r=T.Modifier.removeRange(o,T.SelectionState.createEmpty(a.focusKey).merge({anchorOffset:u,focusOffset:s}));var g=T.EditorState.acceptSelection(e,r.getSelectionAfter()),p=g.getSelection();d?(r=T.Modifier.splitBlock(r,p),g=T.EditorState.push(g,r,"split-block")):g=T.EditorState.push(g,r,"remove-range"),g=Object(be.a)(g,"LINK","IMMUTABLE",f,c);var h=(g=T.EditorState.push(e,g.getCurrentContent(),"undo")).getCurrentContent().getLastCreatedEntityKey(),m=Jn(g,h),y=g.getCurrentContent().getBlockForKey(m),v=g.getCurrentContent().getBlockAfter(m);return v&&"atomic"===v.type&&(g=T.EditorState.acceptSelection(g,T.SelectionState.createEmpty(y.key).merge({hasFocus:!0,focusOffset:y.getLength()}))),er(f.url).then((function(e){var t=rr(n.getEditorState(),h,e);t&&n.setEditorState(t)})).catch((function(){})),g},ar=function(e,t,n){var r=e.getCurrentContent(),o=e.getSelection().focusKey,a=r.getBlockForKey(o);if(!a||"atomic"!==a.type)return e;var i=a.getEntityAt(0);if(!i||i!==t)return e;var l=T.Modifier.setBlockType(r,T.SelectionState.createEmpty(o),"unstyled"),c={url:n.url},u=(l=l.createEntity("LINK","MUTABLE",c)).getLastCreatedEntityKey();return l=T.Modifier.replaceText(l,T.SelectionState.createEmpty(o).merge({focusOffset:a.getLength()}),a.getText(),null,u),T.EditorState.push(e,l,"change-block-type")},ir=function(e,t,n){var r=function(e,t){var n=e.getCurrentContent(),r=e.getSelection().focusKey,o=Zn(n,r,t),a=o.start,i=o.end,l=T.Modifier.removeRange(n,T.SelectionState.createEmpty(r).merge({anchorOffset:a,focusOffset:i}));return T.EditorState.push(e,l,"remove-range")}(e,t),o=r.getCurrentContent(),a=e.getSelection().getAnchorOffset(),i=(null==n?void 0:n.text)||(null==n?void 0:n.link),l=i.slice(0,a),c=i.slice(a),u=o.createEntity(" ","MUTABLE",{}),s=u.getLastCreatedEntityKey();u=T.Modifier.replaceText(u,r.getSelection(),l,null,s);var d=T.EditorState.push(e,u,"change-block-data"),f=d.getCurrentContent(),g=f.getSelectionAfter();return f=T.Modifier.insertText(f,d.getSelection(),c),d=T.EditorState.push(d,f,"change-block-data"),T.EditorState.forceSelection(d,g)},lr=function(e,t,n){var r=e.getCurrentContent(),o=e.getSelection().focusKey,a=r.getBlockForKey(o),i=(null==n?void 0:n.text)||(null==n?void 0:n.link),l=T.Modifier.setBlockType(r,T.SelectionState.createEmpty(o),"unstyled"),c=(l=l.createEntity(" ","MUTABLE",{})).getLastCreatedEntityKey();return l=T.Modifier.replaceText(l,T.SelectionState.createEmpty(o).merge({focusOffset:a.getLength()}),i,null,c),T.EditorState.push(e,l,"change-block-type")},cr=function(e,t){var n=e.getCurrentContent(),r=t||e.getSelection(),o=r.getStartOffset(),a=r.getEndOffset(),i=n.getBlockForKey(r.getStartKey()).getEntityAt(o),l=n.getBlockForKey(r.getEndKey()).getEntityAt(a),c=i&&i===l&&n.getEntity(i);if(c&&"link"===c.type.toLowerCase())return i;var u=n.getBlockForKey(r.getEndKey()).getEntityAt(a>0?a-1:a),s=(i&&!l&&i===u||r.isCollapsed())&&u&&n.getEntity(u);return s&&"link"===s.type.toLowerCase()?u:null},ur=function(e,t,n){var r=cr(e);return r?Object(nr.a)(e,t,n,r):Gn(e,t,n)},sr=["store","getLink"],dr=["entityKey"];function fr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var gr=function(e,t){var n=e.getCurrentContent(),r=e.getSelection();return Zn(n,r.focusKey,t)},pr=function(e){return/^https?:/.test(e)},hr=function(e,t){var n=e.getCurrentContent();if(!t.isCollapsed())return!1;var r=n.getBlockForKey(t.focusKey);if(t.focusOffset!==r.getLength())return!1;var o=cr(e,t);if(!o)return!1;var a=n.getEntity(o);if(a&&"link"===a.type.toLowerCase()&&pr(a.data.url)){var i=Zn(n,r.key,o).text;return r.getText()===i}return!1},mr=function(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},yr=function(e){f()(n,e);var t=fr(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={isOpen:!1,entityKey:null},e.open=function(){e.setState({isOpen:!0})},e.close=function(){e.setState({isOpen:!1})},e.handleLinkSubmit=function(t){var n,r=t.text,o=t.url,a=e.state.entityKey,i=e.props,l=i.store,c=i.onSubmit,u=l.getEditorState();if(a){var s=$n(u,a);n=Object.assign(Object.assign({},s),{},{url:o}),s.url!==o&&er(o).then((function(e){var t=rr(l.getEditorState(),a,e);t&&l.setEditorState(t)})).catch((function(){}))}else n={url:o},w.a.trackEvent(l.getEditorRef(),{id:169});l.setEditorState(ur(u,r,n)),c()},e}return c()(n,[{key:"getDefaultValues",value:function(){var e=this.props.store,t=this.state.entityKey,n=e.getEditorState(),r=n.getSelection(),o=n.getCurrentContent();if(!t)return r.focusKey!==r.anchorKey?null:{defaultText:o.getBlockForKey(r.focusKey).getText().slice(r.getStartOffset(),r.getEndOffset())};var a=$n(n,t).url,i=a,l=o.getBlockForKey(r.focusKey);return l.findEntityRanges((function(e){return e.getEntity()===t}),(function(e,t){i=l.getText().slice(e,t)})),{defaultText:i,defaultUrl:a}}},{key:"render",value:function(){var e=this.state.isOpen;return Object(Z.g)(jn,E()({},this.getDefaultValues(),{onClose:this.close,onSubmit:this.handleLinkSubmit,visible:e}))}}]),n}(C.a.Component),vr=function(e){f()(n,e);var t=fr(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={isOpen:!1,text:"",entityData:{}},e.handleClick=function(t){if(e.state.isOpen){var n=e.props.store,r=Object(cn.findDOMNode)(n.getEditorRef());e.bubbleEl&&!e.bubbleEl.contains(t.target)&&r&&!r.contains(t.target)&&e.setState({isOpen:!1})}},e.handleRef=function(t){e.bubbleEl=t,t?document.addEventListener("click",e.handleClick):document.removeEventListener("click",e.handleClick)},e}return c()(n,[{key:"render",value:function(){var e=this.state,t=e.isOpen,n=e.text,r=e.entityData,o=this.props,a=(o.store,o.getLink),i=V()(o,sr),l=a();return Object(Z.g)(zn,E()({},i,{isOpen:t,link:l,text:n,entityData:r,onRef:this.handleRef,allowLinkCard:r.url&&pr(r.url)&&this.props.allowLinkCard}))}}]),n}(C.a.Component),br={decorator:function(e){return e},allowLinkCard:!1},Cr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign(Object.assign({},br),e);var t,n,r,o,a={},i={},l=!1,c=function(e){l=!0,o=setTimeout((function(){l=!1,e()}),150)},u=function(){l=!1,clearTimeout(o)},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.getEditorState();r=cr(e);var o=Boolean(r);t&&t.setState({entityKey:r}),n&&n.setState({isOpen:o,entityData:o?$n(e,r):{},text:o?gr(e,r).text:""})},d=Oe(fn,e.decorator),f=d(Sn);return{decorators:[{strategy:xe("link","LINK"),component:function(e){var t=e.entityKey,n=V()(e,dr);return Object(Z.g)(hn,E()({},n,{entityKey:t,ref:function(e){i[t]=e}}))}}],blockRendererFn:function(t,n){var r=n.getEditorState;if("atomic"===t.getType()){var o=r().getCurrentContent(),a=t.getEntityAt(0);if(!a)return console.warn("Entity not found",t),null;var l=o.getEntity(a);if("link"===l.getType().toLowerCase()){var c=l.getData();return{editable:!1,component:f,props:{data:c,entityKey:a,newLinkCard:e.newLinkCard,text:Zn(r().getCurrentContent(),t.key,a).text,onRef:function(e){i[a]=e}}}}}return null},components:[Object(Z.g)(yr,{key:"link_modal",store:a,onSubmit:function(){setTimeout(s)},ref:function(e){t=e}}),Object(Z.g)(vr,{key:"link_bubble",store:a,entityKey:r,allowLinkCard:e.allowLinkCard,getLink:function(){return i[r]},onEdit:function(){t.open()},onConvertToText:function(e){var t=e.isCard,n=a.getEditorState();t?a.setEditorState(lr(n,r,e)):a.setEditorState(ir(n,r,e))},onToggle:function(e){var t=a.getEditorState();e.isCard?(a.setEditorState(ar(t,r,e)),w.a.trackEvent(a.getEditorRef(),{id:640})):(a.setEditorState(or(t,r,a)),w.a.trackEvent(a.getEditorRef(),{id:170}))},ref:function(e){n=e},useV2Feature:e.useV2Feature})],handleBeforeInput:function(e,t,n){if(!this.isEnabled())return"not-handled";if(" "===e){var r=Yn(t);if(r)return r=Object(Qe.a)(r," "),a.setEditorState(r),w.a.trackEvent(a.getEditorRef(),{id:169}),"handled"}return qn(e,t,n)},handlePastedText:function(e,t,n){var r=n.getSelection();if(r.isCollapsed())return"not-handled";if(r.focusKey!==r.anchorKey)return"not-handled";var o=wn.a.match(e);if(!o||1!==o.length||0!==o[0].index||o[0].lastIndex!==e.length)return"not-handled";var i=n.getCurrentContent().getBlockForKey(r.focusKey).getText().slice(r.getStartOffset(),r.getEndOffset()),l=ur(n,i,{url:o[0].url});return a.setEditorState(l),setTimeout(s),"handled"},keyBindingFn:function(e){if(75===e.keyCode&&T.KeyBindingUtil.hasCommandModifier(e))return"insert-link"},isEnabled:function(){return"code-block"!==T.RichUtils.getCurrentBlockType(a.getEditorState())},handleCommand:function(n){if(!this.isEnabled())return"not-handled";if("split-block"===n){var r=a.getEditorState(),o=r.getSelection();if(e.allowLinkCard&&hr(r,o)){var i=cr(r,o);return a.setEditorState(or(r,i,a)),w.a.trackEvent(a.getEditorRef(),{id:170}),"handled"}var l=Yn(r);if(l){if(w.a.trackEvent(a.getEditorRef(),{id:640}),e.allowLinkCard&&hr(l,o)){var c=l.getCurrentContent().getLastCreatedEntityKey();a.setEditorState(or(l,c,a)),w.a.trackEvent(a.getEditorRef(),{id:170})}else{var u=T.Modifier.splitBlock(l.getCurrentContent(),l.getSelection());l=T.EditorState.push(l,u,"split-block"),a.setEditorState(l)}return"handled"}}if("insert-link"===n&&t)return t.open(),"handled";if(n.startsWith("insert-link:")){var s=n.replace("insert-link:","");if(s&&pr(s)){var d=a.getEditorState();return a.setEditorState(Gn(d,"",{url:s})),"handled"}return"not-handled"}if(n.startsWith("insert-link-card:")){var f=n.replace("insert-link-card:","");if(f&&pr(f)){var g=a.getEditorState(),p=(g=Gn(g,"",{url:f})).getCurrentContent().getLastCreatedEntityKey();return a.setEditorState(or(g,p,a)),"handled"}return"not-handled"}return"not-handled"},onFocus:function(){c(s)},onBlur:function(){u()},onChange:function(e,t){return l||setTimeout(s),Vn(e)},initialize:function(e){var t=e.getEditorRef,n=e.getEditorState,r=e.setEditorState;a.getEditorRef=t,a.getEditorState=n,a.setEditorState=r},draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1],i=o.type,l=o.data;return"link"===i.toLowerCase()?l.isCard?l.image?l.entityType?sn.a.renderToStaticMarkup(Object(Z.g)("a",{href:l.url,"data-draft-node":"block","data-draft-type":"link-card","data-image":l.image,"data-image-width":l.imageWidth,"data-image-height":l.imageHeight,"data-entity-type":l.entityType,"data-entity-data":JSON.stringify(l.entityData),dangerouslySetInnerHTML:{__html:a}})):sn.a.renderToStaticMarkup(Object(Z.g)("a",{href:l.url,"data-draft-node":"block","data-draft-type":"link-card","data-image":l.image,"data-image-width":l.imageWidth,"data-image-height":l.imageHeight,dangerouslySetInnerHTML:{__html:a}})):sn.a.renderToStaticMarkup(Object(Z.g)("a",{href:l.url,"data-draft-node":"block","data-draft-type":"link-card",dangerouslySetInnerHTML:{__html:a}})):sn.a.renderToStaticMarkup(Object(Z.g)("a",{href:l.url,dangerouslySetInnerHTML:{__html:a}})):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];return Fe(a)&&"link-card"===a.getAttribute("data-draft-type")?T.Entity.create("link","IMMUTABLE",{url:a.getAttribute("href"),isCard:!0,image:a.getAttribute("data-image"),imageWidth:a.getAttribute("data-image-width"),imageHeight:a.getAttribute("data-image-height"),entityType:a.getAttribute("data-entity-type"),entityData:mr(a.getAttribute("data-entity-data"))}):"a"===o?T.Entity.create("link","MUTABLE",{url:a.href}):e.apply(void 0,n)}}},toolbar:{section:Xe.a.BASIC_MEDIA,label:"插入链接",text:"链接",shortcut:"⌘+K",icon:dn.a,commandName:"insert-link",priority:1},toolbarV2:{section:W.a.BASIC_MEDIA,label:"插入链接",text:"链接",shortcut:"⌘+K",icon:dn.a,commandName:"insert-link",priority:1}}},Sr=n(2777),Er=n(1093);function kr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Or=function(e){f()(n,e);var t=kr(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={isModalShow:!1},e.check=function(t){var n=e.props.type;N.a.get("Editable::watermarkHintHasShown:".concat(n))?t():(e.setState({isModalShow:!0}),e.nextFunction=t)},e.handleCloseModal=function(){var t=e.props.type;e.setState({isModalShow:!1}),N.a.set("Editable::watermarkHintHasShown:".concat(t),!0),e.nextFunction()},e}return c()(n,[{key:"render",value:function(){var e=this.state.isModalShow;return e?Object(Z.g)(kn.b,{className:"WatermarkHint-Modal",maskClosable:!1,onClose:this.handleCloseModal},e&&Object(Z.g)("div",{className:"WatermarkHint-modalContent"},Object(Z.g)("div",{className:"WatermarkHint-modalBody"},Object(Z.g)("img",{src:"//zhstatic.zhihu.com/editor/watermarkhint.png",width:"198"}),Object(Z.g)("h1",{className:"WatermarkHint-modalTitle"},"知乎上线图片水印功能"),Object(Z.g)("p",null,"为了维护你的内容版权，发布后图片会在右下角增加水印"),Object(Z.g)("p",null,"你可以在知乎最新版 App 的「设置」页面进行管理。")),Object(Z.g)(kn.a,null,Object(Z.g)(P.c,{preset:"primary",color:"blue",onClick:this.handleCloseModal},"我知道了")))):null}}]),n}(b.Component),wr=function(e,t,n){var r=e.getCurrentContent().mergeEntityData(t,n),o=T.EditorState.set(T.EditorState.push(e,r,"apply-entity"),{lastChangeType:"apply-entity"});return T.EditorState.forceSelection(o,e.getSelection())},Tr=n(1281);function jr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Mr=function(e){f()(n,e);var t=jr(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.style,r=e.onClick,o=e.onMouseDown,a=e.data,i=e.isBlock;return Object(Z.g)("img",{className:M()("Image",t,{"Image--isBlock":i}),style:n,src:a.src,alt:a.alt,width:a.width,height:a.height,onClick:r,onMouseDown:o,onLoad:this.handleLoad,"data-size":a.size,"data-rawwidth":a.rawWidth,"data-rawheight":a.rawHeight,"data-watermark":a.watermark,"data-original-src":a.originalSrc,"data-watermark-src":a.watermarkSrc,"data-private-watermark-src":a.privateWatermarkSrc})}}]),n}(C.a.Component);Mr.defaultProps={isBlock:!0};var Br=Mr,Ar=n(1761),Rr=n(365),Lr=n(1066);function Ir(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var xr=function(e){f()(n,e);var t=Ir(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={isCaptionEditing:!1,captionPosition:null,editingCaption:null},e.handleLoad=function(t){var n=t.target,r=n.width,o=n.height;e.props.onImageLoaded&&e.props.onImageLoaded({width:r,height:o})},e.handleCaptionClick=function(t){t.preventDefault(),e.startCaptionEditing()},e.handleCaptionMouseDown=function(e){e.preventDefault()},e.handleCaptionInputChange=function(){e.editCaption()},e.handleCaptionInputKeyDown=function(t){13!==t.keyCode&&27!==t.keyCode||(t.preventDefault(),e.endCaptionEditing({save:13===t.keyCode,focus:13===t.keyCode}))},e.handleCaptionInputBlur=function(){e.endCaptionEditing()},e}return c()(n,[{key:"getCaptionPosition",value:function(){var e=this.caption.getBoundingClientRect();return{left:window.pageXOffset+e.left,top:window.pageYOffset+e.top,width:e.width,height:e.height}}},{key:"adjustCaptionHeight",value:function(){this.captionInput.style.height="0";var e=Math.max(this.captionInput.scrollHeight,21);this.caption.style.height="".concat(e,"px"),this.captionInput.style.height="".concat(e,"px")}},{key:"startCaptionEditing",value:function(){var e=this;this.setState({isCaptionEditing:!0,captionPosition:this.getCaptionPosition(),editingCaption:Object(Rr.cutStringWidth)(this.props.data.caption||"",280)},(function(){e.captionInput.focus(),e.captionInput.select(),requestAnimationFrame((function(){e.setState({captionPosition:e.getCaptionPosition()})}))}))}},{key:"editCaption",value:function(){var e=this,t=this.captionInput.value,n=Object(Rr.cutStringWidth)(t.replace(/\n/g,""),280);n===t&&this.adjustCaptionHeight(),this.setState({editingCaption:n},(function(){n!==t&&e.adjustCaptionHeight()}))}},{key:"endCaptionEditing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.save,n=void 0===t||t,r=e.focus,o=void 0!==r&&r;if(this.caption.style.height=null,n){var a=this.state.editingCaption;this.props.onImageCaptionChange&&this.props.onImageCaptionChange(a,o)}this.setState({isCaptionEditing:!1})}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.isFocused,o=t.allowImageCaption,a=this.state,i=a.isCaptionEditing,l=a.captionPosition;return Object(Z.g)("div",{className:"Image-captionContainer","data-size":n.size},Object(Z.g)("div",null,this.props.children),o&&(n.caption||r||i)&&Object(Z.g)("figcaption",{ref:function(t){t&&(e.caption=t)},className:M()("Image-caption",{"is-editing":i,"is-placeholder":!n.caption}),onClick:this.handleCaptionClick,onMouseDown:this.handleCaptionMouseDown},n.caption||"添加图片注释，不超过 140 字（可选）"),i&&Object(Z.g)(ct.a,null,Object(Z.g)(Lr.a,null,Object(Z.g)("div",{className:"Image-captionInput",style:l},Object(Z.g)("textarea",{ref:function(t){return e.captionInput=t},type:"text",placeholder:"添加图片注释，不超过 140 字（可选）",value:this.state.editingCaption,onChange:this.handleCaptionInputChange,onBlur:this.handleCaptionInputBlur,onKeyDown:this.handleCaptionInputKeyDown})))))}}]),n}(C.a.Component);xr.decorate=function(e){return function(t){return Object(Z.g)(xr,t,Object(Z.g)(e,t))}};var Nr=xr,Pr=n(2773),Dr=n(2774),Kr=n(2775),Fr=n(2776),zr=n(27),Ur=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vr=function(e){return C.a.createElement(zr.a,Ur({fill:"currentColor"},e),C.a.createElement("path",{d:"M17.274 1.812A1 1 0 0 1 18.6 1.7l2 1.5a1 1 0 0 1 .244 1.337l-6.042 9.494c.129.468.198.96.198 1.469 0 1.81-.768 3.22-1.938 4.156C11.918 20.57 10.436 21 9 21c-1.652 0-3.305-.41-4.572-1.043-.633-.317-1.21-.71-1.643-1.173C2.357 18.326 2 17.718 2 17a1 1 0 0 1 1-1c.26 0 .46 0 .635-.018a.904.904 0 0 0 .293-.064l.005-.002a.02.02 0 0 0 .007-.01c.014-.025.06-.135.06-.406A5.5 5.5 0 0 1 9.5 10h.017l7.757-8.188zm-5.477 8.69a5.518 5.518 0 0 1 1.935 1.485l4.803-7.547a.25.25 0 0 0-.061-.335l-.183-.137a.25.25 0 0 0-.331.029L11.797 10.5zM6 15.5a3.5 3.5 0 1 1 7 0c0 1.19-.482 2.03-1.187 2.594-.731.585-1.75.906-2.813.906-1.348 0-2.695-.34-3.678-.832a5.22 5.22 0 0 1-.515-.293c-.062-.04-.052-.135.015-.168.361-.18.68-.466.894-.88C5.92 16.433 6 15.98 6 15.5z",fillRule:"evenodd",clipRule:"evenodd"}))};Vr.defaultProps={name:"Brush"};var qr=Vr;function _r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Hr=[{name:"small",icon:Pr.a,text:"居中",condition:function(e){return e.data.rawWidth>=600}},{name:"normal",text:"全宽",icon:Dr.a},{name:"left",icon:Kr.a,text:"左对齐",condition:function(e){return e.allowFloatImage}},{name:"right",icon:Fr.a,text:"右对齐",condition:function(e){return e.allowFloatImage}}],Gr={name:"k008qs",styles:"display:flex;"},Wr={name:"k008qs",styles:"display:flex;"},Yr={name:"k008qs",styles:"display:flex;"},Jr=function(e){f()(n,e);var t=_r(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).changeSize=function(t){e.props.onImageSizeChange&&e.props.onImageSizeChange(t)},e}return c()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.isFocused,o=t.handleShowImageEditor,a=t.allowImageEditor,i=t.useV2Feature,l=Hr.filter((function(t){return!t.condition||t.condition(e.props)}));return Object(Z.g)(B.b,{block:"ImageTools"},Object(Z.g)("div",{className:"Image-resizerContainer","data-size":n.size},Object(Z.g)("div",{ref:function(t){return e.target=t}},this.props.children),Object(Z.g)(Ln.a,{target:this.target,isOpen:r&&(l.length>1||a&&i),repositionKey:n.size,placement:"top",arrowed:!i,onMouseDown:function(e){return e.preventDefault()}},Object(Z.g)("div",{className:"Image-resizer",css:Gr},Object(Z.g)(B.e,{zaType:"Popup"}),i&&Object(Z.g)(B.c,{as:P.c,shouldTrackClick:!0,zaText:!0,zaType:"Button",preset:"plain",className:M()("Image-editButton"),css:Wr,onClick:function(){o(n.originalSrc)}},Object(Z.g)(qr,null),Object(Z.g)("span",null,"图片编辑")),l.map((function(t){return Object(Z.g)(B.c,{as:P.c,zaType:"Button",zaText:t.text,shouldTrackClick:!0,key:t.name,preset:"plain",className:M()("Image-resizerButton",{"is-active":n.size===t.name}),css:Yr,onClick:function(){return e.changeSize(t.name)}},Object(Z.g)(t.icon,null),i&&Object(Z.g)("span",null,t.text))}))))))}}]),n}(C.a.Component);Jr.decorate=function(e){return function(t){return Object(Z.g)(Jr,t,Object(Z.g)(e,t))}};var Zr=Jr,$r=n(61);var Xr="Editor::toolbarImageEditorAttentionShown",Qr={name:"q7m2vl",styles:"white-space:nowrap;line-height:40px;font-size:14px;"};function eo(e){var t=e.children,n=Object(b.useState)(!1),r=qt()(n,2),o=r[0],a=r[1],i=Object(b.useRef)(null);return Object(b.useEffect)((function(){N.a.get(Xr)||(a(!0),N.a.set(Xr,!0),setTimeout((function(){a(!1)}),5e3))}),[]),Object(Z.g)(C.a.Fragment,null,Object(Z.g)("div",{className:"ImageEditorGuide-Container",ref:i},t),Object(Z.g)(Ln.a,{target:i.current,isOpen:o,placement:"top",arrowed:!0,css:function(e){return{"&.Popover-content":{background:e.colors.GBL01A},".Popover-arrow::after":{background:e.colors.GBL01A}}}},Object(Z.g)($r.Text,{px:"16px",color:"GBK99A",css:Qr},"点击图片可以进行编辑")))}eo.decorate=function(e){return function(t){return t.data.shouldShowImageEditorGuide?Object(Z.g)(eo,t,Object(Z.g)(e,t)):Object(Z.g)(e,t)}};var to=n(1388),no=n(290),ro=n(1139),oo=["image/webp","image/jpg","image/jpeg","image/png","image/gif"],ao=function(e){return!/(zhihu|zhimg)\.com/.test(e.src)},io=function(e,t){return Object.keys(e).reduce((function(n,r){var o=e[r];return t(o)&&(n[r]=o),n}),{})},lo={decorator:function(e){return e},allowImageCaption:!1},co=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign(Object.assign({},lo),e);var t={},n=Object(b.createRef)(null),r=Object(b.createRef)(null),a=Oe(fn,e.decorator),i=Oe.apply(void 0,o()([a,e.allowResizeImage&&Zr.decorate,Nr.decorate,e.allowImageEditor&&eo.decorate].filter(Boolean)))(Br),l=a(Ar.a),c=function(e,n){C?S=Object(be.a)(S,"image","IMMUTABLE",Object.assign({upload:e,size:"normal"},n)):t.setEditorState(Object(be.a)(t.getEditorState(),"image","IMMUTABLE",Object.assign({upload:e,size:"normal"},n)))},u=function(e,n){t.setEditorState(Object(Tr.a)(t.getEditorState(),e,Object.assign(Object.assign({},n),{},{size:"normal",shouldShowImageEditorGuide:!0})))},s=function(e,n){t.setEditorState(wr(t.getEditorState(),e,{error:n}))},d=function(e,n){t.setEditorState(wr(t.getEditorState(),e,n))},f=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t.getEditorState(),a=T.EditorState.set(wr(o,e,{caption:n}),{selection:o.getSelection()});if(r){var i=a.getCurrentContent(),l=i.getBlockMap().findKey((function(t){return"atomic"===t.getType()&&t.getEntityAt(0)===e}));if(l){var c=i.getKeyAfter(l);a=T.EditorState.forceSelection(a,new T.SelectionState({hasFocus:!0,anchorKey:c,anchorOffset:0,focusKey:c,focusOffset:0}))}}t.setEditorState(a)},g=function(){r.current.value=null,e.editingContentType?n.current.check((function(){r.current.click()})):r.current.click()},p=function(e){return new Promise((function(t,n){var r=document.createElement("img");r.src=e,r.setAttribute("src",e),r.complete?t(r):r.onload=function(){t(r)},r.onerror=function(e){n(e)}}))},h=function(e,n){t.setEditorState(wr(t.getEditorState(),e,{size:n}))},m=function(t,n){e.onImageUpload&&c({type:"file",value:t},n)},y=function(t){for(var n=function(n){Object(Er.b)({file:t[n],preset:Er.a.content}).then((function(){"image/gif"!==t[n].type?Object(no.a)(t[n]).then((function(e){return m(e)})):Object(no.a)(t[n]).then((function(t){p(window.URL.createObjectURL(t)).then((function(e){m(t,{rawWidth:e.width,rawHeight:e.height})})).catch((function(){e.uploadImageError("other")}))}))})).catch((function(t){e.uploadImageError(t)}))},r=0;r<t.length;r++)n(r)},v=function(e){E((function(){y(e.target.files)}))},C=!1,S=null,E=function(e){C=!0,S=t.getEditorState(),e(),t.setEditorState(S),C=!1};return e.uploadManager.on("error",(function(t,n){"image"===n&&e.disableImageUpload||e.onUploadError(t,n)})),Object.assign(Object.assign({initialize:function(e){Object.assign(t,e)},batched:E,insertImage:c,handlePastedFiles:function(t){if(e.disableImageUpload)return"not-handled";var n=t.length;return(t=t.filter((function(e){return oo.includes(e.type)}))).length&&E((function(){y(t)})),t.length!==n&&e.uploadImageError("type"),"handled"},handleDroppedFiles:function(t){var n=t.length;(t=t.filter((function(e){return oo.includes(e.type)}))).length&&E((function(){y(t)})),t.length!==n&&e.uploadImageError("type")},getImages:function(e){return Object(ro.a)(t.editorState()).filter((function(t){if("image"===t.getType()||"IMAGE"===t.getType()){var n=t.getData();switch(e){case"upload":return Boolean(n.upload&&!n.error);case"error":return Boolean(n.error);default:return!0}}return!1}))},blockRendererFn:function(t,n){var r=n.getEditorState;if("atomic"===t.getType()){var o=r().getCurrentContent(),a=t.getEntityAt(0);if(!a)return console.warn("Entity not found",t),null;var c=o.getEntity(a),g=c.getType();if("image"===g||"IMAGE"===g){var p=c.getData();return p.upload?{editable:!1,component:l,props:{data:p,uploadManager:e.uploadManager,disableImageUpload:e.disableImageUpload,onImageUploaded:function(e){return u(a,e)},onImageUploadError:function(e){return s(a,e)}}}:{editable:!1,component:i,props:{data:p,allowFloatImage:e.allowFloatImage,allowImageCaption:e.allowImageCaption,allowImageEditor:e.allowImageEditor,onImageLoaded:function(e){return d(a,e)},onImageCaptionChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f.apply(void 0,[a].concat(t))},onImageSizeChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.apply(void 0,[a].concat(t))},useV2Feature:e.useV2Feature,handleShowImageEditor:function(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e).handleShowImageEditor.apply(t,[a].concat(r))}}}}}return null},handleCommand:function(t){return"insert-image"===t?e.disableImageUpload?(e.uploadImageError("disable-question-answer-image-upload"),"not-handled"):(g(),"handled"):"not-handled"},components:[e.editingContentType&&Object(Z.g)(Or,{key:"watermark_hint",type:e.editingContentType,ref:n}),Object(Z.g)("input",{key:"image_input",multiple:!0,type:"file",style:{display:"none"},accept:oo,ref:r,onChange:v})].filter(Boolean),draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"image"===o.type?o.data.upload?" ":o.data.rawWidth&&o.data.rawHeight?sn.a.renderToStaticMarkup(Object(Z.g)("img",{src:o.data.src,"data-caption":o.data.caption||"","data-size":o.data.size||"normal","data-rawwidth":o.data.rawWidth,"data-rawheight":o.data.rawHeight,"data-watermark":o.data.watermark||"","data-original-src":o.data.originalSrc||"","data-watermark-src":o.data.watermarkSrc||"","data-private-watermark-src":o.data.privateWatermarkSrc||""})):sn.a.renderToStaticMarkup(Object(Z.g)("img",{src:o.data.src,"data-caption":o.data.caption||"","data-size":o.data.size||"normal"})):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];if("img"===o){var i;if(Ke(a)){var l=a.src,c=a.getAttribute("data-caption")||"",u=a.getAttribute("data-size")||"normal",s=a.width,d=a.height,f=parseInt(a.getAttribute("data-rawwidth"),10),g=parseInt(a.getAttribute("data-rawheight"),10),p=a.getAttribute("data-watermark"),h=a.getAttribute("data-original-src"),m=a.getAttribute("data-watermark-src"),y=a.getAttribute("data-private-watermark-src"),v=io({src:l,caption:c,size:u,width:s,height:d,rawWidth:f,rawHeight:g,watermark:p,originalSrc:h,watermarkSrc:m,privateWatermarkSrc:y},Boolean);ao(a)&&(v.upload={type:"url",value:l}),i=T.Entity.create("image","IMMUTABLE",v)}else"import_image_fail"===a.getAttribute("data-image-status")&&(i=T.Entity.create("image","IMMUTABLE",{src:a.src,error:{status:"import_image_fail",message:"图片导入失败"}}));return i}return e.apply(void 0,n)}}}},!e.hideImageToolbar&&{toolbar:{section:Xe.a.BASIC_MEDIA,label:"上传图片",icon:Sr.a,commandName:"insert-image",priority:2}}),!e.hideImageToolbar&&{toolbarV2:[{name:"image",isMenuToggler:!0,icon:Sr.a,label:"图片",Component:to.a,section:W.a.BASIC_MEDIA,priority:2},{section:W.a.BASIC_MEDIA,parentName:"image",label:"上传图片",text:"图片",menuItemText:"上传图片",icon:Sr.a,commandName:"insert-image",priority:1}]})},uo=n(44);var so={name:"mnyjqd",styles:"width:640px;.Modal-content{margin-top:0;padding:0;}"},fo=Object(b.forwardRef)((function(e,t){var r=e.handleImageEntityChange,o=e.uploadManager,a=Object(b.useState)(!1),i=qt()(a,2),l=i[0],c=i[1],u=Object(b.useState)(null),s=qt()(u,2),d=s[0],f=s[1],g=Object(b.useRef)(null);Object(b.useImperativeHandle)(t,(function(){return{handleShowImageEditor:function(e,t){c(!0),g.current=e,f(t)}}}),[]);var p=Object(uo.e)((function(){return Promise.all([n.e(62),n.e(73),n.e(60)]).then(n.bind(null,2854))}),l);return Object(Z.g)(kn.b,{onClose:function(){c(!1)},css:so},Boolean(l&&p)&&Object(Z.g)(p,{uploadManager:o,imageUrl:d,onClose:function(e){if(c(!1),null!=g.current&&e){var t=e.url,n=e.originalSrc,o=e.watermarkSrc,a=e.privateWatermarkSrc,i=e.watermark,l=e.rawWidth,u=e.rawHeight,s=e.id;r(g.current,{src:t,originalSrc:n,watermarkSrc:o,privateWatermarkSrc:a,watermark:i,rawWidth:l,rawHeight:u,id:s})}g.current=null}}))})),go=function(e){var t=e.uploadManager,n=C.a.createRef(null),r={handleShowImageEditor:function(){var e,t;return null===(t=n.current)||void 0===t?void 0:(e=t).handleShowImageEditor.apply(e,arguments)}};return{store:r,components:[{component:Object(Z.g)(fo,{ref:n,uploadManager:t,key:"imageEditor",handleImageEntityChange:function(e,t){var n=r.getEditorState();r.setEditorState(wr(n,e,t))}}),priority:1}],initialize:function(e){Object.assign(r,e)}}},po=n(886),ho=n(939);function mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var yo={video:"视频",poster:"封面",name:"标题"},vo=function(e){f()(n,e);var t=mo(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props.data;return Object(Z.g)("div",{className:"Editable-videoCensorList"},e.map((function(e){return Object(Z.g)("div",{className:"Editable-videoCensorItem",key:e},Object(Z.g)("span",null,"「",yo[e],"」"),"审核未通过，请更改后重新提交")})))}}]),n}(b.Component),bo=n(1335);function Co(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var So=function(e){f()(n,e);var t=Co(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.className,r=e.onClick,o=e.onMouseDown,a=e.allowVideoTitleChange,i=e.handleVideoTitleChange,l=e.handleVideoPosterChange,c=e.isProduction,u=e.isVideoAnswer,s=e.isFullWidth,d=e.duration;return Object(Z.g)("div",{className:M()("Editable-video",n,{"Editable-video--titleError":t.censorItems&&t.censorItems.includes("name"),"Editable-video--posterError":t.censorItems&&t.censorItems.includes("poster"),"is-videoAnswer":u}),onClick:r,onMouseDown:o},Object(Z.g)(ho.b,E()({},t,t.isLens&&{playerUrl:"https://www.zhihu.com/video/".concat(t.id)},{interactive:!(!u||!s),showPlayButton:!u,isVideoAnswer:u,rightBottomButton:Object(Z.g)(bo.a,E()({triggerClassName:M()({"is-videoAnswer":u}),coverButtonText:u?"编辑封面":void 0,onVideoPosterChange:l,isProduction:c},t)),leftBottomButton:u&&Object(Z.g)("div",{className:"Editable-video--duration"},d)},a()&&{isVideoTitleEditable:!0,onVideoTitleChange:i})),t.censorItems&&t.censorItems.length>0&&Object(Z.g)(vo,{data:t.censorItems}))}}]),n}(C.a.Component),Eo=n(1511),ko=n(1131);function Oo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var wo=function(e){f()(n,e);var t=Oo(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.className,r=e.onClick,o=e.onMouseDown,a=e.isVideoAnswer;return Object(Z.g)("div",{className:M()("Editable-videoError",n,{"Editable-videoError--titleError":t.censorItems&&t.censorItems.includes("name"),"is-videAnswer":a}),onClick:r,onMouseDown:o},Object(Z.g)(ko.a,E()({},t,{isVideoAnswer:a})),t.censorItems&&t.censorItems.length>0&&Object(Z.g)(vo,{data:t.censorItems}))}}]),n}(b.Component),To=n(861),jo=n(1234);function Mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Bo=function(e){f()(n,e);var t=Mo(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).handleSwitch=function(){e.input.focus()},e.handleUploaderClick=function(){e.input.click()},e.handleSubmit=function(t){t.preventDefault();var n=e.props,r=n.onSubmit,o=n.onClose,a=n.onError,i=n.onBeforeUpload,l=n.couldSuperVideoUpload;if(r){var c=e.input.files[0];c&&(i&&!i()?a&&a("video-upload-cancelled"):c.size>jo.b&&!l?a&&a("video-size"):c.size<jo.c?a&&a("video-uploading-entity-small"):jo.a.some((function(e){return c.name.toLowerCase().endsWith(e)}))?Object(jo.f)(c).then((function(e){e>jo.d&&!l?a("video-duration"):r({value:c})})):a&&a("video-type"))}o&&o()},e.handleClose=function(){var t=e.props.onClose;t&&t()},e}return c()(n,[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.shown,r=t.onError,o=t.onClose;if(!e.shown&&n){if(!Object(jo.h)())return r("unsupported-browser"),void o();this.input.focus(),w.a.setModule(this.root,{module:"VideoUploadCard"}),w.a.trackCardShow(this.root)}}},{key:"renderTitle",value:function(){return Object(Z.g)("p",{className:"Editable-videoModal-title"},"本地上传")}},{key:"renderFooter",value:function(){return Object(Z.g)("div",null,Object(Z.g)("p",null,"请不要添加无关的视频，详情查看"," ",Object(Z.g)("a",{href:"https://www.zhihu.com/question/20118966",target:"_blank",rel:"noopener noreferrer"},"知乎视频使用规范"),"。"),Object(Z.g)("p",null,"上传视频，即代表你同意",Object(Z.g)("a",{href:"https://www.zhihu.com/terms/video",target:"_blank",rel:"noopener noreferrer"},"《知乎视频用户协议》"),"。"))}},{key:"render",value:function(){var e=this,t=this.props.shown;return Object(Z.g)(kn.b,{className:"Editable-videoModal",overlay:!0,title:this.renderTitle(),footer:this.renderFooter(),onClose:this.handleClose},t&&Object(jo.h)()&&Object(Z.g)("form",{ref:function(t){e.root=t},onSubmit:this.handleSubmit},Object(Z.g)("div",{className:"Editable-videoModal-container"},Object(Z.g)("div",{className:"Editable-videoModal-uploader",onClick:this.handleUploaderClick},Object(Z.g)("div",{className:"Editable-videoModal-uploader-icon"},Object(Z.g)(To.a,{size:70})),Object(Z.g)("div",{className:"Editable-videoModal-uploader-text"},"选择要上传的文件"),Object(Z.g)("div",{className:"Editable-videoModal-uploader-tip"},"请上传时长不超过 60 分钟的视频"),Object(Z.g)("div",{className:"Editable-videoModal-uploader-tip"},"最多上传 10 个视频"),Object(Z.g)("input",{ref:function(t){e.input=t},accept:jo.a,type:"file",required:!0,onChange:this.handleSubmit})))))}}]),n}(b.Component);Bo.propTypes={shown:v.a.bool,onSubmit:v.a.func,onClose:v.a.func,onError:v.a.func,onBeforeUpload:v.a.func},Bo.defaultProps={shown:!1};var Ao=function(e,t){var n=e.onSubmit,r=e.onError,o=e.onBeforeUpload,a=e.couldSuperVideoUpload,i=Object(b.useState)(!1),l=qt()(i,2),c=l[0],u=l[1];return Object(b.useImperativeHandle)(t,(function(){return{onClose:function(){return u(!1)},onOpen:function(){return u(!0)}}}),[]),Object(Z.g)(Bo,{shown:c,onSubmit:n,onClose:function(){return u(!1)},onError:r,onBeforeUpload:o,couldSuperVideoUpload:a})},Ro=Object(b.forwardRef)(Ao),Lo={decorator:function(e){return e}},Io=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign(Object.assign({},Lo),e);var t={},n=Object(b.createRef)(null),r=!1,a=Oe(fn,e.decorator),i=a(So),l=a(Eo.a),c=a(wo),u=function(e,n){t.getEditorRef().props.onChange(wr(t.getEditorState(),e,n))},s=function(e,t){u(e,Object.assign(Object.assign({},t),{},{upload:null,error:null}))},d=function(e){u(e,{error:{status:"upload_fail"}})},f=function(e,n){var r=t.getEditorState().getCurrentContent().getEntity(e).getData();t.setEditorState(wr(t.getEditorState(),e,{thumbnail:n,changedVideoPoster:!0,censorItems:r.censorItems?r.censorItems.filter((function(e){return"poster"!==e})):[]}))},g=function(e,n){var r=t.getEditorState().getCurrentContent().getEntity(e).getData();t.setEditorState(wr(t.getEditorState(),e,{title:n,censorItems:r.censorItems?r.censorItems.filter((function(e){return"name"!==e})):[]}))},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lens";return t.getEditorState?Object(ro.a)(t.getEditorState()).filter((function(t){if("video"===t.getType()||"embedded-video"===t.getType()){var n=t.getData();switch(e){case"upload":return Boolean(n.upload&&!n.error);case"error":return Boolean(n.error);case"error-upload":return Boolean(n.error&&"upload_fail"===n.error.status);case"error-review":return Boolean(n.error&&"reviewing_fail"===n.error.status);case"censor":return Boolean(t.data.censorItems&&t.data.censorItems.length>0);case"lens":return Boolean(n.error||n.upload||n.isLens);default:return!0}}return!1})):null},h=function(e){return p(e).size>0},m=function(n){p("lens").size>=10?e.props.onError&&e.props.onError("video-count"):(r=!0,t.getEditorRef().props.onChange(Object(be.a)(t.getEditorState(),"video","IMMUTABLE",{upload:{file:n.value}})),n.value.size>=5242880&&e.props.requestNotificationPermission())};return e.props.uploadManager.on("end",(function(){r&&(r=!1,setTimeout((function(){h()&&!h("error-upload")&&e.props.showNotification("视频上传成功",e.location,"Success")}),0))})),e.props.uploadManager.on("error",(function(t,n){"video"===n&&e.props.showNotification("视频上传失败",location,"Fail")})),{initialize:function(e){Object.assign(t,e)},handleCommand:function(e,t){return"insert-video-card"===e?(t&&m(t),"handled"):"insert-video"===e?(n.current.onOpen(),"handled"):"not-handled"},blockRendererFn:function(t,n){var r=n.getEditorState;if("atomic"===t.getType()){var o=r().getCurrentContent(),a=t.getEntityAt(0);if(!a)return console.warn("Entity not found",t),null;var u=o.getEntity(a);if("video"===u.getType()){var p=u.getData();return p.upload?(p.uploading=!0,{editable:!1,component:l,props:Object.assign({entityKey:a,data:p,handleVideoPosterChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f.apply(void 0,[a].concat(t))},handleVideoTitleChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return g.apply(void 0,[a].concat(t))},onVideoUploaded:s,handleVideoUploadError:d},e.props)}):p.error?{editable:!1,component:c,props:Object.assign({entityKey:a,data:p,onVideoUploaded:s,handleVideoUploadError:d},e.props)}:(void 0!==p.uploading&&(p.uploading=!1),{editable:!1,component:i,props:Object.assign(Object.assign({entityKey:a,data:p,handleVideoPosterChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f.apply(void 0,[a].concat(t))},onVideoUploaded:s},e.props),{},{handleVideoTitleChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return g.apply(void 0,[a].concat(t))}})})}}return null},draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"video"===o.type||"embedded-video"===o.type?o.data.upload?" ":o.data.error&&o.data.isLens?sn.a.renderToStaticMarkup(Object(Z.g)("a",{className:"unprocessable_video","data-lens-id":o.data.id,"data-lens-status":o.data.error.status,"data-description":o.data.error.message,"data-name":o.data.title,"data-lens-censor-fail-items":o.data.censorItems&&o.data.censorItems.length>0?o.data.censorItems.filter((function(e){return"video"!==e})).join(","):null})):sn.a.renderToStaticMarkup(Object(Z.g)("a",{className:"video-link",href:o.data.url,"data-src":o.data.src||"","data-name":o.data.title||"","data-poster":o.data.thumbnail||"","data-video-id":!o.data.isLens&&o.data.id||"","data-lens-id":o.data.isLens&&o.data.id||"","data-video-playable":o.data.isPlayable,"data-lens-censor-fail-items":o.data.censorItems&&o.data.censorItems.length>0?o.data.censorItems.join(","):null},o.data.title||"")):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[0],i=n[1];if("a"===a&&(i.classList.contains("video-link")||i.classList.contains("video-box")||i.classList.contains("unprocessable_video"))){var l={title:i.getAttribute("data-name"),thumbnail:i.getAttribute("data-poster"),url:i.getAttribute("href"),src:i.getAttribute("data-src"),censorItems:[]};if(l=i.getAttribute("data-lens-id")?Object.assign(Object.assign({},l),{},{isLens:!0,id:i.getAttribute("data-lens-id"),isPlayable:!0}):Object.assign(Object.assign({},l),{},{isLens:!1,id:i.getAttribute("data-video-id"),isPlayable:"true"===i.getAttribute("data-video-playable")}),i.hasAttribute("data-lens-status")&&(l=Object.assign(Object.assign({},l),{},{error:{status:i.getAttribute("data-lens-status"),message:i.getAttribute("data-description")}}),"reviewing_fail"===i.getAttribute("data-lens-status")&&(l=Object.assign(Object.assign({},l),{},{censorItems:["video"]}))),i.getAttribute("data-lens-censor-fail-items")){var c=i.getAttribute("data-lens-censor-fail-items").split(",");l.censorItems.includes("video")&&(c=c.filter((function(e){return"poster"!==e}))),l=Object.assign(Object.assign({},l),{},{censorItems:[].concat(o()(l.censorItems),o()(c))})}return T.Entity.create(l.isLens?"video":"embedded-video","IMMUTABLE",l)}return e.apply(void 0,n)}}},components:[Object(Z.g)(Ro,{ref:n,key:"videoModal_container",onSubmit:m,onError:e.props.onError,onBeforeUpload:e.props.onBeforeUpload,couldSuperVideoUpload:e.props.couldSuperVideoUpload})],getVideos:p,toolbar:{section:Xe.a.BASIC_MEDIA,label:"上传视频",icon:po.a,commandName:"insert-video",priority:3,shouldShow:e.props.getShowToolbarButton},toolbarV2:{section:W.a.BASIC_MEDIA,text:"视频",label:"上传视频",icon:po.a,commandName:"insert-video",priority:3,shouldShow:e.props.getShowToolbarButton}}},xo=n(2778);function No(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Po=function(e){f()(n,e);var t=No(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.onClick,r=e.onMouseDown;return Object(Z.g)("div",{className:M()("Editable-divider",t),onClick:n,onMouseDown:r},Object(Z.g)("hr",null))}}]),n}(C.a.Component),Do={decorator:function(e){return e}},Ko=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign(Object.assign({},Do),e);var t={},n=Oe(fn,e.decorator),r=n(Po),o=function(){var e=t.getEditorState(),n=Object(be.a)(e,"divider","IMMUTABLE");t.setEditorState(n)};return{initialize:function(e){Object.assign(t,e)},keyBindingFn:function(t){return e.useV2Feature&&xt(t)&&83===t.keyCode||Nt(t)&&83===t.keyCode?"insert-divider":void 0},handleCommand:function(e){return"insert-divider"===e?(o(),"handled"):"not-handled"},blockRendererFn:function(e){if("atomic"===e.getType()){var n=t.getEditorState().getCurrentContent(),o=e.getEntityAt(0);if(!o)return console.warn("Entity not found",e),null;if("divider"===n.getEntity(o).getType())return{editable:!1,component:r}}return null},draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"divider"===o.type?"<hr />":e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"hr"===o?T.Entity.create("divider","IMMUTABLE",{}):e.apply(void 0,n)}}},toolbar:{section:Xe.a.STRUCTURE_STYLING,label:"插入分割线",shortcut:"⌘+⇧+S",icon:xo.a,commandName:"insert-divider",priority:3},toolbarV2:{section:W.a.STRUCTURE_GENERATION,label:"插入分割线",shortcut:"⌘+⌥+S",icon:xo.a,commandName:"insert-divider",priority:3}}},Fo=function(e){var t=e.performAction,n=e.scrapeUrl,r=void 0===n?er:n;return{handlePastedText:function(e,n,o,a){var i=a.getEditorRef,l=a.getEditorState,c=a.setEditorState;if(n)return"not-handled";if(!(e&&wn.a.test(e)))return"not-handled";w.a.trackEvent(i(),{id:169});var u=T.ContentState.createFromText(e),s=[];u.getBlocksAsArray().forEach((function(e){var t=e.getText(),n=wn.a.match(t);n&&n.forEach((function(t){var n=(u=u.createEntity("LINK","MUTABLE",{url:t.url})).getLastCreatedEntityKey();u=T.Modifier.applyEntity(u,T.SelectionState.createEmpty(e.key).merge({anchorOffset:t.index,focusOffset:t.lastIndex}),n),s.push({entityKey:n,url:t.url})}))}));var d=Object(kt.a)(o,u.blockMap,u.entityMap);c(d);var f=function(e){return r(e.url,{image:!1}).then((function(t){var n=t.title;if(n&&n!==e.url){var r=l(),o=Object(nr.a)(r,n,{url:e.url},e.entityKey,Jn(r,e.entityKey));c(o)}})).catch((function(){}))};return t((function(){return Promise.all(s.map(f))})),"handled"}}},zo=[],Uo=function(){return{handleReturn:function(e,t,n){var r=n.setEditorState;return e.shiftKey||zo.includes(T.RichUtils.getCurrentBlockType(t))?(r(T.RichUtils.insertSoftNewline(t)),"handled"):"not-handled"}}},Vo=function(e){return{onChange:function(t){var n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=t.getStartKey(),o=t.getEndKey(),a=e.getBlockMap(),i=!1,l=a.skipUntil((function(e){return e.getKey()===r})).takeUntil((function(e){var t=i;return e.getKey()===o&&(i=!0),t}));return l.map((function(e){var n=e.getKey(),a=e.getText(),i=0,l=a.length;return n===r&&(i=t.getStartOffset()),n===o&&(l=t.getEndOffset()),a=a.slice(i,l)})).join(n)}(t.getCurrentContent(),t.getSelection());return e(n),t}}},qo=n(1594),_o=n.n(qo),Ho=n(1377),Go=n.n(Ho),Wo=n(80),Yo=n.n(Wo),Jo=n(297),Zo=function(e,t){var n=e.getCurrentContent(),r=n,o=e.getSelection(),a=n.getBlockForKey(o.focusKey).getText();if("@"===(a&&a.charAt(o.focusOffset-1))){var i=(r=n.createEntity("mention-cancel-token","IMMUTABLE")).getLastCreatedEntityKey();o=o.merge({anchorOffset:o.anchorOffset-1}),r=T.Modifier.replaceText(n,o,"@".concat(t||""),null,i)}var l=T.EditorState.push(e,r,"cancel-mention");return document.activeElement!==document.body&&(l=T.EditorState.forceSelection(l,r.getSelectionAfter())),l},$o=/^[?,.;:!？，。；：、！]$/,Xo=function(e,t){var n=e.getCurrentContent(),r=n,o=e,a=e.getSelection(),i=n.getBlockForKey(a.focusKey).getText(),l=function(e){return!!i&&i.charAt(e)},c=l(a.focusOffset-1),u=l(a.focusOffset-2),s=l(a.focusOffset);"@"===c&&(a=a.merge({anchorKey:a.focusKey,anchorOffset:a.focusOffset-1,focusOffset:a.focusOffset}),r=T.Modifier.replaceText(n,a,""));var d=0!==a.anchorOffset&&("@"!==c&&" "!==c||"@"===c&&" "!==u),f=(r=(r=T.Modifier.replaceText(n,a,d?" ":"")).createEntity("mention","IMMUTABLE",t)).getLastCreatedEntityKey();return r=T.Modifier.insertText(r,r.getSelectionAfter(),"@".concat(t.name),null,f),$o.test(s)||(r=T.Modifier.insertText(r,r.getSelectionAfter()," ")),o=T.EditorState.push(e,r,"insert-characters"),o=T.EditorState.forceSelection(o,r.getSelectionAfter())},Qo=function(e){var t=e.contentState,n=e.entityKey,r=e.children,o=t.getEntity(n).getData(),a=o.id,i=o.urlToken,l=o.isOrg;return Object(Z.g)("a",{className:"member_mention",target:"_blank",rel:"noopener noreferrer","data-hash":a,href:"/".concat(l?"org":"people","/").concat(i)},r)};Qo.propTypes={entityKey:v.a.string.isRequired,contentState:v.a.object.isRequired,children:v.a.node.isRequired};var ea=Qo,ta=function(e){var t=e.children;return Object(Z.g)("span",null,t)};ta.propTypes={children:v.a.node.isRequired};var na=ta;function ra(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var oa=function(e){f()(n,e);var t=ra(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={value:"",userItems:[],styles:{}},e.handleKeyDown=function(t){var n=e.state.value,r=e.props.onCancelMention;8!==t.keyCode&&13!==t.keyCode&&32!==t.keyCode||n?27===t.keyCode&&r(n):(t.preventDefault(),r())},e.handleChange=function(t){e.safeSetState({value:t});var n=e.props,r=n.source,o=n.itemsFilter;r(t).then((function(t){e.safeSetState({userItems:o(t,s()(e))})}))},e.handleSelect=function(t,n){e.props.onSelectItem(n)},e.handleBlur=function(){e.props.onCancelMention(e.state.value)},e}return c()(n,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){e.updateStyles(),e.autoComplete&&e.autoComplete.inputNode.focus()}))}},{key:"componentWillUnmount",value:function(){this.isUnmouted=!0}},{key:"safeSetState",value:function(e){this.isUnmouted||this.setState(e)}},{key:"updateStyles",value:function(){this.safeSetState({styles:Object.assign(Object.assign({},this.calcInputPosition()),this.calcTargetFontStyles())})}},{key:"calcTargetFontStyles",value:function(){var e=this.props.target;return{fontSize:e?window.getComputedStyle(e).fontSize:"inherit"}}},{key:"calcInputPosition",value:function(){var e=this.element,t=this.props.target;if(!e||!t)return null;var n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return{left:n.right+1,top:window.pageYOffset+n.top+(n.height-r.height)/2}}},{key:"render",value:function(){var e=this,t=this.state,n=t.value,r=t.userItems,o=t.styles;return Object(Z.g)("div",{className:"MentionSuggestions",style:o,ref:function(t){e.element=t}},Object(Z.g)(lt.b,{value:n,ref:function(t){e.autoComplete=t},onChange:this.handleChange,items:r,menuProps:{targetContainerMinHeight:300,menuClassName:"MentionSuggestions-menu"},inputProps:{placeholder:"想用 @ 提到谁？",className:"MentionSuggestions-input",onKeyDown:this.handleKeyDown},onSelect:this.handleSelect,onBlur:this.handleBlur,renderItem:function(e){return Object(Z.g)(lt.a,e)}}))}}]),n}(b.Component);oa.contextTypes={currentUser:v.a.object},oa.propTypes={source:v.a.func.isRequired,target:v.a.object,onSelectItem:v.a.func.isRequired,onCancelMention:v.a.func.isRequired},oa.defaultProps={itemsFilter:function(e,t){var n=t.currentUser,r=void 0===n?{}:n;return e.filter((function(e){return e.urlToken!==r.urlToken})).slice(0,6)}};var aa=["children"];function ia(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var la=function(e){f()(n,e);var t=ia(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,r=V()(t,aa);return Object(Z.g)("span",null,Object(Z.g)("span",{ref:function(t){e.target=t}},n),this.target&&Object(Z.g)(ct.a,null,Object(Z.g)(Lr.a,null,Object(Z.g)(oa,E()({},r,{target:this.target})))))}}]),n}(b.Component);la.propTypes={children:v.a.node};var ca=/@/g,ua={source:Jo.a},sa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Yo()({},ua,e);var t={},n=function(e){var n=Object.assign({},e),r=t.getEditorState();t.setEditorState(Xo(r,n))},r=function(e){var n=t.getEditorState();t.setEditorState(Zo(n,e))};return{decorators:[{strategy:xe("mention"),component:ea},{strategy:xe("mention-cancel-token"),component:na},{strategy:function(e,n){var r=t.getEditorState().getSelection();r.hasFocus&&r.focusKey===e.key&&r.focusOffset===r.anchorOffset&&_o()(ca,e,(function(e,t){r.focusOffset===t-1&&n(e,t)}))},component:Go()(la,{source:e.source,onSelectItem:n,onCancelMention:r})}],initialize:function(e){var n=e.getEditorState,r=e.setEditorState;t.getEditorState=n,t.setEditorState=r},draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];return"mention"===o.type?sn.a.renderToStaticMarkup(Object(Z.g)("a",{className:"member_mention",href:"/".concat(o.data.isOrg?"org":"people","/").concat(o.data.urlToken),"data-hash":o.data.id},a)):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];if("a"===o&&a.classList.contains("member_mention")){var i=a.href.split("/").slice(-2),l=qt()(i,2),c=l[0],u=l[1];return T.Entity.create("mention","IMMUTABLE",{id:a.getAttribute("data-hash"),urlToken:u,isOrg:"org"===c})}return e.apply(void 0,n)}}}}},da=n(2015),fa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ga=function(e){return C.a.createElement(zr.a,fa({fill:"currentColor"},e),C.a.createElement("path",{d:"M17.177 3.073l3.358 3.359a1 1 0 0 1 0 1.414l-3.358 3.359a.25.25 0 0 1-.354 0l-1.06-1.06a.25.25 0 0 1 0-.354l1.652-1.652H11a5 5 0 0 0 0 10h8.75a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25H11a7 7 0 1 1 0-14h6.415l-1.652-1.652a.25.25 0 0 1 0-.353l1.06-1.06a.25.25 0 0 1 .354 0z"}))};ga.defaultProps={name:"Redo"};var pa=ga,ha=function(){var e={};return{initialize:function(t){Object.assign(e,t)},handleCommand:function(t){if("undo"===t&&e.getEditorState().getUndoStack().size>0){var n=T.EditorState.undo(e.getEditorState());return e.setEditorState(n),"handled"}if("redo"===t&&e.getEditorState().getRedoStack().size>0){var r=T.EditorState.redo(e.getEditorState());return e.setEditorState(r),"handled"}return"not-handled"},queryCommandEnable:function(e,t){return"undo"===e?!t||0!==(null==t?void 0:t.getUndoStack().size):"redo"===e?!t||0!==(null==t?void 0:t.getRedoStack().size):void 0},keyBindingFn:function(e){if(T.KeyBindingUtil.hasCommandModifier(e)&&89===e.keyCode)return"redo"},toolbarV2:[{icon:da.a,label:"撤销",section:W.a.CONTENT_OPERATION,shortcut:"⌘+Z",priority:0,commandName:"undo",shouldDisabled:function(e){var t=e.editorState;return!t||0===(null==t?void 0:t.getUndoStack().size)}},{icon:pa,label:"重做",section:W.a.CONTENT_OPERATION,shortcut:"⌘+Y",priority:1,commandName:"redo",shouldDisabled:function(e){var t=e.editorState;return!t||0===(null==t?void 0:t.getRedoStack().size)}}]}};n(1024),n(638);function ma(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ya(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ya(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function ya(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function va(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var ba=function(e){f()(n,e);var t=va(n);function n(e){var r,a;i()(this,n),(r=t.call(this,e)).setPlugins=function(){var e=r.props,t=e.allowInlineCode,n=e.allowMention,a=e.onSelectText,i=e.allowLink,l=e.allowImageEditor,c=e.getPlugins,u=e.useV2Feature,s=e.allowDivider;r.plugins=[r.codePlugin,r.formatPlugin,r.mentionPlugin,t&&r.inlineCodePlugin,r.convertPlugin,r.clearFormatPlugin,r.focusPlugin].concat(o()(c()),[r.imagePlugin,l&&u&&r.imageEditorPlugin,r.videoPlugin,s&&r.dividerPlugin,n&&r.mentionPlugin,i&&r.linkPlugin,r.linkTitlePlugin,r.softNewlinePlugin,Boolean(a)&&r.selectTextPlugin,u&&r.historyOperationPlugin,r.pasteHTMLPlugin]).filter(Boolean),r.draft2htmlMiddlwares=r.plugins.map((function(e){return e.draft2html})).filter(Boolean),r.html2draftMiddlewares=r.plugins.map((function(e){return e.html2draft})).filter(Boolean)},r.getExtraPluginData=function(){return r.plugins.reduce((function(e,t){var n;return Object.assign(Object.assign({},e),null==t||null===(n=t.getExtraPluginData)||void 0===n?void 0:n.call(t))}),{})},r.handleUploadManagerEnd=function(){r.cancelNotificationPermissionRequest&&r.cancelNotificationPermissionRequest()},r.handleUploadManagerError=function(e,t){"video"===t&&r.showNotification("视频上传失败",r.props.location,"Fail")},r.reset=function(){var e=T.EditorState.createWithContent(T.ContentState.createFromText(""),r.state.editorState.getDecorator());e=T.EditorState.moveFocusToEnd(e),r.editor.onChange(e)},r.resetWithValue=function(e){var t=(0,r.props.createContent)(e,r.html2draftMiddlewares),n=T.EditorState.createWithContent(t,r.state.editorState.getDecorator());r.editor.onChange(n)},r.focus=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?r.setState({editorState:T.EditorState.moveFocusToEnd(r.state.editorState)}):r.editor.focus();var t=r.props.onFocus;t&&t()},r.handleReturn=function(){var e=r.state.editorState,t=e.getSelection(),n=e.getCurrentContent(),o=t.getStartOffset(),a=t.getEndOffset(),i=t.getStartKey(),l=n.getBlockForKey(i),c=l.getType(),u=l.getDepth(),s=l.getLength(),d=t.getEndKey();if(["blockquote","ordered-list-item","unordered-list-item"].includes(c)&&0===s){var f=T.Modifier.removeRange(n,t,"backward");return f=u?f.set("blockMap",f.getBlockMap().update(i,(function(e){return e.set("depth",u-1)}))):T.Modifier.setBlockType(f,T.SelectionState.createEmpty(i),"unstyled"),r.onChange(T.EditorState.forceSelection(T.EditorState.push(e,f,"split-block"),T.SelectionState.createEmpty(i))),"handled"}if(c.startsWith("header")){var g=T.Modifier.splitBlock(n,t),p=g.getKeyAfter(i);return o!==s&&a!==s&&i===d||(g=T.Modifier.setBlockType(g,T.SelectionState.createEmpty(p),"unstyled")),r.onChange(T.EditorState.forceSelection(T.EditorState.push(e,g,"split-block"),T.SelectionState.createEmpty(p))),"handled"}return"not-handled"},r.handlePastedFiles=function(e){return r.props.allowPasteRichText?r.imagePlugin.handlePastedFiles(e):"not-handled"},r.handleDroppedFiles=function(e,t){if(r.props.allowDragAndDrop){var n=r.state.editorState,o=n.getCurrentContent().getBlockForKey(t).getLength(),a=new T.SelectionState({isCollapsed:!0,anchorKey:t,anchorOffset:o,focusKey:t,focusOffset:o});r.onChange(T.EditorState.forceSelection(n,a),(function(){r.imagePlugin.handleDroppedFiles(e)}))}},r.handleShowImageEditor=function(){var e;(e=r.imageEditorPlugin.store).handleShowImageEditor.apply(e,arguments)},r.uploadManager=r.createUploadManager(),r.codePlugin=pt(),r.formatPlugin=vt(),r.inlineCodePlugin=bt(),r.submitHotkeyPlugin=Ct(),r.pasteHTMLPlugin=Ot({allowPasteRichText:r.props.allowPasteRichText,disablePasteImage:!r.props.allowImageUpload}),r.convertPlugin=Pt({allowHeaderThree:r.props.allowHeaderThree,useV2Feature:r.props.useV2Feature}),r.clearFormatPlugin=Ut(),r.focusPlugin=null!==(a=r.props.focusPlugin)&&void 0!==a?a:ln(),r.focusDecorator=Object(A.composeDecorators)(r.focusPlugin.decorator),r.linkPlugin=Cr({decorator:r.focusDecorator,allowLinkCard:r.props.allowLinkCard,useV2Feature:r.props.useV2Feature,newLinkCard:r.props.newLinkCard}),r.imagePlugin=co({decorator:r.focusDecorator,uploadManager:r.uploadManager,disableImageUpload:!r.props.allowImageUpload,allowImageCaption:r.props.allowImageCaption,allowResizeImage:r.props.allowResizeImage,allowFloatImage:r.props.allowFloatImage,allowImageEditor:r.props.allowImageEditor,editingContentType:r.props.editingContentType,uploadImageError:r.props.uploadImageError,onImageUpload:r.props.onImageUpload,useV2Feature:r.props.useV2Feature,hideImageToolbar:r.props.hideImageToolbar,handleShowImageEditor:r.handleShowImageEditor}),r.imageEditorPlugin=go({uploadManager:r.uploadManager}),r.videoPlugin=Io({decorator:r.focusDecorator,props:{uploadManager:r.uploadManager,loadVideo:r.props.loadVideo,onVideoPosterButtonClick:r.props.onVideoPosterButtonClick,onBeforeUpload:r.props.onBeforeVideoUpload,allowVideoTitleChange:function(){return r.props.allowVideoTitleChange},onError:r.props.loadVideo,isProduction:r.props.isProduction,requestNotificationPermission:r.requestNotificationPermission,showNotification:r.showNotification,location:r.props.location,couldSuperVideoUpload:r.props.couldSuperVideoUpload,getShowToolbarButton:r.props.getShowVideoToolbarButton}}),r.dividerPlugin=Ko({decorator:r.focusDecorator,useV2Feature:r.props.useV2Feature}),r.linkTitlePlugin=Fo({performAction:function(e){return r.performAction(e)}}),r.softNewlinePlugin=Uo(),r.selectTextPlugin=Vo(r.props.onSelectText),r.mentionPlugin=sa({source:r.props.mentionSource}),r.historyOperationPlugin=ha();var l=e.defaultValue,c=e.createContent;return r.onChange=r.handleChange.bind(s()(r)),r.onBlur=r.handleBlur.bind(s()(r)),r.onGlobalScroll=O()(r.handleGlobalScroll.bind(s()(r)),100),r.onTab=r.handleTab.bind(s()(r)),r.handleKeyCommand=r.handleKeyCommand.bind(s()(r)),r.queryCommandState=r.queryCommandState.bind(s()(r)),r.queryCommandEnable=r.queryCommandEnable.bind(s()(r)),r.setPlugins(),r.state={editorKey:0,editorState:T.EditorState.createWithContent(c(l,r.html2draftMiddlewares))},r.props.getToolbarPlugins&&console.warn("Editable 组件的 getToolbarPlugins 属性将要被废弃，请使用 getToolbarSidePlugins 替换","请查阅 http://zhdocs.io/docs/zhihu-components/#/Editable/CustomToolbar"),r}return c()(n,[{key:"componentDidMount",value:function(){var e=this;this.props.autoFocus&&setTimeout((function(){return e.focus()})),document.addEventListener("scroll",this.onGlobalScroll,{capture:!0,passive:!0}),this.props.onReady()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("scroll",this.onGlobalScroll,!0)}},{key:"componentDidCatch",value:function(e,t){window.Raven&&window.Raven.captureException(e,{tags:{scope:"Editable"},extra:{info:t}}),(!this.lastErrorTime||Date.now()-this.lastErrorTime>100)&&(this.lastErrorTime=Date.now(),this.setState({editorKey:this.state.editorKey+1}))}},{key:"hasImage",value:function(e){var t;return(null===(t=this.imagePlugin)||void 0===t?void 0:t.getImages(e).size)>0}},{key:"hasVideo",value:function(e){var t;return(null===(t=this.videoPlugin.getVideos(e))||void 0===t?void 0:t.size)>0}},{key:"createUploadManager",value:function(){var e=this.props,t=e.onImageUpload,n=e.onVideoUpload,r=e.onUploadStart,o=e.onUploadEnd,a=e.isProduction,i=e.apiRoot,l=e.mustAlgorithmCover,c=new F.b({isProduction:a,uploadImage:t,uploadEmbeddedVideo:n,apiRoot:i,mustAlgorithmCover:l});return c.on("end",this.handleUploadManagerEnd),c.on("error",this.handleUploadManagerError),r&&c.on("start",r),o&&c.on("end",o),c}},{key:"zaMock",value:function(e){var t=document.createElement("div");this.zaMockContainer.appendChild(t),e(t),this.zaMockContainer.removeChild(t)}},{key:"requestNotificationPermission",value:function(){var e=this;if(!(window.Notification&&"default"!==window.Notification.permission||this.cancelNotificationPermissionRequest)){var t=N.a.get("Editable::notification")||{};if(!(t.dismissUntil&&Date.now()<t.dismissUntil)){this.cancelNotificationPermissionRequest=function(){e.cancelNotificationPermissionRequest=null,clearTimeout(e.requestNotificationPermissionTimeout)},this.requestNotificationPermissionTimeout=setTimeout((function(){K.a.show((function(n){var r=null;return e.cancelNotificationPermissionRequest=function(){r&&w.a.trackEvent(r,{action:"Hide"}),e.cancelNotificationPermissionRequest=null,n()},Object(Z.g)(K.a,{className:"Editable-notification",style:{top:e.props.toolbarStickyOffset},notification:{text:Object(Z.g)("div",{ref:function(e){(r=e)&&(w.a.setModule(r,{module:"ConfirmBar"}),w.a.trackCardShow(r))},className:"Editable-notification-layout"},Object(Z.g)("div",{className:"Editable-notification-content"},"开启桌面通知，视频上传完成后将提醒你。"),Object(Z.g)("div",{className:"Editable-notification-actions"},Object(Z.g)(P.c,{className:"Editable-notification-action",preset:"plain",color:"blue",onClick:function(){r&&w.a.trackEvent(r,{action:"Ok"}),e.cancelNotificationPermissionRequest(),N.a.set("Editable::notification",{dismissCount:0,dismissUntil:0}),window.Notification&&window.Notification.requestPermission()}},"开启通知"),Object(Z.g)(P.c,{className:"Editable-notification-action",preset:"plain",onClick:function(){var n,o;r&&w.a.trackEvent(r,{action:"Cancel"}),e.cancelNotificationPermissionRequest(),n=(t.dismissCount||0)+1,o=0,n>=1&&(o=Date.now()+864e5),n>=3&&(n=0,o=Date.now()+12096e5),N.a.set("Editable::notification",{dismissCount:n,dismissUntil:o})}},"暂不需要")))}})}))}),3e3)}}}},{key:"showNotification",value:function(e,t,n){var r=this;if(!window.Notification||"granted"===window.Notification.permission){this.zaMock((function(e){w.a.setModule(e,{module:"DesktopNotificationCard"}),w.a.trackCardShow(e,{},{status:{result:n}})}));var o=new Notification(e,{icon:this.props.logo,body:t});o.addEventListener("click",(function(){r.zaMock((function(e){w.a.setModule(e,{module:"DesktopNotificationCard"}),w.a.trackEvent(e,{action:"Click"},{status:{result:n}})})),window.focus(),o.close()}))}}},{key:"handleChange",value:function(e,t){var n,r=this,o=this.props,a=o.outputBlockType,i=o.onChange,l=o.getAttachment,c=o.onAnyChange,u=o.onAfterAnyChange,s=!1;if((i||c)&&(n=We(e,a,this.draft2htmlMiddlwares,null==l?void 0:l())),i){var d=e.getCurrentContent(),f=this.state.editorState.getCurrentContent();d.equals(f)&&"apply-entity"!==e.getLastChangeType()||(i(n),s=!0)}c&&c(n),this.setState({editorState:e},(function(){if("function"==typeof t&&t(),s){var n=r.props.onAfterChange;n&&n(e)}u&&u(e)}))}},{key:"handleBlur",value:function(){if(!Boolean(document.querySelector(".Editable-mentionSuggestions"))){var e=this.props.onBlur;e&&e()}}},{key:"handleGlobalScroll",value:function(e){this.codePlugin.handleGlobalScroll(e)}},{key:"handleTab",value:function(e){this.onChange(T.RichUtils.onTab(e,this.state.editorState,4))}},{key:"blur",value:function(){this.editor.blur();var e=this.props.onBlur;e&&e()}},{key:"performAction",value:function(e){var t=this;this.performActionBegin();var n=e();return n.then((function(){return t.performActionEnd()})),n.catch((function(){return t.performActionEnd()})),n}},{key:"performActionBegin",value:function(){var e=this.props.onLoadStart;0===this.loadingCount&&e&&e(),this.loadingCount++}},{key:"performActionEnd",value:function(){var e=this.props.onLoadEnd;this.loadingCount--,0===this.loadingCount&&e&&e()}},{key:"addMedia",value:function(e,t){this.onChange(Object(be.a)(this.state.editorState,e,"IMMUTABLE",t))}},{key:"toHTML",value:function(){var e=this.props.outputBlockType,t=this.state.editorState.getCurrentContent();return je(t,e,this.draft2htmlMiddlwares)}},{key:"handleCommand",value:function(){var e,t=ma(this.plugins);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.handleCommand&&Me(n.handleCommand.apply(n,arguments)))return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"queryCommandState",value:function(){var e,t=ma(this.plugins);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.queryCommandState&&!0===n.queryCommandState.apply(n,arguments))return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"queryCommandEnable",value:function(){var e,t=ma(this.plugins);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n.queryCommandEnable&&!1===n.queryCommandEnable.apply(n,arguments))return!1}}catch(e){t.e(e)}finally{t.f()}return!0}},{key:"handleKeyCommand",value:function(e){this.props.onBeforeCommand&&this.props.onBeforeCommand(e);var t=this.state.editorState;if("handled"===this.handleCommand(e))return"handled";if("backspace"===e&&t.getSelection().isCollapsed()){var n=t.getSelection(),r=t.getCurrentContent(),o=n.getStartOffset(),a=n.getStartKey(),i=r.getBlockForKey(a),l=i.getType(),c=i.getDepth(),u=r.getBlockBefore(a);if(["blockquote","ordered-list-item","unordered-list-item"].includes(l)&&0===o&&u&&"atomic"!==u.getType()){var s=u.getKey(),d=u.getLength(),f=r;return c?(f=f.set("blockMap",f.getBlockMap().update(a,(function(e){return e.set("depth",c-1)}))),this.onChange(T.EditorState.forceSelection(T.EditorState.push(t,f,"adjust-depth"),T.SelectionState.createEmpty(a)))):(f=T.Modifier.setBlockType(f,T.SelectionState.createEmpty(a),"unstyled"),f=T.Modifier.removeRange(f,new T.SelectionState({anchorKey:s,anchorOffset:d,focusKey:a,focusOffset:0}),"backward"),this.onChange(T.EditorState.forceSelection(T.EditorState.push(t,f,"remove-range"),new T.SelectionState({anchorKey:s,anchorOffset:d,focusKey:s,focusOffset:d})))),"handled"}}var g=T.RichUtils.handleKeyCommand(t,e);return g?(this.onChange(g),"handled"):"not-handled"}},{key:"render",value:function(){var e,t,n=this,r=this.props,o=r.allowHeaderThree,a=r.allowDragAndDrop,i=r.allowToolbar,l=r.allowToolbarSticky,c=r.allowReference,u=r.allowTable,s=r.allowLink,d=r.allowDivider,f=r.allowZVideo,g=r.className,p=r.getToolbarSidePlugins,h=void 0===p?this.props.getToolbarPlugins:p,m=r.getToolbarMainPlugins,y=r.getToolbarMenuPlugins,v=r.getEditorBeforePlugins,b=r.toolbarMenuAttention,C=r.minRows,S=r.onFocus,k=(r.outputBlockType,r.placeholder),O=r.readOnly,w=r.toolbarStickyOffset,j=r.toolbarProps,A=r.editableComponent,L=r.useV2Feature,I=r.customToolbar,x=r.showToolbar,N=this.state,P=N.editorKey,K=N.editorState,F=K.getSelection(),U=K.getCurrentContent(),V=K.getCurrentInlineStyle(),q=T.RichUtils.getCurrentBlockType(K),_=!1;U.hasText()||"unstyled"!==U.getBlockMap().first().getType()&&(_=!0),this.setPlugins();var H=Object.assign(Object.assign({},A),{},{state:Object.assign(Object.assign({},null==A?void 0:A.state),this.state)}),G=null;if(i){var W=Object.assign(Object.assign({},j),{},{currentStyle:V,currentBlockType:q,onCommand:this.handleKeyCommand,queryCommandState:this.queryCommandState,queryCommandEnable:this.queryCommandEnable,toolbarMainPlugins:m&&m(H,{currentStyle:V,currentBlockType:q}),toolbarSidePlugins:h&&h(H,{currentStyle:V,currentBlockType:q}),toolbarMenuPlugins:y&&y(H,{currentStyle:V,currentBlockType:q}),toolbarMenuAttention:b,allowHeaderThree:o,allowReference:c,allowTable:u,allowLink:s,allowDivider:d,allowZVideo:f,plugins:this.plugins,editorState:K}),Y=null!=I?I:L?re:z.d;G=l?Object(Z.g)(D.a,{offset:w,container:function(){return n.root}},(function(e){var t=e.isFixed;return Object(Z.g)(Y,E()({},W,{isFixed:t}))})):Object(Z.g)(Y,W)}return Object(Z.g)(B.b,{block:"Editor"},Object(Z.g)(B.e,{zaType:"Block",as:oe.a,isFocus:F.hasFocus,ref:function(e){return n.root=e},className:M()(g,"Editable",{"Editable--hidePlaceholder":_})},x&&G,null===(e=(t=this.props).renderContentAboveDropZone)||void 0===e?void 0:e.call(t),Ze(this.plugins,"componentsAboveDropZone"),Object(Z.g)(ge,{style:{minHeight:"".concat(12+26*C+14*(C-1),"px")},className:"Editable-content RichText RichText--editable RichText--clearBoth ztext",enabled:a,onClick:function(e){e.defaultPrevented||n.focus(!1)},onMouseOver:this.codePlugin.onMouseOver,onDrop:this.handleDroppedFiles},v&&v(this,{currentStyle:V,currentBlockType:q}),Ze(this.plugins,"componentsBeforeEditor"),Object(Z.g)(R.a,{key:P,ref:function(e){n.editor=e},spellCheck:!0,placeholder:k,decorators:[new pe.PrismDecorator({prism:pe.Prism,getSyntax:function(e){var t=e.getData().get("language");return t&&pe.Prism.languages[t.id]?t.id:null}})],plugins:this.plugins,readOnly:O,editorState:K,onChange:this.onChange,onFocus:S,onBlur:this.onBlur,onTab:this.onTab,blockRenderMap:T.DefaultDraftBlockRenderMap.merge(Ae.a.Map({unstyled:{element:"div",aliasedElements:["p","div"]},"header-two":{element:"h2",aliasedElements:["h1","h2"]},"header-three":{element:"h3",aliasedElements:["h3","h4","h5","h6"]},blockquote:{element:"blockquote"}})),blockStyleFn:_e,customStyleFn:He,handleReturn:this.handleReturn,handleKeyCommand:this.handleKeyCommand,handlePastedFiles:this.handlePastedFiles,tabIndex:0,root:this.root,draft2htmlMiddlwares:this.draft2htmlMiddlwares,html2draftMiddlewares:this.html2draftMiddlewares,uploadManager:this.uploadManager,resetWithValue:this.resetWithValue}),Ze(this.plugins,"editableContentComponents")),Object(Z.g)("div",{ref:function(e){e&&(n.zaMockContainer=e)}}),Ze(this.plugins,"components")))}}]),n}(b.Component);ba.propTypes={className:v.a.string,autoFocus:v.a.bool,minRows:v.a.number,newLinkCard:v.a.bool,placeholder:v.a.string,allowToolbar:v.a.bool,allowToolbarSticky:v.a.bool,toolbarStickyOffset:v.a.number,allowPasteRichText:v.a.bool,allowDragAndDrop:v.a.bool,allowMention:v.a.bool,mentionSource:v.a.func,outputBlockType:v.a.oneOf(["p","div"]),defaultValue:v.a.oneOfType([v.a.object,v.a.string]),onChange:v.a.func,onAfterChange:v.a.func,onAnyChange:v.a.func,onAfterAnyChange:v.a.func,onFocus:v.a.func,onBlur:v.a.func,allowHeaderThree:v.a.bool,allowLinkCard:v.a.bool,allowInlineCode:v.a.bool,hideImageToolbar:v.a.bool,allowImageUpload:v.a.bool,allowImageCaption:v.a.bool,allowResizeImage:v.a.bool,allowFloatImage:v.a.bool,allowVideoTitleChange:v.a.bool,allowLink:v.a.bool,allowDivider:v.a.bool,allowVideo:v.a.bool,onReady:v.a.func,onVideoPosterButtonClick:v.a.func,onImageUpload:v.a.func,onVideoUpload:v.a.func,onSelectText:v.a.func,onSubmit:v.a.func,onError:v.a.func,onLoadStart:v.a.func,onLoadEnd:v.a.func,onUploadStart:v.a.func,onUploadEnd:v.a.func,onUploadError:v.a.func,onBeforeVideoUpload:v.a.func,onBeforeCommand:v.a.func,getToolbarMainPlugins:v.a.func,getToolbarSidePlugins:v.a.func,getToolbarPlugins:v.a.func,getToolbarMenuPlugins:v.a.func,toolbarMenuAttention:v.a.string,logo:v.a.string,location:v.a.string,readOnly:v.a.bool,editingContentType:v.a.string,couldSuperVideoUpload:v.a.bool,createContent:v.a.func,getAttachment:v.a.func,showToolbarButton:v.a.bool,getPlugins:v.a.func,apiRoot:v.a.string,customToolbar:v.a.element,showToolbar:v.a.bool},ba.defaultProps={autoFocus:!1,minRows:1,allowToolbar:!1,allowToolbarSticky:!1,toolbarStickyOffset:0,allowHeaderThree:!0,allowLinkCard:!1,allowInlineCode:!1,hideImageToolbar:!1,allowImageUpload:!0,allowImageCaption:!1,allowVideoTitleChange:!1,allowResizeImage:!1,allowFloatImage:!1,allowPasteRichText:!0,allowDragAndDrop:!1,allowMention:!1,allowLink:!0,allowDivider:!0,allowVideo:!0,outputBlockType:"p",readOnly:!1,couldSuperVideoUpload:!1,createContent:Ge,getShowVideoToolbarButton:function(){return!0},getPlugins:function(){return[]},onReady:I.a,showToolbar:!0};var Ca=ba,Sa=n(2780),Ea=n(185),ka=n.n(Ea),Oa=n(1381),wa=n(1156),Ta=n(1517),ja=function(e,t){var n=e.referenceList,r=void 0===n?[]:n,o=e.onClick,a=e.listRef,i=Object(b.useState)(r),l=qt()(i,2),c=l[0],u=l[1];return Object(b.useImperativeHandle)(t,(function(){return{onListChange:u}}),[]),c.length>0&&Object(Z.g)(Ta.a,{referenceList:c,onClick:o,listRef:a})},Ma=Object(b.forwardRef)(ja),Ba=function(e){var t=e.entityKey,n=e.contentState,r=e.children,o=e.editable,a=e.referenceList,i=e.onRequestEdit,l=n.getEntity(t).getData(),c=l.refKey,u=l.text,s=l.url,d=ka()(a,"refKey").findIndex((function(e){return e.refKey===c}))+1,f=a.filter((function(e){return e.refKey===c})).findIndex((function(e){return e.entityKey===t}));return Object(Z.g)("sup",{id:"".concat(c,"_").concat(f),className:M()("Reference",{isEditable:o}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){o&&i({entityKey:t,entityData:l})},style:{counterReset:"zh-ref ".concat(d)},"data-ref-key":c,"data-text":u,"data-url":s,"data-numero":d,"data-draft-node":"inline","data-draft-type":"reference"},r)};Ba.defaultProps={editable:!1,referenceList:[],onRequestEdit:function(){}},Ba.propTypes={editable:v.a.bool,onRequestEdit:v.a.func,contentState:v.a.object.isRequired,entityKey:v.a.string.isRequired};var Aa=Ba,Ra=n(2779),La=n(111),Ia=n.n(La),xa=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=0;if(0===t.length)return n;for(e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n.toString(16)},Na=n(210);function Pa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Da=function(e){f()(n,e);var t=Pa(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={refKey:"",text:"",url:""},e.handleRefKeyChange=function(t){var n=e.props.referenceList;e.setState(t?n.find((function(e){return e.refKey===t})):{refKey:"",text:"",url:""})},e.handleTextChange=function(t){e.setState({text:t.target.value})},e.handleUrlChange=function(t){e.setState({url:t.target.value})},e.onSubmit=function(t){t.preventDefault();var n=e.state,r=n.refKey,o=n.text,a=n.url,i=a?wn.a.match(a)[0].url:"";e.props.onSubmit({refKey:r||"ref_".concat(xa("t:".concat(o,"u:").concat(a)),"_").concat(Ia()()),text:o,url:i}),e.onClose()},e.onClose=function(){e.setState({refKey:"",text:"",url:""}),e.props.onClose()},e.handleFormRef=function(t){t&&e.setState(Object.assign({},e.props.entityData))},e}return c()(n,[{key:"render",value:function(){var e,t=this,n=this.props,r=n.referenceList,a=n.mode,i=n.shown,l=this.state,c=l.refKey,u=l.text,s=l.url;e="insert"===a?c?"更新注释并插入":"插入":"更新";var d=["insert"===a&&Object(Z.g)(Na.a,{key:"new",value:"",text:"新注释"})].concat(o()(ka()(r,"refKey").map((function(e,t){return Object(Z.g)(Na.a,{key:e.refKey,value:e.refKey,text:"注释 ".concat(t+1)})})))).filter(Boolean);return Object(Z.g)(kn.b,{title:"insert"===a?"插入注释":"编辑注释",className:"ReferenceModal",onClose:this.onClose,maskClosable:!1,hotKeyClosable:!1},i&&Object(Z.g)("form",{className:"ReferenceModal-form",onSubmit:this.onSubmit,ref:this.handleFormRef},Object(Z.g)("div",{className:"ReferenceModal-firstRow"},Object(Z.g)(Na.b,{large:!0,className:"ReferenceModal-select",listClassName:"ReferenceModal-selectList",text:function(e){return Object(Z.g)(C.a.Fragment,null,Object(Z.g)(Ra.a,{className:"ReferenceModal-icon"}),e)},onChange:this.handleRefKeyChange,disabled:"edit"===a},d),Object(Z.g)(On.a,{large:!0,spread:!0,type:"text",className:"ReferenceModal-input",placeholder:"输入注释文本",value:u,onChange:this.handleTextChange,before:Object(Z.g)(En.a,{className:"ReferenceModal-icon"})})),Object(Z.g)(On.a,{large:!0,spread:!0,type:"text",className:"ReferenceModal-input",placeholder:"输入链接地址",value:s,onChange:this.handleUrlChange,onRef:function(e){t.urlInput=e},before:Object(Z.g)(dn.a,{className:"ReferenceModal-icon"})}),Object(Z.g)(kn.a,{className:"ReferenceModal-buttonGroup",direction:"horizontal"},Object(Z.g)(P.c,{onClick:this.onClose,color:"grey"},"取消"),Object(Z.g)(P.c,{preset:"primary",color:"blue",type:"submit",disabled:s&&!wn.a.test(s)||!s&&!u},e))))}}]),n}(b.Component);Da.defaultProps={shown:!1,mode:"insert"};var Ka=function(e,t){var n=e.getCurrentContent(),r=e.getSelection(),o=(n=n.createEntity("reference","IMMUTABLE",t)).getLastCreatedEntityKey();n=T.Modifier.replaceText(n,r," ",null,o);var a=T.EditorState.push(e,n,"insert-characters");return r=a.getSelection(),a=T.EditorState.forceSelection(a,r)};function Fa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var za=function(e){var t=e.root;return Object(wa.e)(t),null},Ua=function(e){f()(n,e);var t=Fa(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={form:{shown:!1,entityKey:null,entityData:{refKey:"",text:"",url:""}}},e.close=function(){e.setFormState({shown:!1,entityData:{refKey:"",text:"",url:""}})},e.handleSubmit=function(t){var n,r=e.props,o=r.store,a=r.referenceList,i=r.onReferenceListChange,l=e.state.form.entityKey,c=o.getEditorState();(n=l?Object(Tr.a)(c,l,t):Ka(c,t),t.refKey)&&i(a.map((function(e){return e.refKey!==t.refKey?e:(n=Object(Tr.a)(n,e.entityKey,t),t)})));o.setEditorState(n)},e.handleRequestEdit=function(t){var n=t.entityKey,r=t.entityData;e.setFormState({shown:!0,mode:"edit",entityKey:n,entityData:r})},e.handleRequestInsert=function(){e.setFormState({shown:!0,mode:"insert",entityKey:null,entityData:{refKey:"",text:"",url:""}})},e}return c()(n,[{key:"setFormState",value:function(e){this.setState({form:e})}},{key:"render",value:function(){var e=this.props.referenceList,t=this.state.form;return Object(Z.g)(Da,{mode:t.mode,shown:t.shown,referenceList:e,entityData:t.entityData,onSubmit:this.handleSubmit,onClose:this.close})}}]),n}(C.a.Component),Va=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.useV2Feature,r={},o=[],a=Object(b.createRef)(null),i={handlers:[],subscribe:function(e){return i.handlers.push(e)},unsubscribe:function(e){return i.handlers.filter((function(t){return t!==e}))},emit:function(e){var t;o=e,i.handlers.forEach((function(e){return e(o)})),null===(t=a.current)||void 0===t||t.onListChange(o)}},l=function(t){e&&e.handleRequestEdit(t)},c=Object(Oa.createSubscription)({getCurrentValue:function(){return o},subscribe:function(e,t){var n=function(){return t(o)};return e.subscribe(n),function(){return e.unsubscribe(n)}}});return{decorators:[{strategy:xe("reference"),component:function(e){return Object(Z.g)(c,{source:i},(function(t){return Object(Z.g)(Aa,E()({},e,{editable:!0,referenceList:t,onRequestEdit:l}))}))}}],components:[Object(Z.g)(c,{key:"reference_dialog",source:i},(function(t){return Object(Z.g)(Ua,{store:r,referenceList:t,onReferenceListChange:function(e){i.emit(e)},ref:function(t){return e=t}})}))],editableContentComponents:[Object(Z.g)(b.Fragment,{key:"reference"},Object(Z.g)(Ma,{ref:a}),Object(Z.g)(za,null))],isEnabled:function(){return"code-block"!==T.RichUtils.getCurrentBlockType(r.getEditorState())},keyBindingFn:function(e){return n&&xt(e)&&82===e.keyCode||T.KeyBindingUtil.hasCommandModifier(e)&&e.shiftKey&&57===e.keyCode?"insert-reference":void 0},handleCommand:function(t){return this.isEnabled()&&"insert-reference"===t&&e?(e.handleRequestInsert(),"handled"):"not-handled"},onChange:function(e){var t=e.getCurrentContent(),n=[];return Ie("reference")(t,(function(e,t){n.push(Object.assign(Object.assign({},t),{},{entityKey:e}))})),i.emit(n),e},initialize:function(e){var t=e.getEditorState,n=e.setEditorState;r.getEditorState=t,r.setEditorState=n},draft2html:{entityToHTML:function(e){return function(){for(var t=r.getEditorState().getCurrentContent(),n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];var i=o[0];if("reference"===i.type){var l=[];Ie("reference")(t,(function(e,t){l.push(t)}));var c=ka()(l,"refKey").findIndex((function(e){return e.refKey===i.data.refKey}))+1;return sn.a.renderToStaticMarkup(Object(Z.g)("sup",{"data-text":i.data.text||"","data-url":i.data.url||"","data-draft-node":"inline","data-draft-type":"reference","data-numero":c},"[",c,"]"))}return e.apply(void 0,o)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];if("sup"===o&&"reference"===a.getAttribute("data-draft-type")){var i=a.getAttribute("data-text"),l=a.getAttribute("data-url"),c=a.getAttribute("data-numero"),u=a.getAttribute("data-ref-key")||"ref_".concat(xa("t:".concat(i,"u:").concat(l)),"_").concat(c);return T.Entity.create("reference","IMMUTABLE",{refKey:u,text:i,url:l})}return e.apply(void 0,n)}}},toolbar:{label:"插入注释",shortcut:"⌘+⇧+9",icon:Sa.a,commandName:"insert-reference",section:Xe.a.STRUCTURE_STYLING,priority:2},toolbarV2:{label:"插入注释",shortcut:"⌘+⌥+R",icon:Sa.a,commandName:"insert-reference",section:W.a.STRUCTURE_GENERATION,priority:2}}},qa=n(106),_a=n.n(qa),Ha=n(1389),Ga=n(943),Wa=n(1275);function Ya(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Ja=function(e){f()(n,e);var t=Ya(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={enabled:e.props.initialEnabled,catalog:[]},e}return c()(n,[{key:"toggleCatalog",value:function(){this.setState({enabled:!this.state.enabled})}},{key:"onCatalogUpdate",value:function(e){this.setState({catalog:e})}},{key:"render",value:function(){var e=this,t=this.state,n=t.enabled,r=t.catalog,o=this.props,a=o.useCatalogV2,i=o.onChange,l=o.autoCalcShouldShow,c=o.maskGradientColor;if(!n)return null;var u=a?Ht.b:Wa.b;return Object(Z.g)(u,{catalog:r,inEditor:!0,scrollOffset:45,onChange:i,autoCalcShouldShow:l,maskGradientColor:c,onClose:function(){e.props.onCloseCatalog?e.props.onCloseCatalog():e.setState({enabled:!1})}})}}]),n}(b.Component);Ja.propTypes={initialEnabled:v.a.bool,useCatalogV2:v.a.bool};var Za=Ja,$a=_a()((function(e,t){var n=document.querySelector(".DraftEditor-editorContainer");if(n){var r=Array.from(n.querySelectorAll("h2,h3")).map((function(e,n){var r,o=e.nodeName.toLowerCase(),a=Object(Ga.b)(o),i=e.textContent,l=e.getAttribute("data-offset-key").split("-")[0];return null!=t&&t.getBlockForKey(l)&&(r=t.getBlockForKey(l).get("data").get("intoCatalogStatus")),{titleLevel:a,text:i,index:n,status:Object(Ht.c)(r)}}));e&&e(r)}}),300),Xa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.isCatalogEnabled,n=e.onToggleCatalog,r=e.getShowToolbarButton,o=e.useV2Feature,a=e.useCatalogV2,i=e.onCloseCatalog,l=e.autoCalcShouldShow,c=e.maskGradientColor,u=void 0===c?"GBK10A":c,s=C.a.createRef(null),d={onCatalogChange:function(e){var t;return null===(t=s.current)||void 0===t?void 0:t.onCatalogUpdate(e)}},f=function(e,t){var n=d.getEditorState(),r=n.getCurrentContent(),o=T.Modifier.mergeBlockData(r,T.SelectionState.createEmpty(e),Ae.a.Map({intoCatalogStatus:t})),a=T.EditorState.push(n,o,"change-block-data");d.getEditorRef().props.onChange(a)};return{store:d,keyBindingFn:function(e){return o&&xt(e)&&74===e.keyCode||T.KeyBindingUtil.hasCommandModifier(e)&&e.shiftKey&&48===e.keyCode?"toggle-catalog":void 0},componentsBeforeEditor:[{component:Object(Z.g)(Za,{key:"catalog",initialEnabled:t,ref:s,useCatalogV2:a,onCloseCatalog:i,onChange:f,autoCalcShouldShow:l,maskGradientColor:u}),priority:1}],handleCommand:function(e){var t;return"toggle-catalog"===e?(null===(t=s.current)||void 0===t||t.toggleCatalog(),null==n||n(),"handled"):"not-handled"},queryCommandState:function(e){var t;if("toggle-catalog"===e)return null===(t=s.current)||void 0===t?void 0:t.state.enabled},onChange:function(e){var t=e.getCurrentContent();return $a(d.onCatalogChange,t),e},initialize:function(e){Object.assign(d,e);var t=d.getEditorState().getCurrentContent();$a(d.onCatalogChange,t)},hasCatalog:function(){var e,t;return Boolean((null===(e=s.current)||void 0===e?void 0:e.state.enabled)&&(null===(t=s.current)||void 0===t?void 0:t.state.catalog.length)>0)},toolbar:{section:Xe.a.STRUCTURE_STYLING,Component:Ha.a,commandName:"toggle-catalog",priority:1,shouldActive:function(){var e;return null===(e=s.current)||void 0===e?void 0:e.state.enabled},shortcut:"⌘+⇧+0",shouldShow:r},toolbarV2:{section:W.a.STRUCTURE_GENERATION,Component:Ha.a,commandName:"toggle-catalog",priority:1,shortcut:"⌘+⌥+J",shouldActive:function(){var e;return null===(e=s.current)||void 0===e?void 0:e.state.enabled},shouldShow:r},draft2html:{blockToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a={"header-two":"h2","header-three":"h3"},i=a[o.type],l=Object(Ht.c)(o.data.intoCatalogStatus)===Ht.a.removed;return i&&l?sn.a.renderToStaticMarkup(Object(Z.g)(i,{"data-into-catalog-status":Ht.a.removed},o.text)):e.apply(void 0,n)}}},html2draft:{htmlToBlock:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];if(["h1","h2","h3","h4","h5","h6"].includes(o)){var i=null==a?void 0:a.getAttribute("data-into-catalog-status");if(i)return["h1","h2"].includes(o)?{type:"header-two",data:{intoCatalogStatus:i}}:{type:"header-three",data:{intoCatalogStatus:i}}}return e.apply(void 0,n)}}}}},Qa=n(2781),ei=function(e,t){return"//www.zhihu.com/equation?tex=".concat(encodeURIComponent(e)).concat(t?"&preview=true":"")},ti=function(e){var t=e.editable,n=e.entityKey,r=e.contentState,o=e.onRequestEdit,a=e.onLoaded,i=e.children,l=r.getEntity(n).getData(),c=l.value,u=l.width,s=l.height,d=ei(c),f=i&&b.Children.only(i[0]);return Object(Z.g)("span",{className:M()("Formula",{isEditable:t}),onMouseDown:function(e){return e.preventDefault()},onClick:function(){if(t){var e,r=f&&f.props&&f.props.start;if(r>=0){var a=r+2;e=T.SelectionState.createEmpty(f.props.block.key).merge({anchorOffset:a,focusOffset:a})}o({entityKey:n,entitySelection:e,value:c})}},style:{backgroundImage:'url("'.concat(d,'")')}},Object(Z.g)("img",{className:"Formula-image","data-eeimg":!0,src:d,alt:c,width:u,height:s,onLoad:function(e){var t=e.target,r=t.width,o=t.height;a&&a(n,{width:r,height:o})}}),Object(Z.g)("span",{className:"Formula-placeholder","data-paste-ignore":!0},f))};ti.defaultProps={editable:!1,onRequestEdit:function(){}},ti.propTypes={editable:v.a.bool,onRequestEdit:v.a.func,onLoaded:v.a.func,contentState:v.a.object.isRequired,entityKey:v.a.string.isRequired,children:v.a.node};var ni=ti,ri=function(e){var t=e.math,n=e.preview;return Object(Z.g)("img",{src:ei(t,n),alt:t})};ri.propTypes={math:v.a.string,preview:v.a.bool},ri.defaultProps={preview:!1};var oi=ri,ai=n(159);function ii(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var li,ci,ui,si={greek:function(e){return Object(Z.g)("svg",E()({xmlns:"http://www.w3.org/2000/svg",width:"46",height:"24",viewBox:"0 0 46 24"},e),Object(Z.g)("g",{fillRule:"evenodd"},Object(Z.g)("path",{fillRule:"nonzero",d:"M27.21 6.302L33 16.344H21.42l5.79-10.042zm-3.623 8.79h7.247L27.21 8.806l-3.623 6.286zM6.655 17.258C4.457 17.258 3 15.48 3 12.71c0-2.764 1.465-4.55 3.655-4.55 1.32 0 2.214.62 2.662 1.786h.13v-1.63H10.8v6.595c0 .81.227 1.05.73 1.05.14 0 .262-.01.4-.03v1.18c-.203.06-.407.08-.708.08-1.034 0-1.66-.51-1.766-1.55l-.01-.08h-.13c-.47 1.12-1.375 1.7-2.66 1.7zm7.93.325C14.52 17.91 14.29 18 14 18c-.327 0-.63-.242-.526-.655l2.135-8.483C16.12 6.785 17.48 5 19.21 5c1.36 0 2.336.942 2.336 2.082 0 1.013-.466 1.868-1.295 2.47.09.1.17.205.24.318.32.485.48 1.07.48 1.69 0 2.19-1.946 3.95-4.174 3.95-.58 0-1.132-.26-1.53-.665l-.682 2.738zm5.43-10.623c0-.55-.237-.855-.826-.855-1 0-2.05 1.303-2.49 3.053l-.88 3.566c-.04.12-.04.217-.04.393 0 .782.41 1.288 1.08 1.288.8 0 1.682-.584 2.05-1.402.3-.673.44-1.212.44-1.835 0-.466-.1-.778-.32-1.023-.34.09-.588.128-.877.128h-.07c-.175.003-.29 0-.42-.012-.527-.04-.9-.23-.9-.73 0-.52.4-.74.967-.8.156-.01.285-.02.495-.02h.05c.267 0 .574.05.845.13.55-.4.887-1.17.887-1.87zM6.762 15.995c1.637 0 2.663-1.296 2.663-3.285 0-1.957-.96-3.285-2.475-3.285-1.538 0-2.5 1.23-2.5 3.285 0 2.013.913 3.285 2.313 3.285z"}),Object(Z.g)("path",{d:"M39.914 10l2.914 3.416H37"})))},arrow:function(e){return Object(Z.g)("svg",E()({xmlns:"http://www.w3.org/2000/svg",width:"46",height:"24",viewBox:"0 0 46 24"},e),Object(Z.g)("path",{d:"M22.448 10.226h8.53c-.36-.486-.612-.918-1.062-1.746l1.476-.828c.684 1.458 1.08 2.124 1.8 3.006.666.81 1.17 1.278 2.34 2.142-1.17.864-1.674 1.332-2.34 2.142-.72.882-1.116 1.548-1.8 3.006l-1.476-.81c.594-1.08.648-1.188 1.026-1.746h-8.494V13.79h9.592c.27-.306.486-.522 1.008-.99-.216-.198-.774-.738-.99-.972h-9.61v-1.602zM17.326 7l3.092 3.092H17.9l-.014 7.56h-1.133l.006-7.56h-2.527L17.323 7zM2 12.326l3.092-3.09v2.517l7.56.013V12.9l-7.56-.007v2.525L2 12.326zM41.914 10l2.914 3.416H39",fillRule:"evenodd"}))},symbol:function(e){return Object(Z.g)("svg",E()({xmlns:"http://www.w3.org/2000/svg",width:"46",height:"24",viewBox:"0 0 46 24"},e),Object(Z.g)("path",{d:"M39.914 10l2.914 3.416H37m-25.02 2.062l-.984.98-3.507-3.493-3.51 3.492-.98-.98 3.504-3.49L3 8.494l.982-.98L7.49 11.01l3.506-3.492.983.98-3.51 3.49 3.506 3.492zm6.25-6.902c0-.64.53-1.182 1.186-1.182.655 0 1.187.543 1.187 1.182 0 .652-.532 1.182-1.187 1.182s-1.187-.53-1.187-1.182zm-3.658 2.73h9.688v1.387h-9.688v-1.386zm3.657 4.118c0-.652.53-1.182 1.183-1.182s1.187.53 1.187 1.182c0 .64-.53 1.182-1.186 1.182s-1.187-.544-1.187-1.182zM26.26 7H33v10h-6.74v-1.372h5.348v-2.95h-5.35v-1.385h5.35v-2.92h-5.35V7z",fillRule:"evenodd"}))},math:function(e){return Object(Z.g)("svg",E()({xmlns:"http://www.w3.org/2000/svg",width:"46",height:"24",viewBox:"0 0 46 24"},e),Object(Z.g)("path",{d:"M1 12.18h1.583l1.496 5.235h.12l2.87-10.79h3.65v1.47H8.19L5.17 18.988H3.12L1 12.18zm13.708 7.174c-1.222-1.993-1.945-4.104-1.945-6.713 0-2.58.723-4.72 1.945-6.7l.946.41C14.524 8.24 14 10.45 14 12.64c0 2.203.524 4.42 1.654 6.294l-.946.42zm3.1 0l-.945-.42c1.13-1.875 1.656-4.09 1.656-6.293 0-2.19-.53-4.4-1.66-6.29l.94-.4c1.23 1.98 1.95 4.12 1.95 6.7 0 2.61-.73 4.72-1.96 6.72zm13.738-4.91c-.103.618-.502 1.332-1.197 2.142-.7.81-1.56 1.22-2.58 1.236-.52 0-.99-.133-1.42-.398-.43-.265-.75-.596-.96-.993-.62.93-1.37 1.4-2.24 1.4-.55 0-1.02-.16-1.42-.48-.4-.32-.61-.76-.62-1.3 0-.42.1-.77.31-1.03.2-.266.4-.43.6-.486.19-.06.36-.09.51-.09.28 0 .51.08.68.245.18.16.263.375.263.64 0 .677-.37 1.14-1.11 1.39.165.19.46.29.89.29.19 0 .33-.016.42-.045.56-.236.975-.72 1.24-1.457.89-3.253 1.33-5.15 1.33-5.696 0-.41-.117-.707-.354-.884-.235-.173-.494-.262-.775-.262-.545 0-1.085.24-1.617.73s-.895 1.08-1.087 1.79c-.043.146-.087.227-.13.24-.045.016-.16.03-.355.046h-.09c-.22 0-.33-.06-.33-.18 0-.017.016-.1.046-.245.234-.84.69-1.583 1.37-2.23.68-.648 1.47-.97 2.374-.97 1.032 0 1.815.462 2.35 1.39.603-.913 1.3-1.37 2.08-1.37h.136c.724 0 1.24.19 1.55.575.31.38.474.79.49 1.216 0 .47-.14.85-.42 1.146-.28.294-.615.44-1 .44-.636 0-.954-.31-.954-.926 0-.297.09-.554.267-.775.18-.22.35-.365.51-.44.165-.072.26-.11.29-.11l.067-.02c0-.013-.043-.043-.13-.087-.09-.046-.21-.1-.357-.157-.15-.057-.29-.08-.42-.065-.537 0-.99.33-1.38.996-.134.24-.304.74-.51 1.5-.21.77-.415 1.56-.622 2.39-.205.825-.323 1.31-.352 1.458-.075.4-.11.685-.11.86 0 .414.11.71.33.885.222.18.473.268.754.268.59 0 1.14-.233 1.66-.704.51-.47.88-1.07 1.08-1.81.03-.13.066-.203.11-.22.045-.012.163-.03.355-.04h.31c.09.09.13.17.13.24zm.736-5.734V5H36v3.71h-3.718zm.93-.955h1.836V5.933h-1.836v1.822zM32.282 20v-3.71H36V20h-3.718zm.93-.955h1.836v-1.82h-1.836v1.82zM41.914 10l2.914 3.416H39",fillRule:"evenodd"}))},comparison:function(e){return Object(Z.g)("svg",E()({xmlns:"http://www.w3.org/2000/svg",width:"46",height:"24",viewBox:"0 0 46 24"},e),Object(Z.g)("path",{d:"M31.265 8.03c2.66 0 4.735 1.946 4.735 4.526s-2.076 4.527-4.735 4.527h-5.93V15.66h5.93c1.863 0 3.285-1.327 3.285-3.104 0-1.777-1.422-3.102-3.285-3.102h-5.93V8.03h5.93zm-7.102 3.567H20.21l-.668 1.82h4.62v1.438h-5.147l-.938 2.595-1.365-.494.782-2.1h-3.427v-1.44h3.94l.667-1.82h-4.607v-1.423H19.2l.953-2.623 1.365.494-.782 2.13h3.427v1.423zM11.523 7l.682 1.27-8.148 4.202v.056l8.148 4.203-.683 1.27L1 12.53v-.056L11.522 7zm29.39 3l2.915 3.416H38",fillRule:"evenodd"}))}},di=(li=function(){return fetch("https://unpkg.zhimg.com/math-palettes@0.0.1/external.json",{mode:"cors"}).then((function(e){return e.json()}))},ui=!1,function(){return ui||(ci=li.apply(void 0,arguments),ui=!0),ci}),fi=function(e){var t=e.name,n=e.slug,r=e.width,o=e.height,a=e.style;return Object(Z.g)("svg",{className:"MathToolbar-paletteIcon",width:r,height:o,style:a},Object(Z.g)("title",null,t),Object(Z.g)("use",{xlinkHref:"#".concat(n)}))},gi=function(e){f()(n,e);var t=ii(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.palette,r=t.palettes,o=t.onSelect,a=si[n],i=Object(Z.g)(P.c,{className:"MathToolbar-button",preset:"plain","aria-label":n},Object(Z.g)(a,{fill:"#8590a6"}));return Object(Z.g)(ai.a,{arrowed:!0,noLayer:!0,preventCloseOnTarget:!0,placement:"top",toggler:i,ref:function(t){return e.popover=t}},Object(Z.g)("div",{className:"MathToolbar-palettes MathToolbar-palettes--".concat(n),onMouseDown:function(e){return e.preventDefault()},onMouseLeave:function(){return e.popover.close()}},r&&r[n.toUpperCase()].map((function(e){return Object(Z.g)(P.c,{key:e.math,preset:"plain",className:"MathToolbar-palettesButton",onClick:function(t){t.preventDefault(),o(e.math)}},Object(Z.g)(fi,e))}))))}}]),n}(b.Component),pi=function(e){f()(n,e);var t=ii(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={svg:null,palettes:null},e}return c()(n,[{key:"componentDidMount",value:function(){var e=this;di().then((function(t){var n=t.svg,r=t.palettes;e.setState({svg:n,palettes:r})}))}},{key:"render",value:function(){var e=this.state,t=e.svg,n=e.palettes,r=this.props.onSelect;return Object(Z.g)("div",{className:"MathToolbar",onMouseDown:function(e){return e.preventDefault()}},Object(Z.g)(gi,{palettes:n,palette:"greek",onSelect:r}),Object(Z.g)(gi,{palettes:n,palette:"symbol",onSelect:r}),Object(Z.g)(gi,{palettes:n,palette:"comparison",onSelect:r}),Object(Z.g)(gi,{palettes:n,palette:"math",onSelect:r}),Object(Z.g)(gi,{palettes:n,palette:"arrow",onSelect:r}),Object(Z.g)("span",{hidden:!0,dangerouslySetInnerHTML:{__html:t}}))}}]),n}(b.Component);function hi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var mi=function(e,t){var n=e.value,r=e.selectionStart,o=e.selectionEnd,a=n.slice(0,r),i=n.slice(o,n.length),l=(a+t).length;return{value:a+t+i,selectionStart:l,selectionEnd:l}},yi=function(e){f()(n,e);var t=hi(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={value:""},e.onChange=function(t){e.setState({value:t.target.value})},e.onSubmit=function(t){t.preventDefault(),e.props.onSubmit(e.state.value),e.onClose()},e.onClose=function(){e.setState({value:""}),e.props.onClose()},e.handleFormRef=function(t){t&&e.setState({value:e.props.defaultValue})},e.handleSelect=function(t){var n=mi(e.input,t),r=n.value,o=n.selectionStart,a=n.selectionEnd;e.setState({value:r},(function(){e.input.focus(),e.input.selectionStart=o,e.input.selectionEnd=a}))},e}return c()(n,[{key:"componentDidUpdate",value:function(e){!e.shown&&this.props.shown&&this.input.focus()}},{key:"render",value:function(){var e=this,t=this.props.shown,n=this.state.value;return Object(Z.g)(kn.b,{overlay:!0,title:"插入公式",className:"FormulaModal",onClose:this.onClose,maskClosable:!1,hotKeyClosable:!1},t&&Object(Z.g)("form",{className:"FormulaModal-form",onSubmit:this.onSubmit,ref:this.handleFormRef},Object(Z.g)(On.a,{className:"FormulaModal-input",before:Object(Z.g)(pi,{onSelect:this.handleSelect}),noPadding:!0,multiline:!0,required:!0,spread:!0,large:!0,type:"text",onRef:function(t){e.input=t},placeholder:"输入 TeX 公式",value:n,onChange:this.onChange}),Object(Z.g)("div",{className:"FormulaModal-formula"},n?Object(Z.g)(oi,{math:n,preview:!0}):Object(Z.g)("div",{className:"FormulaModal-previewText"},"预览")),Object(Z.g)(kn.a,{className:"FormulaModal-buttonGroup",direction:"horizontal"},Object(Z.g)(P.c,{onClick:this.onClose,color:"grey"},"取消"),Object(Z.g)(P.c,{preset:"primary",color:"blue",type:"submit"},"确认"))))}}]),n}(b.Component),vi=" ";var bi=function(e,t){var n=e.getCurrentContent(),r=e.getSelection(),o=n.getBlockForKey(r.focusKey).getText(),a=function(e){return!!o&&o.charAt(e)},i=a(r.anchorOffset-1),l=a(r.focusOffset),c=n.createEntity("formula","IMMUTABLE",{value:t}),u=c.getLastCreatedEntityKey();" "!==i?(c=T.Modifier.replaceText(c,r," "),c=T.Modifier.insertText(c,c.getSelectionAfter(),vi,null,u)):c=T.Modifier.replaceText(c,r,vi,null,u);var s=c.getSelectionAfter();" "!==l&&(c=T.Modifier.insertText(c,c.getSelectionAfter()," ")),s=s.merge({anchorOffset:s.anchorOffset+1,focusOffset:s.focusOffset+1});var d=T.EditorState.push(e,c,"insert-characters");return d=T.EditorState.forceSelection(d,s)};var Ci,Si=function(e,t,n){var r=t.entityKey,o=t.entitySelection,a=Object(Tr.a)(e,r,{value:n});return o&&(a=T.EditorState.forceSelection(a,o)),a};function Ei(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var ki=function(e){f()(n,e);var t=Ei(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={form:{entityKey:null,entitySelection:null,value:"",shown:!1}},e.close=function(){e.replaceFormState({shown:!1,value:""})},e.handleSubmit=function(t){var n,r=e.props.store,o=e.state.form,a=o.entityKey,i=o.entitySelection,l=r.getEditorState();n=a?Si(l,{entityKey:a,entitySelection:i},t):bi(l,t),r.setEditorState(n)},e.handleRequestEdit=function(t){var n=t.entityKey,r=t.entitySelection,o=t.value;e.replaceFormState({shown:!0,entityKey:n,entitySelection:r,value:o})},e.handleRequestInsert=function(){e.replaceFormState({shown:!0,value:""})},e}return c()(n,[{key:"replaceFormState",value:function(e){this.setState({form:e})}},{key:"render",value:function(){var e=this.state.form;return Object(Z.g)(yi,{shown:e.shown,defaultValue:e.value,onSubmit:this.handleSubmit,onClose:this.close})}}]),n}(C.a.Component),Oi=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.useV2Feature,r={},o=function(t){e&&e.handleRequestEdit(t)},a=function(e,t){r.setEditorState(wr(r.getEditorState(),e,t))};return{decorators:[{strategy:function(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&"formula"===n.getEntity(t).getType()}),t)},component:function(e){return Object(Z.g)(ni,E()({},e,{editable:!0,onRequestEdit:o,onLoaded:a}))}}],components:[Object(Z.g)(ki,{key:"formula_dialog",store:r,ref:function(t){e=t}})],isEnabled:function(){return"code-block"!==T.RichUtils.getCurrentBlockType(r.getEditorState())},keyBindingFn:function(e){return n&&xt(e)&&69===e.keyCode||Nt(e)&&69===e.keyCode?"insert-formula":void 0},handleCommand:function(t){return this.isEnabled()&&"insert-formula"===t&&e?(e.handleRequestInsert(),"handled"):"not-handled"},initialize:function(e){var t=e.getEditorState,n=e.setEditorState;r.getEditorState=t,r.setEditorState=n},draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"formula"===o.type?Object(ke.a)(Ci||(Ci=Se()(['<img eeimg="1" src="//www.zhihu.com/equation?tex=','" alt="','"/>'])),encodeURIComponent(o.data.value),o.data.value):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];return"a"===o&&a.hasAttribute("eeimg")?T.Entity.create("formula","IMMUTABLE",{value:a.getAttribute("alt")}):e.apply(void 0,n)}}},toolbar:{section:Xe.a.PROFESSIONAL_MEDIA,label:"插入公式",shortcut:"⌘+⇧+E",icon:Qa.a,commandName:"insert-formula",priority:2},toolbarV2:{section:W.a.PROFESSIONAL_MEDIA,label:"插入公式",shortcut:"⌘+⌥+E",icon:Qa.a,commandName:"insert-formula",priority:2}}},wi=n(2794);function Ti(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Array.from({length:e}).map((function(e,r){return Array.from({length:t}).map((function(){return{isHeader:n&&0===r,content:""}}))}))}function ji(e){return e.every((function(e){return e.every((function(e){return e.isHeader}))}))}function Mi(e,t){var n=e[t];return!!n&&n.filter((function(e){return e.isHeader})).length===n.length}function Bi(e,t){var n=e.map((function(e){return e[t]}));return!!n&&n.filter((function(e){return e.isHeader})).length===n.length}function Ai(e,t,n,r){var a=o()(e);return a.splice("before"===n?t:t+1,0,e[t].map((function(e,n){return r(e,t,n)}))),a}function Ri(e,t,n,r){return e.map((function(e,a){var i=o()(e);return i.splice("before"===n?t:t+1,0,r(e[t],a,t)),i}))}function Li(e,t){return e.filter((function(e,n){return n!==t}))}function Ii(e,t){return e.map((function(e){return e.filter((function(e,n){return n!==t}))}))}function xi(e,t,n){return function(e,t,n){return e.map((function(e,r){return r!==t?e:e.map((function(e,r){return n(e,t,r)}))}))}(e,t,(function(t,r,o){return Bi(e,o)&&!ji(e)?t:Object.assign(Object.assign({},t),{},{isHeader:n})}))}function Ni(e,t,n){return function(e,t,n){return e.map((function(e,r){return e.map((function(e,o){return o!==t?e:n(e,r,t)}))}))}(e,t,(function(t,r){return Mi(e,r)&&!ji(e)?t:Object.assign(Object.assign({},t),{},{isHeader:n})}))}var Pi=function(e){var t=Object(b.useRef)(null),n=e.content,r=e.onChange,o=e.onClick,a=e.onFocus,i=e.onBlur;Object(b.useEffect)((function(){t.current&&!t.current.innerText&&n&&(t.current.innerText=n)}),[n]);var l=Object(b.useCallback)((function(e){if(!t.current||document.activeElement!==e.target)return!1;var n=document.getSelection().focusNode;return!t.current.contains(n)}),[]),c=Object(b.useCallback)((function(e){var t=e.target.innerText.trim();r(t),t||(e.target.innerText="")}),[r]),u=Object(b.useCallback)((function(e){e.preventDefault();var t=e.clipboardData.getData("Text");document.execCommand("insertHTML",!1,t)}),[]);return Object(Z.g)(Lr.a,{className:"Table-dataInputContainer",onEvent:l},Object(Z.g)("div",{ref:t,className:"Table-dataInput",contentEditable:!0,onClick:o,onInput:c,onPaste:u,onFocus:a,onBlur:i}))};var Di=function(e){var t=e.className,n=e.style,r=e.onClick,o=e.onMouseDown,a=e.onTableDataChange,i=e.onTableDataFocus,l=e.onTableDataBlur,c=e.data,u=c.size,s=void 0===u?"normal":u,d=c.rowStyle,f=void 0===d?"normal":d,g=c.tableData,p=void 0===g?[]:g;return Object(Z.g)("table",{className:M()("Table",t),style:n,onClick:r,onMouseDown:o,"data-draft-node":"block","data-draft-type":"table","data-size":s,"data-row-style":f},Object(Z.g)("tbody",null,p.map((function(e,t){return Object(Z.g)("tr",{className:"Table-row",key:t},e.map((function(e,n){var o=e.isHeader,c=e.content,u=o?"th":"td";return Object(Z.g)(u,{key:n,className:M()("Table-data",{"Table-header":o})},Object(Z.g)(Pi,{content:c,onChange:function(r){a(function(e,t,n,r){return e.map((function(e,o){return o!==t?e:e.map((function(e,t){return t!==n?e:r}))}))}(p,t,n,Object.assign(Object.assign({},e),{},{content:r})))},onClick:r,onFocus:function(){i({rowIndex:t,columnIndex:n})},onBlur:l}))})))}))))},Ki=n(2782),Fi=n(2783),zi=n(2784),Ui=n(2785),Vi=n(2786),qi=n(2787),_i=n(2788),Hi=n(2789),Gi=n(2790),Wi=n(2791),Yi=[{name:"insertRowBefore",icon:Ki.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"INSERT_ROW",payload:"before"})},disabled:function(e){return e.data.tableData.length>=100}},{name:"insertRowAfter",icon:Fi.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"INSERT_ROW",payload:"after"})},disabled:function(e){return e.data.tableData.length>=100}},{name:"removeRow",icon:zi.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"REMOVE_ROW"})}},{name:"separator"},{name:"insertColumnBefore",icon:Ui.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"INSERT_COLUMN",payload:"before"})},disabled:function(e){return e.data.tableData[0].length>=8}},{name:"insertColumnAfter",icon:Vi.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"INSERT_COLUMN",payload:"after"})},disabled:function(e){return e.data.tableData[0].length>=8}},{name:"removeColumn",icon:qi.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"REMOVE_COLUMN"})}},{name:"separator"},{name:"toggleRowHeader",icon:_i.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"TOGGLE_ROW_HEADER"})},isActive:function(e){return Mi(e.data.tableData,0)}},{name:"toggleColumnHeader",icon:Hi.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"TOGGLE_COLUMN_HEADER"})},isActive:function(e){return Bi(e.data.tableData,0)}},{name:"toggleStriped",icon:Gi.a,onClick:function(e){var t=e.data.rowStyle;(0,e.onTableToolbarCommand)({type:"SET_ROW_STYLE",payload:"striped"===t?"normal":"striped"})},isActive:function(e){return"striped"===e.data.rowStyle}},{name:"separator"},{name:"removeTable",icon:Wi.a,onClick:function(e){(0,e.onTableToolbarCommand)({type:"REMOVE_TABLE"})}},{name:"separator"},{name:"changeSizeSmall",icon:Pr.a,isActive:function(e){return"small"===e.data.size},onClick:function(e){(0,e.onTableToolbarCommand)({type:"CHANGE_SIZE",payload:"small"})},disabled:function(e){var t=e.data;return"normal"===t.size&&t.tableData[0].length>4},text:"居中"},{name:"changeSizeNormal",icon:Dr.a,isActive:function(e){return"normal"===e.data.size},onClick:function(e){(0,e.onTableToolbarCommand)({type:"CHANGE_SIZE",payload:"normal"})},text:"全宽"}];function Ji(e){var t=e.data,n=e.isFocused,r=e.useV2Feature,o=e.children,a=Object(b.useRef)(null);return Object(Z.g)("div",{className:"TableToolbar-container","data-size":t.size},Object(Z.g)("div",{ref:a},o),Object(Z.g)(Ln.a,{target:a.current,isOpen:n,placement:"top",arrowed:!0,onMouseDown:function(e){return e.preventDefault()}},Object(Z.g)("div",{className:"TableToolbar"},Yi.map((function(t,n){var o,a,i,l;return"separator"===t.name?Object(Z.g)("div",{key:"seprator-".concat(n),className:"TableToolbar-separator"}):Object(Z.g)(P.c,{key:t.name,preset:"plain",className:M()("TableToolbar-button",{"is-active":null!==(o=null===(a=t.isActive)||void 0===a?void 0:a.call(t,e))&&void 0!==o&&o}),onClick:function(n){n.preventDefault(),t.onClick(e)},disabled:null!==(i=null===(l=t.disabled)||void 0===l?void 0:l.call(t,e))&&void 0!==i&&i},Object(Z.g)(t.icon,null),r&&t.text)})))))}Ji.decorate=function(e){return function(t){return Object(Z.g)(Ji,t,Object(Z.g)(e,t))}};var Zi=Ji,$i=n(2792),Xi=n(2793);var Qi=function(e){var t=e.data,n=e.data,r=n.row,o=n.column,a=e.shown,i=e.onChange,l=e.onSubmit,c=e.onClose;return Object(Z.g)(kn.b,{overlay:!0,title:"插入表格",className:"TableForm",onClose:function(){c()}},a&&Object(Z.g)("form",{onSubmit:function(e){e.preventDefault(),l()}},Object(Z.g)(On.a,{className:"TableForm-input",type:"number",min:1,max:100,required:!0,value:r,placeholder:"输入表格行数（最大 ".concat(100," 行）"),onChange:function(e){i(Object.assign(Object.assign({},t),{},{row:e.target.value}))},before:Object(Z.g)($i.a,null)}),Object(Z.g)(On.a,{className:"TableForm-input",type:"number",min:1,max:8,required:!0,value:o,placeholder:"输入表格列数（最大 ".concat(8," 列）"),onChange:function(e){i(Object.assign(Object.assign({},t),{},{column:e.target.value}))},before:Object(Z.g)(Xi.a,null)}),Object(Z.g)(kn.a,{className:"TableForm-buttonGroup",direction:"horizontal"},Object(Z.g)(P.c,{onClick:c,color:"grey"},"取消"),Object(Z.g)(P.c,{preset:"primary",color:"blue",type:"submit",disabled:!r||r>100||!o||o>8},"插入"))))};function el(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var tl={row:"",column:""},nl=function(e){f()(n,e);var t=el(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={shown:!1,formData:tl},e.close=function(){e.setState({shown:!1})},e.show=function(){e.setState({shown:!0,formData:tl})},e}return c()(n,[{key:"render",value:function(){var e=this,t=this.props.onSubmit,n=this.state,r=n.shown,o=n.formData;return Object(Z.g)(Qi,{shown:r,data:o,onChange:function(t){return e.setState({formData:t})},onSubmit:function(){e.setState({shown:!1}),t(o)},onClose:function(){e.setState({shown:!1})}})}}]),n}(C.a.Component),rl=function(e){var t=e.data,n=t.size,r=t.rowStyle,o=t.tableData;return sn.a.renderToStaticMarkup(Object(Z.g)("table",{"data-draft-node":"block","data-draft-type":"table","data-size":n,"data-row-style":r},Object(Z.g)("tbody",null,o.map((function(e,t){return Object(Z.g)("tr",{key:t},e.map((function(e,t){var n=e.isHeader,r=e.content,o=n?"th":"td";return Object(Z.g)(o,{key:t},r)})))})))))},ol=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({decorator:function(e){return e}},t);var n=null,r=null,o={},a=Oe(fn,t.decorator),i=Oe.apply(void 0,[a,Zi.decorate])(Di),l=function(e){var t=e.row,n=e.column,r=o.getEditorState(),a=Object(be.a)(r,"table","IMMUTABLE",{size:"normal",tableData:Ti(t,n)});o.setEditorState(a)},c=function(){t.onRemove()},u=function(e){var t=e.rowIndex,o=e.columnIndex;n=t,r=o},s=function(){n=null,r=null},d=function(e,t){o.setEditorState(wr(o.getEditorState(),e,{tableData:t}))},f=function(e,t){var a,i=t.type,l=t.payload,u=o.getEditorState(),s=$n(u,e),d=s.size,f=s.tableData;if("INSERT_COLUMN"===i){if(null===n||null===r)return;var g=f,p=0===r&&Bi(f,0);p&&(g=Ni(g,0,!1)),g=Ri(g,r,l,(function(e){return{isHeader:e.isHeader,content:""}})),p&&(g=Ni(g,0,!0));var h=g[0].length>4?"normal":d;a=wr(u,e,{size:h,tableData:g})}if("INSERT_ROW"===i){if(null===n||null===r)return;var m=f,y=0===n&&Mi(f,0);y&&(m=xi(m,0,!1)),m=Ai(m,n,l,(function(e){return{isHeader:e.isHeader,content:""}})),y&&(m=xi(m,0,!0)),a=wr(u,e,{tableData:m})}if("REMOVE_ROW"===i||"REMOVE_COLUMN"===i){if(null===n||null===r)return;if("REMOVE_ROW"===i&&1===f.length||"REMOVE_COLUMN"===i&&1===f[0].length)return void c();var v="REMOVE_ROW"===i?Li(f,n):Ii(f,r);a=wr(u,e,{tableData:v})}if("TOGGLE_ROW_HEADER"===i||"TOGGLE_COLUMN_HEADER"===i){var b="TOGGLE_ROW_HEADER"===i?xi(f,0,!Mi(f,0)):Ni(f,0,!Bi(f,0));a=wr(u,e,{tableData:b})}"REMOVE_TABLE"===i&&c(),"SET_ROW_STYLE"===i&&(a=wr(o.getEditorState(),e,{rowStyle:l})),"CHANGE_SIZE"===i&&(a=wr(o.getEditorState(),e,{size:l})),a&&o.setEditorState(a)};return{initialize:function(e){Object.assign(o,e)},keyBindingFn:function(e){return t.useV2Feature&&xt(e)&&84===e.keyCode||Nt(e)&&84===e.keyCode?"insert-table":void 0},components:[Object(Z.g)(nl,{key:"table_dialog",onSubmit:l,ref:function(t){e=t}})],handleCommand:function(t){return"insert-table"===t&&e?(e.show(),"handled"):"not-handled"},blockRendererFn:function(e,o){var a=o.getEditorState;if("atomic"===e.getType()){var l=a().getCurrentContent(),c=e.getEntityAt(0);if(!c)return console.warn("Entity not found",e),null;var g=l.getEntity(c);if("table"===g.getType()){var p=g.getData();return{editable:!1,component:i,props:{data:p,focusingRowIndex:n,focusingColumnIndex:r,onTableDataFocus:u,onTableDataBlur:s,onTableDataChange:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.apply(void 0,[c].concat(t))},onTableToolbarCommand:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f.apply(void 0,[c].concat(t))},useV2Feature:t.useV2Feature}}}}return null},draft2html:{blockToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[0];if("atomic"===a.type){var i=o.getEditorState().getCurrentContent(),l=i.getBlockForKey(a.key);if(l){var c=i.getEntity(l.getEntityAt(0));if(c&&"table"===c.getType())return rl(c)}}return e.apply(void 0,n)}},entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"table"===o.type?rl(o):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=n[1];if("table"===o){var i=a.getAttribute("data-size")||"normal",l=a.getAttribute("data-row-style")||"normal",c=a.children[0],u=Array.from(c.children).map((function(e){return e.children.length?Array.from(e.children).map((function(e){var t=document.createElement(e.tagName);return t.innerHTML=e.innerHTML.replace("<br>","\n"),{isHeader:"TH"===t.tagName,content:t.textContent.trim()}})):[{isHeader:!1,content:""}]}));return T.Entity.create("table","IMMUTABLE",{size:i,rowStyle:l,tableData:u})}return e.apply(void 0,n)}}},toolbar:{section:Xe.a.PROFESSIONAL_MEDIA,label:"插入表格",icon:wi.a,shortcut:"⌘+⇧+T",commandName:"insert-table",priority:1,shouldShow:t.getShowToolbarButton},toolbarV2:{section:W.a.PROFESSIONAL_MEDIA,label:"插入表格",icon:wi.a,shortcut:"⌘+⌥+T",commandName:"insert-table",priority:1,shouldShow:t.getShowToolbarButton}}},al={decorator:function(e){return e},newLinkCard:!0},il=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign(Object.assign({},al),e);var t={},n=Oe(fn,e.decorator),r=n(vn.a),o=function(e){var n=t.getEditorState(),r=e.reduce((function(e,t){return Object(be.a)(e,"zvideo-card","IMMUTABLE",t)}),n);t.setEditorState(r)};return{initialize:function(e){Object.assign(t,e)},handleCommand:function(t){if(t.startsWith("insert-zvideo-card:")){var n=JSON.parse(t.replace("insert-zvideo-card:",""));return o(n),"handled"}return"insert-zvideo"===t?(e.onInsertZVideo(),"handled"):"not-handled"},blockRendererFn:function(n){if("atomic"===n.getType()){var o=t.getEditorState().getCurrentContent(),a=n.getEntityAt(0);if(!a)return console.warn("Entity not found",n),null;var i=o.getEntity(a);if("zvideo-card"===i.getType())return{editable:!1,component:r,props:{entityKey:a,component:"div",id:i.data,newLinkCard:e.newLinkCard}}}return null},draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=o.data;return"zvideo-card"===o.type?sn.a.renderToStaticMarkup(Object(Z.g)("a",{href:"https://www.zhihu.com/zvideo/".concat(a),"data-draft-node":"block","data-draft-type":"link-card"})):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[1];if(Fe(o)&&"link-card"===o.getAttribute("data-draft-type")){var a,i=null===(a=o.getAttribute("href").match(/https:\/\/www.zhihu.com\/zvideo\/(\d+)$/))||void 0===a?void 0:a[1];if(i)return T.Entity.create("zvideo-card","IMMUTABLE",i)}return e.apply(void 0,n)}}},toolbar:{section:Xe.a.BASIC_MEDIA,label:"插入视频",icon:po.a,onClick:function(e){w.a.trackEvent(e.target,{id:8619,action:"Add"})},commandName:"insert-zvideo",priority:3,shouldShow:e.getShowToolbarButton},toolbarV2:{section:W.a.BASIC_MEDIA,label:"插入视频",text:"视频",icon:po.a,onClick:function(e){w.a.trackEvent(e.target,{id:8619,action:"Add"})},commandName:"insert-zvideo",priority:3,shouldShow:e.getShowToolbarButton}}},ll=function(e){var t=e.getCurrentContent(),n=e.getSelection(),r=n.getStartOffset(),o=t.getBlockForKey(n.getStartKey()).getEntityAt(r),a=o&&t.getEntity(o);return a&&"file-link-card"===a.type.toLowerCase()?o:null};function cl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var ul=function(e){f()(n,e);var t=cl(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.isOpen,n=e.target,r=e.data,o=void 0===r?{}:r,a=e.onRef;return Object(Z.g)(Ln.a,{arrowed:!0,target:n,isOpen:t,placement:"bottom",className:"FileLinkCardBubble",onRef:a,onMouseDown:function(e){return e.preventDefault()}},Object(Z.g)("div",{className:"FileLinkCardBubble-content"},Object(Z.g)("a",{target:"_blank",rel:"noopener noreferrer",href:o.href,className:"FileLinkCardBubble-previewLink"},o.href)))}}]),n}(C.a.Component),sl=n(1076);function dl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var fl={decorator:function(e){return e}},gl=function(e){f()(n,e);var t=dl(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={isOpen:!1},e.handleClick=function(t){if(e.state.isOpen){var n=e.props.store,r=Object(cn.findDOMNode)(n.getEditorRef());e.bubbleEl&&!e.bubbleEl.contains(t.target)&&r&&!r.contains(t.target)&&e.setState({isOpen:!1})}},e.handleRef=function(t){e.bubbleEl=t,t?document.addEventListener("click",e.handleClick):document.removeEventListener("click",e.handleClick)},e}return c()(n,[{key:"render",value:function(){var e=this.state.isOpen,t=this.props,n=t.getData,r=t.getTarget;return Object(Z.g)(ul,{data:n(),isOpen:e,target:r(),onRef:this.handleRef})}}]),n}(C.a.Component),pl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign(Object.assign({},fl),e);var t,n,r={},o={},a=Oe(fn,e.decorator),i=a(sl.a),l=function(e){var t=r.getEditorState(),n=e.reduce((function(e,t){return Object(be.a)(e,"file-link-card","IMMUTABLE",t)}),t);r.setEditorState(n)},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.getEditorState();t=ll(e);var o=Boolean(t);return n&&n.setState({isOpen:o}),e};return{initialize:function(e){Object.assign(r,e)},handleCommand:function(e){if(e.startsWith("insert-file-link-card:")){var t=JSON.parse(e.replace("insert-file-link-card:",""));return l(t),"handled"}return"not-handled"},onChange:c,blockRendererFn:function(e){if("atomic"===e.getType()){var t=r.getEditorState().getCurrentContent(),n=e.getEntityAt(0);if(!n)return console.warn("Entity not found",e),null;var a=t.getEntity(n);if("file-link-card"===a.getType())return{editable:!1,component:i,props:{entityKey:n,component:"div",href:a.data.href,type:a.data.type,source:a.data.source,extension:a.data.extension,size:a.data.size,name:a.data.name,onRef:function(e){o[n]={node:e,data:a.data}}}}}return null},components:[Object(Z.g)(gl,{key:"file_bubble",ref:function(e){return n=e},store:r,getData:function(){return o[t]&&o[t].data},getTarget:function(){return o[t]&&o[t].node}})],draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0],a=o.type,i=o.data;return"file-link-card"===a?sn.a.renderToStaticMarkup(Object(Z.g)("a",{"data-draft-node":"block","data-draft-type":"file-link-card",href:i.href,"data-file-type":i.type,"data-file-source":i.source,"data-file-size":i.size,"data-file-extension":i.extension},i.name)):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[1];return Fe(o)&&"file-link-card"===o.getAttribute("data-draft-type")?T.Entity.create("file-link-card","IMMUTABLE",{href:o.href,type:o.dataset.fileType,source:o.dataset.fileSource,extension:o.dataset.fileExtension,size:o.dataset.fileSize,name:o.textContent}):e.apply(void 0,n)}}}}},hl=n(1516);function ml(e){var t=e.contentState,n=e.entityKey,r=e.className,o=e.onClick,a=e.onMouseDown,i=e.adLinkCardProps,l=void 0===i?{}:i,c=t.getEntity(n).getData().id;return Object(Z.g)("div",{className:M()("Editable-adLinkCardContainer",r),onClick:o,onMouseDown:a},Object(Z.g)(hl.a,E()({id:c,isEditor:!0},l)))}ml.propTypes={contentState:v.a.object.isRequired,entityKey:v.a.string.isRequired};var yl=ml,vl={decorator:function(e){return e}},bl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign(Object.assign({},vl),e);var t={},n=Oe(fn,e.decorator),r=n(yl),o=function(e){var n=e.id,r=t.getEditorState(),o=Object(be.a)(r,"ad-link-card","IMMUTABLE",{id:n});t.setEditorState(o)};return{initialize:function(e){Object.assign(t,e)},handleCommand:function(e){if(e.startsWith("insert-ad-link-card:")){var t=e.replace("insert-ad-link-card:","");if(t)return o({id:t}),"handled"}return"not-handled"},blockRendererFn:function(n){if("atomic"===n.getType()){var o=t.getEditorState().getCurrentContent(),a=n.getEntityAt(0);if(!a)return console.warn("Entity not found",n),null;if("ad-link-card"===o.getEntity(a).getType())return{editable:!1,component:r,props:{entityKey:a,adLinkCardProps:e.adLinkCardProps}}}return null},draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"ad-link-card"===o.type?sn.a.renderToStaticMarkup(Object(Z.g)("a",{"data-draft-node":"block","data-draft-type":"ad-link-card","data-ad-id":o.data.id})):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[1];return Fe(o)&&"ad-link-card"===o.getAttribute("data-draft-type")?T.Entity.create("ad-link-card","IMMUTABLE",{id:o.getAttribute("data-ad-id")}):e.apply(void 0,n)}}}}},Cl=function(e){var t=e.getCurrentContent(),n=e.getSelection(),r=n.getStartOffset(),o=t.getBlockForKey(n.getStartKey()).getEntityAt(r),a=o&&t.getEntity(o);return a&&"mcn-link-card"===a.type.toLowerCase()?o:null},Sl=n(1089),El=n(996);function kl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Ol=function(e){f()(n,e);var t=kl(n);function n(){return i()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.isOpen,n=e.target,r=e.data,o=e.onEdit,a=e.onRef,i=r||{},l=i.status,c=void 0===l?{}:l,u=i.goodsUrl,s=void 0===u?{}:u,d=!(c[El.e.Fold]||c[El.e.NotEditable]);return Object(Z.g)(Ln.a,{arrowed:!0,target:n,isOpen:t,placement:"bottom",className:"MCNLinkCardBubble",onRef:a,onMouseDown:function(e){return e.preventDefault()}},Object(Z.g)("div",{className:"MCNLinkCardBubble-content"},Object(Z.g)("a",{target:"_blank",rel:"noopener noreferrer",href:null==s?void 0:s.url,className:"MCNLinkCardBubble-previewLink"},"查看商品"),d&&Object(Z.g)(P.c,{preset:"plain","aria-label":"编辑",onClick:function(){return o(r)},className:"MCNLinkCardBubble-button"},Object(Z.g)(Sl.a,{className:"MCNLinkCardBubble-icon",text:!0,center:!0}))))}}]),n}(C.a.Component),wl=n(1249),Tl=n(1154);function jl(e){var t=e.onRef,n=e.contentState,r=e.entityKey,o=e.className,a=e.onClick,i=e.onMouseDown,l=e.onData,c=e.getRefetchKey,u=void 0===c?function(){}:c,s=e.mcnLinkCardProps,d=void 0===s?{}:s,f=n.getEntity(r).getData().id,g=Object(b.useCallback)((function(e){return l(e)}),[r]);return Object(Z.g)(wl.a,null,Object(Z.g)(Tl.a,E()({component:"div",ref:t,className:o,id:f,scenes:El.b.Content,position:El.a.Editor,onClick:a,onMouseDown:i,refetchKey:u(),onData:g},d)))}jl.propTypes={editable:v.a.bool,contentState:v.a.object.isRequired,entityKey:v.a.string.isRequired};var Ml=jl;function Bl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Al={decorator:function(e){return e}},Rl=function(e){f()(n,e);var t=Bl(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={isOpen:!1},e.handleClick=function(t){if(e.state.isOpen){var n=e.props.store,r=Object(cn.findDOMNode)(n.getEditorRef());e.bubbleEl&&!e.bubbleEl.contains(t.target)&&r&&!r.contains(t.target)&&e.setState({isOpen:!1})}},e.handleRef=function(t){e.bubbleEl=t,t?document.addEventListener("click",e.handleClick):document.removeEventListener("click",e.handleClick)},e}return c()(n,[{key:"render",value:function(){var e=this.state.isOpen,t=this.props,n=t.onEdit,r=t.getData,o=t.getTarget;return Object(Z.g)(Ol,{isOpen:n&&e,data:r(),target:o(),onRef:this.handleRef,onEdit:n})}}]),n}(C.a.Component),Ll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign(Object.assign({},Al),e);var t,n,r={},o={},a=Oe(fn,e.decorator),i=a(Ml),l=function(e){var t=e.id,n=r.getEditorState(),o=Object(be.a)(n,"mcn-link-card","IMMUTABLE",{id:t});r.setEditorState(o)},c=function(){o[t].refetchKey=Ia()("mcn-link-card-refetch-key"),r.setEditorState(T.EditorState.forceSelection(r.getEditorState(),r.getEditorState().getSelection()))},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.getEditorState();t=Cl(e);var o=Boolean(t);return n&&n.setState({isOpen:o}),e};return{initialize:function(e){Object.assign(r,e)},handleCommand:function(e){if(e.startsWith("insert-mcn-link-card:")){var t=e.replace("insert-mcn-link-card:","");return t?(l({id:t}),"handled"):"not-handled"}return e.startsWith("edit-mcn-link-card:")&&e.replace("edit-mcn-link-card:","")?(c(),"handled"):"not-handled"},onChange:u,blockRendererFn:function(t){if("atomic"===t.getType()){var a=r.getEditorState().getCurrentContent(),l=t.getEntityAt(0);if(!l)return console.warn("Entity not found",t),null;if("mcn-link-card"===a.getEntity(l).getType())return{editable:!1,component:i,props:{entityKey:l,getRefetchKey:function(){var e;return null===(e=o[l])||void 0===e?void 0:e.refetchKey},onRef:function(e){o[l]||(o[l]={node:null,data:{}}),o[l].node=e},onData:function(e){o[l].data=Object.assign({id:null==e?void 0:e.id,status:(null==e?void 0:e.status)||""},(null==e?void 0:e.goods)||{}),n&&n.forceUpdate()},mcnLinkCardProps:e.mcnLinkCardProps}}}return null},components:[Object(Z.g)(Rl,{key:"mcn_bubble",ref:function(e){return n=e},store:r,getData:function(){return o[t]&&o[t].data},getTarget:function(){return o[t]&&o[t].node},onEdit:e.onEdit})],draft2html:{entityToHTML:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return"mcn-link-card"===o.type?sn.a.renderToStaticMarkup(Object(Z.g)("a",{"data-draft-node":"block","data-draft-type":"mcn-link-card","data-mcn-id":o.data.id})):e.apply(void 0,n)}}},html2draft:{htmlToEntity:function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[1];return Fe(o)&&"mcn-link-card"===o.getAttribute("data-draft-type")?T.Entity.create("mcn-link-card","IMMUTABLE",{id:o.getAttribute("data-mcn-id")}):e.apply(void 0,n)}}}}},Il=n(2796),xl=n(2795),Nl=n(425);function Pl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var Dl=[".docx",".doc",".markdown",".mdown",".mkdn",".md"],Kl=function(e){f()(n,e);var t=Pl(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={step:0,file:null},e.handleSessionStart=function(){e.setState({step:1})},e.handleSessionError=function(){e.setState({step:2}),e.clearSession()},e.handleSessionComplete=function(t){var n=e.props,r=n.onComplete,o=n.onClose;e.clearInput(),e.clearSession(),r(t),o()},e.uploadFile=function(t){var n=e.props.uploadManager;e.session=n.getSession("document",t);var r=e.session;r.addListener("start",e.handleSessionStart),r.addListener("error",e.handleSessionError),r.addListener("complete",e.handleSessionComplete),r.state.error||r.start()},e.handleUploaderClick=function(){e.input.value=null,e.input.click()},e.handleSubmit=function(t){t.preventDefault();var n=e.props.onError,r=e.input.files[0];r&&(r.size>5242880?n&&n("doc-size"):Dl.some((function(e){return r.name.toLowerCase().endsWith(e)}))?(e.setState({file:r}),e.uploadFile(r)):n&&n("doc-type"))},e.handleClose=function(){var t=e.props.onClose;e.clearInput(),e.clearSession(),w.a.trackEvent(document.documentElement,{id:1185,action:"Close"}),t()},e.clearSession=function(){var t=e.session;t&&(t.removeListener("start",e.handleSessionStart),t.removeListener("error",e.handleSessionError),t.removeListener("complete",e.handleSessionComplete),t.abort())},e.clearInput=function(){e.input.value=null},e}return c()(n,[{key:"componentWillReceiveProps",value:function(e){!this.props.shown&&e.shown&&this.setState({step:0,file:null})}},{key:"componentWillUnmount",value:function(){this.clearSession()}},{key:"renderTitle",value:function(){return Object(Z.g)("p",{className:"Editable-docModal-title"},"文档导入")}},{key:"renderFooter",value:function(){return"若文档中存在编辑器所不支持的文本样式（例如表格），将以纯文本展示；不能保证所有格式（例如公式、代码）都能正确导入。建议检查、确认无误后发布。"}},{key:"render",value:function(){var e,t,n=this,r=this.props.shown,o=this.state,a=o.step,i=o.file;return Object(Z.g)(kn.b,{className:"Editable-docModal",overlay:!0,title:this.renderTitle(),footer:0===a&&this.renderFooter(),onClose:this.handleClose,maskClosable:!1},r&&Object(Z.g)("form",{ref:function(e){n.root=e},onSubmit:this.handleSubmit},0===a&&Object(Z.g)("div",{className:"Editable-docModal-container"},Object(Z.g)("div",{className:"Editable-docModal-uploader",onClick:this.handleUploaderClick},Object(Z.g)("div",{className:"Editable-docModal-uploader-icon"},Object(Z.g)(xl.a,{size:52})),Object(Z.g)("div",{className:"Editable-docModal-uploader-text"},"选择要导入的文档"),Object(Z.g)("div",{className:"Editable-docModal-uploader-tip"},"文档最大 5MB，支持 doc、docx、md 格式"))),(1===a||2===a)&&Object(Z.g)("div",{className:"Editable-docModal-fileName"},Object(Z.g)(Il.a,{text:!0}),(e=i.name,(t=Object(Rr.stringWidth)(e))<41?e:"".concat(Object(Rr.cutStringWidth)(e,28),"…").concat(e.split(Object(Rr.cutStringWidth)(e,t-12))[1]))),1===a&&Object(Z.g)("div",{className:"Editable-docModal-loading"},Object(Z.g)(Nl.a,null)),2===a&&Object(Z.g)("div",{className:"Editable-docModal-fail"},Object(Z.g)("div",{className:"Editable-docModal-failHint"},"文档导入失败，请重新上传"),Object(Z.g)(P.c,{className:"Editable-docModal-retryButton",preset:"primary",color:"blue",onClick:function(){n.handleUploaderClick(),w.a.trackEvent(document.documentElement,{id:1186,action:"Select"})}},"选择文档")),Object(Z.g)("input",{ref:function(e){n.input=e},accept:Dl,type:"file",required:!0,onChange:this.handleSubmit})))}}]),n}(b.Component);Kl.propTypes={shown:v.a.bool,onComplete:v.a.func.isRequired,onClose:v.a.func.isRequired,onError:v.a.func},Kl.defaultProps={shown:!1};var Fl=function(e,t){var n=e.getUploadManager,r=e.onError,o=e.onComplete,a=Object(b.useState)(!1),i=qt()(a,2),l=i[0],c=i[1],u=Object(uo.d)((function(){return c(!1)})),s=Object(uo.d)((function(){return c(!0)}));return Object(b.useImperativeHandle)(t,(function(){return{onOpen:s,onClose:u}}),[s,u]),Object(Z.g)(Kl,{shown:l,uploadManager:null==n?void 0:n(),onComplete:o,onError:r,onClose:u})};Fl.propType={uploadManager:v.a.object.isRequired,onError:v.a.func.isRequired,onComplete:v.a.func.isRequired};var zl=Object(b.forwardRef)(Fl),Ul=function(e){var t=e.onError,n=e.allowImageUpload,r=C.a.createRef(null),o={};return{initialize:function(e){Object.assign(o,e)},handleCommand:function(e){var t;return"insert-doc"===e?(null===(t=r.current)||void 0===t||t.onOpen(),"handled"):"not-handled"},components:[Object(Z.g)(zl,{key:"doc_modal",getUploadManager:function(){var e;return null===(e=o.getEditorRef())||void 0===e?void 0:e.props.uploadManager},onError:t,onComplete:function(e){var t=o.getEditorRef().props.html2draftMiddlewares,r=qe(e.html,!0,!n,t),a=r.blockMap,i=r.entityMap;o.getEditorRef().props.onChange(Object(kt.a)(o.getEditorState(),a,i))},ref:r})],toolbar:{section:Xe.a.MENU,label:"文档导入",commandName:"insert-doc",icon:Il.a,onClick:function(e){w.a.trackEvent(e.target,{id:1184,action:"Click",name:"文档导入"})}}}},Vl=n(6),ql=n(1390),_l=n(1385),Hl=n(885),Gl=n(2013),Wl=n(1095);var Yl={name:"9y6172",styles:"user-select:none;"},Jl={name:"1vs9cou",styles:"opacity:0.6;"},Zl={name:"9y6172",styles:"user-select:none;"},$l={name:"1x02pr2",styles:"& .Modal-title{margin-top:34px;margin-bottom:16px;}& .Modal-content{margin-top:16px;padding:0;}"},Xl={name:"nuo349",styles:"&.ModalButtonGroup--vertical{margin-top:30px;margin-bottom:20px; .Button{width:360px;}.Button + .Button{margin-top:10px;}}"};var Ql=function(e){var t=e.canPlay,n=e.children,r=e.handleRemoveVideo,o=Object(b.useState)(!1),a=qt()(o,2),i=a[0],l=a[1],c=Object(b.useState)(!1),u=qt()(c,2),s=u[0],d=u[1];return Object(Z.g)($r.Box,{width:i?"100%":"256px"},Object(Z.g)($r.Box,{css:function(e){return{borderTopLeftRadius:2,borderTopRightRadius:2,borderBottom:"none",border:"1px solid ".concat(e.colors.GBK09A)}}},Object(Z.g)($r.Flex,{alignItems:"center",height:"28px",px:"12px"},Object(Z.g)($r.Flex,{alignItems:"center",css:function(e){return{cursor:t?"pointer":"not-allowed",color:t?e.colors.GBL05A:e.colorMod(e.colors.GBL05A).alpha(.3)}},onClick:function(){return t&&l(!i)}},i?Object(Z.g)(Hl.a,{size:16}):Object(Z.g)(Gl.a,{size:16}),Object(Z.g)($r.Text,{fontSize:"12px",ml:"8px",css:Yl},i?"查看图片":"播放视频")),r&&Object(Z.g)(Wl.a,{css:function(e){return{width:16,height:16,marginLeft:"auto",color:e.colors.GBL05A,cursor:"pointer"}},onClick:function(){return d(!0)}})),C.a.cloneElement(C.a.Children.only(n),{isFullWidth:i})),Object(Z.g)($r.Flex,{css:function(e){return{height:20,marginTop:"5px",color:e.colors.GBK06A,marginLeft:"3px"}},alignItems:"center"},Object(Z.g)(ql.a,{size:16,css:Jl}),Object(Z.g)($r.Text,{fontSize:"13px",ml:"4px",css:Zl},"回答中的视频也会同时流通")),Object(Z.g)(kn.b,{title:"删除视频",maskClosable:!1,onClose:function(){return d(!1)},css:$l},s&&Object(Z.g)(C.a.Fragment,null,Object(Z.g)($r.Text,{textAlign:"center",color:"GBL05A"},"移除后将无法撤销，确认移除该视频？"),Object(Z.g)(kn.a,{css:Xl},Object(Z.g)(P.c,{preset:"primary",color:"blue",onClick:r},"确定"),Object(Z.g)(P.c,{onClick:function(){return d(!1)}},"取消")))))},ec=n(940),tc=n(1137);var nc={name:"70qvj9",styles:"display:flex;align-items:center;"},rc=function(e){var t=e.zvideoType,n=e.onZvideoTypeChange;return Object(Z.g)($r.Flex,{alignItems:"center",height:"50px",css:function(e){return{borderBottom:"1px solid ".concat(e.colors.GBK10A)}}},Object(Z.g)($r.Text,{fontSize:"14px",color:"GBK04A",fontWeight:"bold"},"视频类型"),Object(Z.g)($r.Flex,{ml:"auto"},jo.e.map((function(e){var r=e.value,o=e.label;return Object(Z.g)("label",{key:r,css:nc},Object(Z.g)(ec.a,{size:16,checked:r===t,onChange:function(){return n(r)},css:function(e){return{marginLeft:16,marginRight:8,fontSize:14,color:e.colors.GBK03A}}}),o)}))))},oc={name:"1vs9cou",styles:"opacity:0.6;"},ac={name:"9y6172",styles:"user-select:none;"},ic={name:"1hyfx7x",styles:"display:none;"};var lc=function(e){var t=e.uploadManager,n=e.onError,r=e.videoAnswerEditable,o=e.data,a=e.onDataChange,i=e.duration,l=e.onDurationChange,c=e.zvideoType,u=e.onZvideoTypeChange,s=Object(b.useRef)(),d=Object(b.useState)(),f=qt()(d,2),g=f[0],p=f[1];Object(b.useEffect)((function(){!i&&o&&o.id&&Object(tc.a)("https://lens.zhihu.com/api/v4/videos/".concat(o.id)).then((function(e){return Object(Vl.camelizeKeys)(e)})).then((function(e){if(!e.error){var t,n,r=(t=e.playlist,(n=["lD","sD","hD","fHD"].find((function(e){return Boolean(t[e])})))?t[n].duration:null);r&&l(r)}})).catch((function(){}))}),[i,JSON.stringify(o),l]);var h=Object(b.useCallback)((function(e){Object(jo.h)()?jo.a.some((function(t){return e.name.toLowerCase().endsWith(t)}))?(p(e),Object(jo.f)(e).then((function(e){l(e)})),a({upload:{file:e},uploading:!0})):null==n||n("video-type"):null==n||n("unsupported-browser")}),[n,l,a]),m=Object(b.useCallback)((function(e){e.preventDefault();var t=ue(e);h(t[0])}),[h]),y=Object(b.useCallback)((function(e,t){a(Object.assign(Object.assign(Object.assign({},o),t),{},{upload:null,error:null,uploading:!1}))}),[a,JSON.stringify(o)]),v=Object(b.useCallback)((function(){a(Object.assign(Object.assign({},o),{},{error:{status:"upload_fail"},uploading:!1}))}),[a,JSON.stringify(o)]),S=Object(b.useCallback)((function(){null!=o&&o.uploading&&t&&t.getSession("video",g).abort(),a(null)}),[a,JSON.stringify(o),t]),E=Object(b.useCallback)((function(e){a(Object.assign(Object.assign({},o),{},{changedVideoPoster:!0,thumbnail:e}))}),[a,JSON.stringify(o)]);return o?o.upload?Object(Z.g)(C.a.Fragment,null,Object(Z.g)(Ql,{handleRemoveVideo:S},Object(Z.g)(Eo.a,{isVideoAnswer:!0,uploadManager:t,data:o,coverButtonText:"编辑封面",onVideoUploaded:y,onVideoUploadError:v,handleVideoPosterChange:E})),Object(Z.g)(rc,{zvideoType:c,onZvideoTypeChange:u})):o.error?Object(Z.g)(C.a.Fragment,null,Object(Z.g)(Ql,{handleRemoveVideo:S},Object(Z.g)(wo,{data:o,isVideoAnswer:!0})),Object(Z.g)(rc,{zvideoType:c,onZvideoTypeChange:u})):Object(Z.g)(C.a.Fragment,null,Object(Z.g)(Ql,{canPlay:!0,handleRemoveVideo:r&&S},Object(Z.g)(So,{isVideoAnswer:!0,data:o,duration:Object(_l.a)(i),allowVideoTitleChange:function(){return!1},handleVideoPosterChange:E})),r&&Object(Z.g)(rc,{zvideoType:c,onZvideoTypeChange:u})):Object(Z.g)($r.Flex,{alignItems:"center",justifyContent:"center",height:"190px",css:function(e){return{boxSizing:"border-box",border:"2px dashed ".concat(e.colors.GBK09A),borderRadius:"2px",cursor:"pointer"}},onClick:function(){return s.current.click()},onDragEnter:function(e){return e.preventDefault()},onDragOver:function(e){return e.preventDefault()},onDrop:m},Object(Z.g)($r.Flex,{alignItems:"center",justifyContent:"center",size:"64px",css:function(e){return{borderRadius:"50%",backgroundColor:e.colors.GBK10A}}},Object(Z.g)(To.a,{css:function(e){return{color:e.colors.GBL05A,width:36,height:36}}})),Object(Z.g)($r.Box,{ml:"20px"},Object(Z.g)($r.Flex,null,Object(Z.g)($r.Text,{fontSize:"18px",lineHeight:"25px",fontWeight:"bold",mb:"6px",css:function(e){return{color:e.colors.GBK03A}}},"添加视频文件"),Object(Z.g)($r.Flex,{alignItems:"center",css:function(e){return{height:20,color:e.colors.GBK06A,marginLeft:"13px",marginTop:"5px"}}},Object(Z.g)(ql.a,{size:16,css:oc}),Object(Z.g)($r.Text,{fontSize:"13px",ml:"4px",css:ac},"回答中的视频也会同时流通"))),Object(Z.g)($r.Text,{fontSize:"14px",lineHeight:"20px",css:function(e){return{color:e.colors.GBL05A,a:{textDecoration:"underline"}}}},"请不要添加无关的视频，详情查看"," ",Object(Z.g)("a",{href:"https://www.zhihu.com/question/20118966",target:"_blank",rel:"noopener noreferrer",onClick:function(e){return e.stopPropagation()}},"知乎视频使用规范"),Object(Z.g)("br",null),"上传视频，即代表你同意",Object(Z.g)("a",{href:"https://www.zhihu.com/terms/video",target:"_blank",rel:"noopener noreferrer",onClick:function(e){return e.stopPropagation()}},"《知乎视频用户协议》"))),Object(Z.g)("input",{ref:s,type:"file",onChange:function(){return h(s.current.files[0])},css:ic}))},cc=["link","file-link-card","image","formula","reference","divider"],uc=function(e){var t=e.getBlockMap();return t.forEach((function(n){n.findEntityRanges((function(t){var n=t.getEntity();if(!n)return!1;var r=e.getEntity(n).getType().toLowerCase();return!cc.includes(r)}),(function(r,o){var a=n.getKey();if("atomic"!==n.getType()){var i=new T.SelectionState({anchorKey:a,anchorOffset:r,focusKey:a,focusOffset:o});e=T.Modifier.setBlockType(e,i,"unstyled"),e=T.Modifier.removeRange(e,i,"backward")}else{var l=t.remove(a);e=e.merge({blockMap:l})}}))})),e},sc=function(e){var t=e.getIsVideoAnswer,n={};return{initialize:function(e){Object.assign(n,e)},handlePastedText:function(e,r,o,a){var i=a.setEditorState;if(t()){var l=n.getEditorRef().props.html2draftMiddlewares;if(r){var c=uc(qe(r,!0,void 0,l));return i(Object(kt.a)(o,c.blockMap,c.entityMap)),"handled"}}return"not-handled"}}},dc=function(){var e={};return{initialize:function(t){Object.assign(e,t)},handleCommand:function(t){var n=t.match(/insert-text:([\W\w]+)$/);if(n){var r=n[1],o=e.getEditorState();return o.getSelection().isCollapsed()?e.setEditorState(Object(Qe.a)(o,r)):e.setEditorState(Object(Et.a)(o,r)),"handled"}return"not-handled"}}},fc=n(956);function gc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var o=m()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p()(this,n)}}var pc={name:"16iox1a",styles:"margin:16px 20px 14px;"},hc=function(e){f()(n,e);var t=gc(n);function n(e){var r;i()(this,n),(r=t.call(this,e)).externalPlugins=r.props.createEditorPlugins({getUploadManager:function(){return r.uploadManager}}),r.getPlugins=function(){var e,t,n=r.props,a=n.allowReference,i=n.getPlugins;return[r.submitHotkeyPlugin,r.convertPlugin,r.tablePlugin,a&&r.referencePlugin,r.catalogPlugin,r.formulaPlugin,r.zvideoLinkCardPlugin,r.fileLinkCardPlugin,r.adLinkCardPlugin,r.mcnLinkCardPlugin,r.docPlugin,r.videoAnswerPlugin,r.insertTextPlugin].concat(o()(null!==(e=r.externalPlugins)&&void 0!==e?e:[]),o()(null!==(t=null==i?void 0:i({getUploadManager:function(){return r.uploadManager}}))&&void 0!==t?t:[])).filter(Boolean)},r.getIsVideoAnswer=function(){var e=r.props,t=e.videoAnswerPublished,n=e.videoAnswerEditable;return t||n},r.getFileLinkCards=function(){return Object(ro.a)(r.EditableCore.state.editorState).filter((function(e){return"file-link-card"===e.getType()}))},r.getADLinkCards=function(){return Object(ro.a)(r.EditableCore.state.editorState).filter((function(e){return"ad-link-card"===e.getType()}))},r.getFeeConsultCards=function(){return Object(ro.a)(r.EditableCore.state.editorState).filter((function(e){return"ad-link-card"===e.getType()&&e.data.id.startsWith("fee_")}))},r.getMCNLinkCards=function(){return Object(ro.a)(r.EditableCore.state.editorState).filter((function(e){return"mcn-link-card"===e.getType()}))},r.hasImage=function(e){var t;return(null===(t=r.imagePlugin)||void 0===t?void 0:t.getImages(e).size)>0},r.hasVideo=function(e){var t,n;return(null===(t=r.EditableCore.videoPlugin)||void 0===t||null===(n=t.getVideos(e))||void 0===n?void 0:n.size)>0},r.hasCatalog=function(){var e;return null===(e=r.catalogPlugin)||void 0===e?void 0:e.hasCatalog()},r.hasFileLinkCard=function(){return r.getFileLinkCards().size>0},r.hasADLinkCard=function(){return r.getADLinkCards().size>0},r.hasFeeConsultCard=function(){return r.getFeeConsultCards().size>0},r.hasMCNLinkCard=function(){return r.getMCNLinkCards().size>0},r.toHTML=function(){return r.EditableCore.toHTML()},r.focus=function(){return r.EditableCore.focus()},r.blur=function(){return r.EditableCore.blur()},r.resetWithValue=function(){var e;return(e=r.EditableCore).resetWithValue.apply(e,arguments)},r.reset=function(){return r.EditableCore.reset()},r.handleVideoDurationChange=function(e){r.setState({videoDuration:e})},r.syncChange=function(e){var t=e.videoData,n=e.zvideoType,o=r.EditableCore.state.editorState,a=r.props,i=a.onChange,l=a.outputBlockType,c=r.getAttachment(t,n);null==i||i(We(o,l,r.draft2htmlMiddlwares,c))},r.handleVideoDataChange=function(e){r.setState(Object.assign({videoData:e},null===e&&{zvideoType:null,videoDuration:null})),null!=e&&e.error||null!=e&&e.uploading||r.syncChange({videoData:e})},r.handleZvideoTypeChange=function(e){r.setState({zvideoType:e}),r.syncChange({zvideoType:e})},r.handleCommand=function(){var e;return(e=r.EditableCore).handleCommand.apply(e,arguments)},r.queryCommandState=function(){var e;return(e=r.EditableCore).queryCommandState.apply(e,arguments)},r.queryCommandEnable=function(){var e;return(e=r.EditableCore).queryCommandEnable.apply(e,arguments)},r.handleKeyCommand=function(e){r.props.onBeforeCommand&&r.props.onBeforeCommand(e);var t=r.EditableCore.state.editorState;if("handled"===r.handleCommand(e))return"handled";if("command-submit"===e){var n=r.props,o=n.onSubmit,a=n.outputBlockType;return o&&o(We(t,a,r.draft2htmlMiddlwares,r.getAttachment())),"handled"}return"not-handled"},r.getAttachment=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.state.videoData,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.state.zvideoType;if(!e)return null;var n=r.props.isLegacyVideoAnswer;return{type:n?"zvideo":"video",videoId:e.id,imageUrl:e.thumbnail,isOriginal:t&&t===fc.f.original}},r.checkVideoStatus=function(){var e=r.state.videoData;return{isUploading:null==e?void 0:e.uploading,hasError:null==e?void 0:e.error}},r.clearAllContent=function(){r.setState({videoData:null,zvideoType:null,videoDuration:null},r.reset)},r.onChange=function(){var e;(e=r.EditableCore).onChange.apply(e,arguments)},r.onBlur=function(){var e;(e=r.EditableCore).onBlur.apply(e,arguments)},r.onToggleCatalog=function(){setTimeout((function(){r.forceUpdate()}),0),w.a.trackEvent(r.root,{id:9743,action:"Click",name:r.props.editingContentType})},r.updateAttachment=function(e){var t=r.EditableCore.state.editorState,n=r.props.outputBlockType;r.onChange(We(t,n,r.draft2htmlMiddlwares,e))},r.getEditorState=function(){return r.EditableCore.state.editorState},r.focusPlugin=ln(),r.submitHotkeyPlugin=Ct(),r.referencePlugin=Va({useV2Feature:r.props.useV2Feature}),r.catalogPlugin=Xa({isCatalogEnabled:r.props.catalogEnabled,onToggleCatalog:r.onToggleCatalog,getShowToolbarButton:function(){return!!r.props.useCatalogV2||r.props.allowCatalog},useV2Feature:r.props.useV2Feature,useCatalogV2:r.props.useCatalogV2,onCloseCatalog:r.props.onCloseCatalog,autoCalcShouldShow:r.props.autoCalcCatalogShouldShow,maskGradientColor:r.props.maskGradientColor}),r.formulaPlugin=Oi({useV2Feature:r.props.useV2Feature}),r.fileLinkCardPlugin=pl({decorator:r.focusPlugin.decorator}),r.zvideoLinkCardPlugin=il({decorator:r.focusPlugin.decorator,newLinkCard:r.props.newLinkCard,onInsertZVideo:function(){return r.props.onInsertZVideo(s()(r))},getShowToolbarButton:function(){return r.props.allowZVideo}}),r.adLinkCardPlugin=bl({decorator:r.focusPlugin.decorator,adLinkCardProps:r.props.adLinkCardProps}),r.mcnLinkCardPlugin=Ll({decorator:r.focusPlugin.decorator,onEdit:r.props.onMCNLinkCardEdit&&function(e){return r.props.onMCNLinkCardEdit(s()(r),e)},mcnLinkCardProps:r.props.mcnLinkCardProps}),r.tablePlugin=ol({decorator:r.focusPlugin.decorator,onRemove:function(){r.focusPlugin.removeBlockWithOptions({forwared:!1,delay:!0})},getShowToolbarButton:function(){return r.props.allowTable},useV2Feature:r.props.useV2Feature}),r.docPlugin=Ul({onError:r.props.onError,allowImageUpload:r.props.allowImageUpload,html2draftMiddlewares:r.html2draftMiddlewares}),r.videoAnswerPlugin=sc({getIsVideoAnswer:r.getIsVideoAnswer}),r.insertTextPlugin=dc(),r.getCreateContent=function(){var e=r.props,t=e.videoAnswerPublished,n=e.videoAnswerEditable;return t||n?function(){return uc(Ge.apply(void 0,arguments))}:Ge},r.renderContentAboveDropZone=function(){var e,t=r.props,n=t.videoAnswerPublished,o=t.videoAnswerEditable,a=t.onError,i=r.state,l=i.videoData,c=i.videoDuration,u=i.zvideoType;return(n||o)&&Object(Z.g)("div",{css:pc},Object(Z.g)(lc,{uploadManager:null===(e=r.EditableCore)||void 0===e?void 0:e.uploadManager,onError:a,videoAnswerEditable:o,data:l,onDataChange:r.handleVideoDataChange,duration:c,onDurationChange:r.handleVideoDurationChange,zvideoType:u,onZvideoTypeChange:r.handleZvideoTypeChange}))},r.getExtraPluginData=function(){return r.EditableCore.getExtraPluginData()};var a=e.defaultVideo;return r.state={videoData:a?{id:a.videoId,thumbnail:a.imageUrl||a.thumbnail,isLens:!0}:null,videoDuration:null==a?void 0:a.duration,zvideoType:"boolean"==typeof(null==a?void 0:a.isOriginal)?a.isOriginal?fc.f.original:fc.f.reprint:null},r}return c()(n,[{key:"componentDidUpdate",value:function(e){var t=this;!this.props.catalogEnabled==!!e.catalogEnabled&&this.handleKeyCommand("toggle-catalog");var n=e.videoAnswerEditable,r=this.props,o=r.videoAnswerEditable,a=r.onChange,i=r.outputBlockType;!n&&o?this.EditableCore.setState({editorState:T.EditorState.set(this.EditableCore.state.editorState,{currentContent:uc(this.EditableCore.state.editorState.getCurrentContent())})},(function(){null==a||a(We(t.EditableCore.state.editorState,i,t.EditableCore.draft2htmlMiddlwares,t.getAttachment()))})):n&&!o&&(null==a||a(We(this.EditableCore.state.editorState,i,this.EditableCore.draft2htmlMiddlwares,null)))}},{key:"render",value:function(){var e=this,t=this.props,n=t.allowHeaderThree,r=t.allowDragAndDrop,o=t.allowToolbarSticky,a=t.allowLink,i=t.allowDivider,l=t.className,c=t.getToolbarSidePlugins,u=void 0===c?this.props.getToolbarPlugins:c,s=t.getToolbarMainPlugins,d=t.getToolbarMenuPlugins,f=t.getEditorBeforePlugins,g=t.toolbarMenuAttention,p=t.minRows,h=t.onFocus,m=t.outputBlockType,y=t.placeholder,v=t.readOnly,b=t.toolbarStickyOffset,C=t.toolbarProps,S=t.autoFocus,E=t.newLinkCard,k=t.allowPasteRichText,O=t.allowMention,w=t.mentionSource,T=t.defaultValue,j=t.onChange,M=t.onAnyChange,B=t.onAfterAnyChange,A=t.onAfterChange,R=t.onBlur,L=t.allowToolbar,I=t.allowLinkCard,x=t.allowInlineCode,N=t.allowImageUpload,P=t.allowImageCaption,D=t.allowResizeImage,K=t.allowFloatImage,F=t.allowVideoTitleChange,z=t.allowVideo,U=t.allowImageEditor,V=t.onReady,q=t.onVideoPosterButtonClick,_=t.onImageUpload,H=t.onVideoUpload,G=t.onSelectText,W=t.onSubmit,Y=t.onError,J=t.onLoadStart,$=t.onLoadEnd,X=t.onUploadStart,Q=t.onUploadEnd,ee=t.onUploadError,te=t.onBeforeVideoUpload,ne=t.onBeforeCommand,re=t.logo,oe=t.location,ae=t.editingContentType,ie=t.couldSuperVideoUpload,le=t.videoAnswerPublished,ce=t.videoAnswerEditable,ue=t.allowZVideo,se=t.apiRoot,de=t.useV2Feature,fe=t.uploadImageError,ge=t.customToolbar,pe=t.showToolbar,he=t.mustAlgorithmCover,me=t.hideImageToolbar,ye=le||ce;return Object(Z.g)(Ca,{renderContentAboveDropZone:this.renderContentAboveDropZone,createContent:this.getCreateContent(),getAttachment:this.getAttachment,ref:function(t){return e.EditableCore=t},getPlugins:this.getPlugins,className:l,autoFocus:S,minRows:p,newLinkCard:E,placeholder:y,allowToolbarSticky:o,allowToolbar:L,toolbarStickyOffset:b,allowPasteRichText:k,allowDragAndDrop:r,allowMention:O,mentionSource:w,outputBlockType:m,defaultValue:T,onChange:j,onAfterChange:A,onAnyChange:M,onAfterAnyChange:B,onFocus:h,onBlur:R,allowHeaderThree:n,allowLinkCard:I,allowInlineCode:x,allowImageUpload:N,allowImageCaption:P,allowImageEditor:U,allowResizeImage:D,allowFloatImage:K,allowVideoTitleChange:F,allowLink:a,allowDivider:i,allowVideo:!ye&&z,onReady:V,onVideoPosterButtonClick:q,onImageUpload:_,onVideoUpload:H,onSelectText:G,onSubmit:W,onError:Y,onLoadStart:J,onLoadEnd:$,onUploadStart:X,onUploadEnd:Q,onUploadError:ee,onBeforeVideoUpload:te,onBeforeCommand:ne,getEditorBeforePlugins:f,getToolbarMainPlugins:s,getToolbarSidePlugins:u,getToolbarMenuPlugins:d,toolbarMenuAttention:g,hideImageToolbar:me,editableComponent:this,logo:re,location:oe,readOnly:v,editingContentType:ae,couldSuperVideoUpload:ie,toolbarProps:C,getShowVideoToolbarButton:function(){return!ue&&!ye&&z},focusPlugin:this.focusPlugin,handleKeyCommand:this.handleKeyCommand,apiRoot:se,useV2Feature:de,uploadImageError:fe,customToolbar:ge,showToolbar:pe,mustAlgorithmCover:he})}}]),n}(b.Component);hc.propTypes=Object.assign(Object.assign({},Ca.propTypes),{},{adLinkCardProps:v.a.object,onMCNLinkCardEdit:v.a.func,mcnLinkCardProps:v.a.object,allowReference:v.a.bool,allowTable:v.a.bool,allowZVideo:v.a.bool,allowCatalog:v.a.bool,catalogEnabled:v.a.bool,useCatalogV2:v.a.bool,onInsertZVideo:v.a.func,loadVideo:v.a.func,defaultVideo:v.a.object,apiRoot:v.a.string,uploadImageError:v.a.func.isRequired,createEditorPlugins:v.a.func.isRequired}),hc.defaultProps=Object.assign(Object.assign({},Ca.defaultProps),{},{allowReference:!1,allowTable:!1,allowZVideo:!1,allowCatalog:!1,catalogEnabled:!1,useCatalogV2:!1,createEditorPlugins:function(){return[]}});t.default=hc},895:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onFullyViewedOnce=t.isFullyViewed=t.onViewedOnce=t.isViewed=void 0;var r=n(924);Object.defineProperty(t,"isViewed",{enumerable:!0,get:function(){return r.isViewed}}),Object.defineProperty(t,"onViewedOnce",{enumerable:!0,get:function(){return r.onViewedOnce}});var o=n(925);Object.defineProperty(t,"isFullyViewed",{enumerable:!0,get:function(){return o.isFullyViewed}}),Object.defineProperty(t,"onFullyViewedOnce",{enumerable:!0,get:function(){return o.onFullyViewedOnce}})},924:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.onViewedOnce=t.isViewed=void 0;var o=r(n(244));t.isViewed=function(e){if(!document.body||!document.body.contains(e))return!1;var t=e.getBoundingClientRect(),n=document.documentElement;return t.bottom<(window.innerHeight||n.clientHeight)};var a=function(){};t.onViewedOnce=function(e,n,r){if(t.isViewed(e))return n.call(r,e),a;var i=o.default((function(){t.isViewed(e)&&(n.call(r,e),l())}),250);function l(){window.removeEventListener("scroll",i),window.removeEventListener("resize",i)}return window.addEventListener("scroll",i),window.addEventListener("resize",i),l}},925:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.onFullyViewedOnce=t.isFullyViewed=void 0;var o=r(n(244)),a=r(n(63));t.isFullyViewed=function(e,t){var n=e.getBoundingClientRect(),r=n.right,o=n.bottom,a=t.getBoundingClientRect(),i=a.right;return o<=a.bottom&&r<=i},t.onFullyViewedOnce=function(e,n,r,i){if(t.isFullyViewed(e,n))return r.call(i,e),a.default;var l=o.default((function(){t.isFullyViewed(e,n)&&(r.call(i,e),c())}),250);n.addEventListener("scroll",l),n.addEventListener("resize",l);var c=function(){n.removeEventListener("scroll",l),n.removeEventListener("resize",l)};return c}},938:function(e,t,n){"use strict";n.d(t,"b",(function(){return f}));var r=n(24),o=n.n(r),a=n(168),i=n.n(a),l=n(473),c=n.n(l);function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d={CONTENT_OPERATION:"content_operation",TEXT_STYLE:"text_style",LIST:"list",BLOCK:"block",STRUCTURE_GENERATION:"structure_generation",PROFESSIONAL_MEDIA:"professional_media",BASIC_MEDIA:"basic_media",BUSINESS_MEDIA:"business_media"},f=function(e){var t,n=Object.values(d).reduce((function(e,t){return Object.assign(Object.assign({},e),{},o()({},t,[]))}),{}),r=[],a=[],l=u(e);try{for(l.s();!(t=l.n()).done;){var s=t.value.toolbarV2;if(i()(s)||Array.isArray(s)){var f,g=u(i()(s)?[s]:s);try{for(g.s();!(f=g.n()).done;){var p=f.value;p.parentName?a.push(p):r.push(p)}}catch(e){g.e(e)}finally{g.f()}}}}catch(e){l.e(e)}finally{l.f()}for(var h=function(){var e=y[m],t=e.section,r=e.parentName,o=n[t];if(r){var a=o.find((function(e){return e.name===r}));if(!a)return"continue";a.childItems||(a.childItems=[]),a.childItems.includes(e)||(a.childItems.push(e),a.childItems=c()(a.childItems,(function(e){var t;return null!==(t=e.priority)&&void 0!==t?t:1/0})))}else o.push(e),o=c()(o,(function(e){var t;return null!==(t=e.priority)&&void 0!==t?t:1/0}));n[t]=o},m=0,y=[].concat(r,a);m<y.length;m++)h();return n};t.a=d},985:function(e,t,n){"use strict";var r=n(890);t.a=function(e,t,n,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:" ",i=e.getSelection(),l=e.getCurrentContent(),c=l.createEntity(t,n,o),u=c.getLastCreatedEntityKey(),s=r.EditorState.set(e,{currentContent:c}),d=(s=r.AtomicBlockUtils.insertAtomicBlock(s,u,a)).getCurrentContent(),f=d.getBlockMap(),g=i.getStartKey(),p=d.getBlockForKey(g);p!==f.first()&&0===p.getLength()&&(f=f.delete(g),d=d.merge({blockMap:f}));var h=s.getSelection().getFocusKey(),m=d.getBlockForKey(h);return m!==f.last()&&0===m.getLength()&&(f=f.delete(h),d=d.merge({blockMap:f,selectionAfter:r.SelectionState.createEmpty(d.getKeyAfter(h))})),s=r.EditorState.set(s,{currentContent:d}),r.EditorState.forceSelection(s,s.getCurrentContent().getSelectionAfter())}},994:function(e,t,n){"use strict";var r=n(0),o=n.n(r),a=n(27),i=function(e){return o.a.createElement(a.a,e,o.a.createElement("path",{d:"M12 11l-3.716 3.782a.758.758 0 0 1-1.064 0 .738.738 0 0 1 0-1.052l4.249-4.512a.758.758 0 0 1 1.064 0l4.246 4.512a.738.738 0 0 1 0 1.052.757.757 0 0 1-1.063 0L12.002 11z",fillRule:"evenodd"}))};i.defaultProps={name:"ArrowUp"},t.a=i}}]);
//# sourceMappingURL=main.richinputV2.14ded39c2a9f36668a20.js.map